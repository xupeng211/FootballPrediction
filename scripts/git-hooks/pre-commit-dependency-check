#!/bin/bash
# Pre-commit hook: 检查依赖变更并提醒AI工具

echo "🔍 检查依赖变更..."

# 运行依赖检查脚本
python scripts/dependency/check_changes.py

# 检查是否有未锁定的依赖变更
if git diff --cached --name-only | grep -q "requirements.*\.in$"; then
    # 检查是否有对应的lock文件
    if ! git diff --cached --name-only | grep -q "requirements.*\.lock$"; then
        echo ""
        echo "⚠️  警告：检测到.in文件变更但未生成对应的.lock文件"
        echo "   请运行 'make lock-deps' 并提交生成的lock文件"
        echo ""
        echo "💡 提示：阅读 CLAUDE.md 了解正确的依赖管理流程"
    fi
fi
