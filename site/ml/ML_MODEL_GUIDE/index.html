
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="åŸºäºç°ä»£PythonæŠ€æœ¯æ ˆçš„è¶³çƒé¢„æµ‹ç³»ç»Ÿå®Œæ•´æ–‡æ¡£">
      
      
        <meta name="author" content="Football Prediction Team">
      
      
        <link rel="canonical" href="https://football-prediction-docs.example.com/ml/ML_MODEL_GUIDE/">
      
      
        <link rel="prev" href="../../ops/runbooks/DISASTER_RECOVERY_RUNBOOK/">
      
      
        <link rel="next" href="../../project/CHANGELOG/">
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>MLæ¨¡å‹æŒ‡å— - è¶³çƒé¢„æµ‹ç³»ç»Ÿæ–‡æ¡£</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  <meta property="og:type" content="website">
  <meta property="og:title" content="è¶³çƒé¢„æµ‹ç³»ç»Ÿæ–‡æ¡£">
  <meta property="og:description" content="åŸºäºç°ä»£PythonæŠ€æœ¯æ ˆçš„è¶³çƒé¢„æµ‹ç³»ç»Ÿå®Œæ•´æ–‡æ¡£">
  <meta property="og:url" content="https://football-prediction-docs.example.com/ml/ML_MODEL_GUIDE/">
  <meta property="og:image" content="../../assets/logo.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@football_pred">
  <meta name="twitter:creator" content="@football_pred">

  <!-- è‡ªå®šä¹‰CSSå’ŒJS -->
  <link rel="stylesheet" href="../../assets/extra.css">
  <script src="../../assets/extra.js"></script>

  <!-- æ·»åŠ ä¸­æ–‡å­—ä½“æ”¯æŒ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">

  

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          è·³è½¬è‡³
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
  
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="é¡µçœ‰">
    <a href="../.." title="è¶³çƒé¢„æµ‹ç³»ç»Ÿæ–‡æ¡£" class="md-header__button md-logo" aria-label="è¶³çƒé¢„æµ‹ç³»ç»Ÿæ–‡æ¡£" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            è¶³çƒé¢„æµ‹ç³»ç»Ÿæ–‡æ¡£
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MLæ¨¡å‹æŒ‡å—
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="åˆ‡æ¢è‡³æ·±è‰²æ¨¡å¼"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="åˆ‡æ¢è‡³æ·±è‰²æ¨¡å¼" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="åˆ‡æ¢è‡³æ·±è‰²æ¨¡å¼"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="åˆ‡æ¢è‡³æ·±è‰²æ¨¡å¼" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="åˆ‡æ¢è‡³æµ…è‰²æ¨¡å¼"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="åˆ‡æ¢è‡³æµ…è‰²æ¨¡å¼" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="æœç´¢" placeholder="æœç´¢" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="æŸ¥æ‰¾">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="åˆ†äº«" aria-label="åˆ†äº«" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="æ¸…ç©ºå½“å‰å†…å®¹" aria-label="æ¸…ç©ºå½“å‰å†…å®¹" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            æ­£åœ¨åˆå§‹åŒ–æœç´¢å¼•æ“
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/your-org/football-prediction" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    football-prediction/docs
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="æ ‡ç­¾" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.md" class="md-tabs__link">
        
  
    
  
  é¦–é¡µ

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../how-to/QUICKSTART_TOOLS/" class="md-tabs__link">
          
  
    
  
  å¿«é€Ÿå¼€å§‹

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../architecture/ARCHITECTURE/" class="md-tabs__link">
          
  
    
  
  æ¶æ„è®¾è®¡

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../reference/API_REFERENCE/" class="md-tabs__link">
          
  
    
  
  APIå‚è€ƒ

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../testing/TEST_IMPROVEMENT_GUIDE/" class="md-tabs__link">
          
  
    
  
  æµ‹è¯•æŒ‡å—

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../ops/PRODUCTION_READINESS_PLAN/" class="md-tabs__link">
          
  
    
  
  è¿ç»´éƒ¨ç½²

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
    
  
  æœºå™¨å­¦ä¹ 

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../security/SECURITY_POLICY.md" class="md-tabs__link">
          
  
    
  
  å®‰å…¨é…ç½®

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../project/CONTRIBUTING.md" class="md-tabs__link">
          
  
    
  
  é¡¹ç›®ç®¡ç†

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../AI_DEVELOPMENT_DOCUMENTATION_RULES.md" class="md-tabs__link">
          
  
    
  
  å‚è€ƒèµ„æ–™

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    

  <!-- å…¬å‘Šæ é…ç½® (æš‚æ—¶æ³¨é‡Šæ‰) -->
  <!--
  
  -->

    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="å¯¼èˆªæ " data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="è¶³çƒé¢„æµ‹ç³»ç»Ÿæ–‡æ¡£" class="md-nav__button md-logo" aria-label="è¶³çƒé¢„æµ‹ç³»ç»Ÿæ–‡æ¡£" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    è¶³çƒé¢„æµ‹ç³»ç»Ÿæ–‡æ¡£
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/your-org/football-prediction" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    football-prediction/docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    é¦–é¡µ
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../how-to/QUICKSTART_TOOLS/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    å¿«é€Ÿå¼€å§‹
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../architecture/ARCHITECTURE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    æ¶æ„è®¾è®¡
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../reference/API_REFERENCE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    APIå‚è€ƒ
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../testing/TEST_IMPROVEMENT_GUIDE/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    æµ‹è¯•æŒ‡å—
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../ops/PRODUCTION_READINESS_PLAN/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    è¿ç»´éƒ¨ç½²
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    æœºå™¨å­¦ä¹ 
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            æœºå™¨å­¦ä¹ 
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    MLæ¨¡å‹æŒ‡å—
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    MLæ¨¡å‹æŒ‡å—
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="ç›®å½•">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      ç›®å½•
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“‹ æ¦‚è¿°
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ml" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ—ï¸ MLæ¶æ„æ¦‚è§ˆ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ğŸ—ï¸ MLæ¶æ„æ¦‚è§ˆ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      ç³»ç»Ÿæ¶æ„å›¾
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      æ ¸å¿ƒç»„ä»¶
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸš€ å¿«é€Ÿå¼€å§‹
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ğŸš€ å¿«é€Ÿå¼€å§‹">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      ç¯å¢ƒè¦æ±‚
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ§  æ¨¡å‹è®¾è®¡
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ğŸ§  æ¨¡å‹è®¾è®¡">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. é¢„æµ‹æ¨¡å‹åŸºç±»
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. è¶³çƒé¢„æµ‹æ¨¡å‹å®ç°
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ”§ æ¨¡å‹è®­ç»ƒ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ğŸ”§ æ¨¡å‹è®­ç»ƒ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      1. è®­ç»ƒæ•°æ®å‡†å¤‡
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      2. æ¨¡å‹è®­ç»ƒå™¨
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“Š æ¨¡å‹è¯„ä¼°
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ğŸ“Š æ¨¡å‹è¯„ä¼°">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    <span class="md-ellipsis">
      1. è¯„ä¼°æŒ‡æ ‡
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸš€ æ¨¡å‹éƒ¨ç½²
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ğŸš€ æ¨¡å‹éƒ¨ç½²">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    <span class="md-ellipsis">
      1. æ¨¡å‹æœåŠ¡åŒ–
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“ˆ æ¨¡å‹ç›‘æ§
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ğŸ“ˆ æ¨¡å‹ç›‘æ§">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_4" class="md-nav__link">
    <span class="md-ellipsis">
      1. æ€§èƒ½ç›‘æ§
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“š æœ€ä½³å®è·µ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ğŸ“š æœ€ä½³å®è·µ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_5" class="md-nav__link">
    <span class="md-ellipsis">
      1. æ¨¡å‹å¼€å‘æœ€ä½³å®è·µ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    <span class="md-ellipsis">
      2. éƒ¨ç½²æœ€ä½³å®è·µ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      ğŸ“‹ ç›¸å…³æ–‡æ¡£
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../FEATURE_ENGINEERING.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ç‰¹å¾å·¥ç¨‹
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../MODEL_TRAINING.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    æ¨¡å‹è®­ç»ƒ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../MODEL_EVALUATION.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    æ¨¡å‹è¯„ä¼°
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../security/SECURITY_POLICY.md" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    å®‰å…¨é…ç½®
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../project/CONTRIBUTING.md" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    é¡¹ç›®ç®¡ç†
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../AI_DEVELOPMENT_DOCUMENTATION_RULES.md" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    å‚è€ƒèµ„æ–™
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
  
                  

  
    <a href="https://github.com/your-org/football-prediction/edit/main/docs/ml/ML_MODEL_GUIDE.md" title="ç¼–è¾‘æ­¤é¡µ" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/your-org/football-prediction/raw/main/docs/ml/ML_MODEL_GUIDE.md" title="æŸ¥çœ‹æœ¬é¡µçš„æºä»£ç " class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="_1">æœºå™¨å­¦ä¹ æ¨¡å‹æŒ‡å—<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<h2 id="_2">ğŸ“‹ æ¦‚è¿°<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»è¶³çƒé¢„æµ‹ç³»ç»Ÿä¸­æœºå™¨å­¦ä¹ æ¨¡å‹çš„è®¾è®¡ã€è®­ç»ƒã€éƒ¨ç½²å’Œç»´æŠ¤ã€‚ç³»ç»Ÿé‡‡ç”¨æ¨¡å—åŒ–æ¶æ„ï¼Œæ”¯æŒå¤šç§é¢„æµ‹æ¨¡å‹ï¼Œå¹¶æä¾›å®Œæ•´çš„MLOpsç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p>
<h2 id="ml">ğŸ—ï¸ MLæ¶æ„æ¦‚è§ˆ<a class="headerlink" href="#ml" title="Permanent link">&para;</a></h2>
<h3 id="_3">ç³»ç»Ÿæ¶æ„å›¾<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ML Pipeline                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ•°æ®é¢„å¤„ç†      â”‚   æ¨¡å‹è®­ç»ƒ        â”‚        æ¨¡å‹éƒ¨ç½²               â”‚
â”‚  (Preprocessing) â”‚  (Training)     â”‚     (Deployment)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç‰¹å¾å·¥ç¨‹        â”‚ â€¢ æ¨¡å‹é€‰æ‹©        â”‚ â€¢ æ¨¡å‹æœåŠ¡åŒ–                 â”‚
â”‚ â€¢ æ•°æ®æ¸…æ´—        â”‚ â€¢ è¶…å‚æ•°è°ƒä¼˜      â”‚ â€¢ APIæ¥å£                   â”‚
â”‚ â€¢ ç‰¹å¾é€‰æ‹©        â”‚ â€¢ äº¤å‰éªŒè¯        â”‚ â€¢ æ‰¹é‡é¢„æµ‹                   â”‚
â”‚ â€¢ æ•°æ®åˆ†å‰²        â”‚ â€¢ æ¨¡å‹è¯„ä¼°        â”‚ â€¢ å®æ—¶é¢„æµ‹                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MLOpså±‚                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ¨¡å‹ç›‘æ§        â”‚   å®éªŒç®¡ç†        â”‚        æ¨¡å‹ç‰ˆæœ¬               â”‚
â”‚  (Monitoring)    â”‚ (Experiments)   â”‚    (Versioning)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ æ€§èƒ½ç›‘æ§        â”‚ â€¢ MLflow         â”‚ â€¢ æ¨¡å‹æ³¨å†Œè¡¨                 â”‚
â”‚ â€¢ æ¼‚ç§»æ£€æµ‹        â”‚ â€¢ å®éªŒè·Ÿè¸ª        â”‚ â€¢ ç‰ˆæœ¬æ§åˆ¶                   â”‚
â”‚ â€¢ å‘Šè­¦é€šçŸ¥        â”‚ â€¢ å‚æ•°è®°å½•        â”‚ â€¢ å›æ»šæœºåˆ¶                   â”‚
â”‚ â€¢ è‡ªåŠ¨é‡è®­ç»ƒ      â”‚ â€¢ ç»“æœå¯¹æ¯”        â”‚ â€¢ A/Bæµ‹è¯•                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>
<h3 id="_4">æ ¸å¿ƒç»„ä»¶<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>ç»„ä»¶</th>
<th>åŠŸèƒ½</th>
<th>æŠ€æœ¯æ ˆ</th>
<th>çŠ¶æ€</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>PredictionModel</strong></td>
<td>é¢„æµ‹æ¨¡å‹åŸºç±»</td>
<td>Python, scikit-learn</td>
<td>âœ… è¿è¡Œä¸­</td>
</tr>
<tr>
<td><strong>FootballPredictionModel</strong></td>
<td>è¶³çƒä¸“ç”¨é¢„æµ‹æ¨¡å‹</td>
<td>éšæœºæ£®æ—, XGBoost</td>
<td>âœ… è¿è¡Œä¸­</td>
</tr>
<tr>
<td><strong>BaselineModelTrainer</strong></td>
<td>åŸºå‡†æ¨¡å‹è®­ç»ƒå™¨</td>
<td>MLflow, Optuna</td>
<td>ğŸš§ å¼€å‘ä¸­</td>
</tr>
<tr>
<td><strong>FeatureProcessor</strong></td>
<td>ç‰¹å¾å¤„ç†å™¨</td>
<td>pandas, numpy</td>
<td>âœ… è¿è¡Œä¸­</td>
</tr>
<tr>
<td><strong>ModelMonitor</strong></td>
<td>æ¨¡å‹ç›‘æ§</td>
<td>Prometheus, Grafana</td>
<td>âœ… è¿è¡Œä¸­</td>
</tr>
</tbody>
</table>
<h2 id="_5">ğŸš€ å¿«é€Ÿå¼€å§‹<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<h3 id="_6">ç¯å¢ƒè¦æ±‚<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Python</strong>: 3.11+</li>
<li><strong>æœºå™¨å­¦ä¹ åº“</strong>: scikit-learn, XGBoost</li>
<li><strong>å®éªŒè·Ÿè¸ª</strong>: MLflow (å¯é€‰)</li>
<li><strong>æ•°æ®å­˜å‚¨</strong>: PostgreSQL, Redis</li>
</ul>
<h3 id="5">5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹<a class="headerlink" href="#5" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 1. å®‰è£…MLä¾èµ–</span>
pip<span class="w"> </span>install<span class="w"> </span>scikit-learn<span class="w"> </span>xgboost<span class="w"> </span>pandas<span class="w"> </span>numpy

<span class="c1"># 2. ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œé¢„æµ‹</span>
python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span>
<span class="s2">from src.models.prediction_model import FootballPredictionModel</span>
<span class="s2">model = FootballPredictionModel()</span>
<span class="s2">result = model.predict_match(&#39;Team A&#39;, &#39;Team B&#39;, {})</span>
<span class="s2">print(result)</span>
<span class="s2">&quot;</span>

<span class="c1"># 3. è®­ç»ƒè‡ªå®šä¹‰æ¨¡å‹</span>
python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span>
<span class="s2">from src.models.prediction_model import FootballPredictionModel</span>
<span class="s2">import pandas as pd</span>

<span class="s2"># å‡†å¤‡è®­ç»ƒæ•°æ®</span>
<span class="s2">X = pd.DataFrame({&#39;feature1&#39;: [1, 2, 3], &#39;feature2&#39;: [4, 5, 6]})</span>
<span class="s2">y = pd.Series([0, 1, 0])</span>

<span class="s2">model = FootballPredictionModel(&#39;my_model&#39;)</span>
<span class="s2">metrics = model.train(X, y)</span>
<span class="s2">print(f&#39;è®­ç»ƒå®Œæˆï¼Œå‡†ç¡®ç‡: {metrics[\&quot;accuracy\&quot;]:.3f}&#39;)</span>
<span class="s2">&quot;</span>

<span class="c1"># 4. å¯åŠ¨MLå®éªŒè·Ÿè¸ª (å¯é€‰)</span>
mlflow<span class="w"> </span>server<span class="w"> </span>--host<span class="w"> </span><span class="m">0</span>.0.0.0<span class="w"> </span>--port<span class="w"> </span><span class="m">5000</span>
</code></pre></div>
<h2 id="_7">ğŸ§  æ¨¡å‹è®¾è®¡<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<h3 id="1">1. é¢„æµ‹æ¨¡å‹åŸºç±»<a class="headerlink" href="#1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># src/models/prediction_model.py</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PredictionModel</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;é¢„æµ‹æ¨¡å‹æŠ½è±¡åŸºç±»&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;classification&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        åˆå§‹åŒ–é¢„æµ‹æ¨¡å‹</span>

<span class="sd">        Args:</span>
<span class="sd">            model_name: æ¨¡å‹åç§°</span>
<span class="sd">            model_type: æ¨¡å‹ç±»å‹ (classification/regression)</span>
<span class="sd">            **kwargs: å…¶ä»–å‚æ•°</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span> <span class="o">=</span> <span class="n">model_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ml.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># æ¨¡å‹çŠ¶æ€</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_trained</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_columns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_column</span> <span class="o">=</span> <span class="s2">&quot;result&quot;</span>

        <span class="c1"># å…ƒæ•°æ®</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> prediction model&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hyperparameters&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        è®­ç»ƒæ¨¡å‹</span>

<span class="sd">        Args:</span>
<span class="sd">            X: ç‰¹å¾æ•°æ®</span>
<span class="sd">            y: ç›®æ ‡å˜é‡</span>
<span class="sd">            **kwargs: è®­ç»ƒå‚æ•°</span>

<span class="sd">        Returns:</span>
<span class="sd">            è®­ç»ƒç»“æœæŒ‡æ ‡</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        è¿›è¡Œé¢„æµ‹</span>

<span class="sd">        Args:</span>
<span class="sd">            X: ç‰¹å¾æ•°æ®</span>

<span class="sd">        Returns:</span>
<span class="sd">            é¢„æµ‹ç»“æœ</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">predict_proba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        é¢„æµ‹æ¦‚ç‡ (ä»…åˆ†ç±»æ¨¡å‹)</span>

<span class="sd">        Args:</span>
<span class="sd">            X: ç‰¹å¾æ•°æ®</span>

<span class="sd">        Returns:</span>
<span class="sd">            é¢„æµ‹æ¦‚ç‡</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span> <span class="o">!=</span> <span class="s2">&quot;classification&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;predict_proba only available for classification models&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_trained</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Model must be trained before prediction&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        è¯„ä¼°æ¨¡å‹æ€§èƒ½</span>

<span class="sd">        Args:</span>
<span class="sd">            X: ç‰¹å¾æ•°æ®</span>
<span class="sd">            y: çœŸå®æ ‡ç­¾</span>

<span class="sd">        Returns:</span>
<span class="sd">            è¯„ä¼°æŒ‡æ ‡å­—å…¸</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">roc_auc_score</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_trained</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Model must be trained before evaluation&quot;</span><span class="p">)</span>

        <span class="c1"># è·å–é¢„æµ‹ç»“æœ</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="c1"># è®¡ç®—è¯„ä¼°æŒ‡æ ‡</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span> <span class="o">==</span> <span class="s2">&quot;classification&quot;</span><span class="p">:</span>
            <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
            <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;precision&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;recall&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;f1_score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># å¦‚æœæ˜¯äºŒåˆ†ç±»æˆ–å¤šåˆ†ç±»ï¼Œè®¡ç®—AUC</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">y_proba</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># äºŒåˆ†ç±»</span>
                    <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;auc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_proba</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># å¤šåˆ†ç±»</span>
                    <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;auc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_proba</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s2">&quot;ovr&quot;</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Could not calculate AUC score&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">metrics</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_feature_importance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        è·å–ç‰¹å¾é‡è¦æ€§</span>

<span class="sd">        Returns:</span>
<span class="sd">            ç‰¹å¾é‡è¦æ€§å­—å…¸</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_trained</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Model must be trained before getting feature importance&quot;</span><span class="p">)</span>

        <span class="n">importance</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;feature_importances_&quot;</span><span class="p">):</span>
            <span class="c1"># æ ‘æ¨¡å‹ç­‰æ”¯æŒç‰¹å¾é‡è¦æ€§</span>
            <span class="k">for</span> <span class="n">feature</span><span class="p">,</span> <span class="n">importance_score</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">):</span>
                <span class="n">importance</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">importance_score</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;coef_&quot;</span><span class="p">):</span>
            <span class="c1"># çº¿æ€§æ¨¡å‹ç­‰</span>
            <span class="n">coef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">coef_</span>
            <span class="k">if</span> <span class="n">coef</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">coef</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">coef</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">feature</span><span class="p">,</span> <span class="n">coef_score</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_columns</span><span class="p">,</span> <span class="n">coef</span><span class="p">):</span>
                <span class="n">importance</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coef_score</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ä½¿ç”¨SHAPå€¼æˆ–å…¶ä»–æ–¹æ³• (ç®€åŒ–å®ç°)</span>
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_columns</span><span class="p">:</span>
                <span class="n">importance</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_columns</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">importance</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ä¿å­˜æ¨¡å‹åˆ°æ–‡ä»¶</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path: ä¿å­˜è·¯å¾„</span>

<span class="sd">        Returns:</span>
<span class="sd">            æ˜¯å¦ä¿å­˜æˆåŠŸ</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">joblib</span>

            <span class="n">model_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
                <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
                <span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span><span class="p">,</span>
                <span class="s2">&quot;is_trained&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_trained</span><span class="p">,</span>
                <span class="s2">&quot;feature_columns&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_columns</span><span class="p">,</span>
                <span class="s2">&quot;target_column&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_column</span><span class="p">,</span>
                <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model_data</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model saved to: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to save model: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ä»æ–‡ä»¶åŠ è½½æ¨¡å‹</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path: æ¨¡å‹æ–‡ä»¶è·¯å¾„</span>

<span class="sd">        Returns:</span>
<span class="sd">            æ˜¯å¦åŠ è½½æˆåŠŸ</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">joblib</span>

            <span class="n">model_data</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span> <span class="o">=</span> <span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;model_type&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_trained</span> <span class="o">=</span> <span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;is_trained&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feature_columns</span> <span class="o">=</span> <span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;feature_columns&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_column</span> <span class="o">=</span> <span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;target_column&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model loaded from: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load model: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
<h3 id="2">2. è¶³çƒé¢„æµ‹æ¨¡å‹å®ç°<a class="headerlink" href="#2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># src/models/football_prediction_model.py</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.prediction_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">PredictionModel</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PredictionType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;é¢„æµ‹ç±»å‹æšä¸¾&quot;&quot;&quot;</span>
    <span class="n">MATCH_RESULT</span> <span class="o">=</span> <span class="s2">&quot;match_result&quot;</span>           <span class="c1"># æ¯”èµ›ç»“æœ</span>
    <span class="n">OVER_UNDER</span> <span class="o">=</span> <span class="s2">&quot;over_under&quot;</span>              <span class="c1"># å¤§å°çƒ</span>
    <span class="n">CORRECT_SCORE</span> <span class="o">=</span> <span class="s2">&quot;correct_score&quot;</span>        <span class="c1"># æ­£ç¡®æ¯”åˆ†</span>
    <span class="n">BOTH_TEAMS_SCORE</span> <span class="o">=</span> <span class="s2">&quot;both_teams_score&quot;</span>  <span class="c1"># åŒæ–¹éƒ½è¿›çƒ</span>

<span class="k">class</span><span class="w"> </span><span class="nc">FootballPredictionModel</span><span class="p">(</span><span class="n">PredictionModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;è¶³çƒæ¯”èµ›é¢„æµ‹æ¨¡å‹&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;football_predictor&quot;</span><span class="p">,</span>
        <span class="n">prediction_type</span><span class="p">:</span> <span class="n">PredictionType</span> <span class="o">=</span> <span class="n">PredictionType</span><span class="o">.</span><span class="n">MATCH_RESULT</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        åˆå§‹åŒ–è¶³çƒé¢„æµ‹æ¨¡å‹</span>

<span class="sd">        Args:</span>
<span class="sd">            model_name: æ¨¡å‹åç§°</span>
<span class="sd">            prediction_type: é¢„æµ‹ç±»å‹</span>
<span class="sd">            **kwargs: å…¶ä»–å‚æ•°</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="s2">&quot;classification&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_type</span> <span class="o">=</span> <span class="n">prediction_type</span>

        <span class="c1"># æ ¹æ®é¢„æµ‹ç±»å‹è®¾ç½®ç›®æ ‡ç±»åˆ«</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_target_classes</span><span class="p">()</span>

        <span class="c1"># æ¨¡å‹è¶…å‚æ•°</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;n_estimators&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;n_estimators&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
            <span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_depth&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
            <span class="s2">&quot;min_samples_split&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;min_samples_split&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="s2">&quot;min_samples_leaf&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;min_samples_leaf&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="s2">&quot;random_state&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;random_state&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_target_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è®¾ç½®ç›®æ ‡ç±»åˆ«&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_type</span> <span class="o">==</span> <span class="n">PredictionType</span><span class="o">.</span><span class="n">MATCH_RESULT</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_classes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;home_win&quot;</span><span class="p">,</span> <span class="s2">&quot;draw&quot;</span><span class="p">,</span> <span class="s2">&quot;away_win&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_type</span> <span class="o">==</span> <span class="n">PredictionType</span><span class="o">.</span><span class="n">OVER_UNDER</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_classes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;under&quot;</span><span class="p">,</span> <span class="s2">&quot;over&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_type</span> <span class="o">==</span> <span class="n">PredictionType</span><span class="o">.</span><span class="n">BOTH_TEAMS_SCORE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_classes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;no&quot;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_type</span> <span class="o">==</span> <span class="n">PredictionType</span><span class="o">.</span><span class="n">CORRECT_SCORE</span><span class="p">:</span>
            <span class="c1"># å¸¸è§æ¯”åˆ†</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_classes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;1-0&quot;</span><span class="p">,</span> <span class="s2">&quot;2-0&quot;</span><span class="p">,</span> <span class="s2">&quot;2-1&quot;</span><span class="p">,</span> <span class="s2">&quot;1-1&quot;</span><span class="p">,</span> <span class="s2">&quot;0-0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;0-1&quot;</span><span class="p">,</span> <span class="s2">&quot;0-2&quot;</span><span class="p">,</span> <span class="s2">&quot;1-2&quot;</span><span class="p">,</span> <span class="s2">&quot;3-0&quot;</span><span class="p">,</span> <span class="s2">&quot;0-3&quot;</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported prediction type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        è®­ç»ƒè¶³çƒé¢„æµ‹æ¨¡å‹</span>

<span class="sd">        Args:</span>
<span class="sd">            X: ç‰¹å¾æ•°æ®</span>
<span class="sd">            y: ç›®æ ‡å˜é‡</span>
<span class="sd">            **kwargs: è®­ç»ƒå‚æ•°</span>

<span class="sd">        Returns:</span>
<span class="sd">            è®­ç»ƒç»“æœæŒ‡æ ‡</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestClassifier</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">cross_val_score</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">LabelEncoder</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> model with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples&quot;</span><span class="p">)</span>

        <span class="c1"># ç‰¹å¾å¤„ç†</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

        <span class="c1"># æ ‡ç­¾ç¼–ç </span>
        <span class="n">label_encoder</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
        <span class="n">y_encoded</span> <span class="o">=</span> <span class="n">label_encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="c1"># ä¿å­˜æ ‡ç­¾ç¼–ç å™¨</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_encoder</span> <span class="o">=</span> <span class="n">label_encoder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">label_encoder</span><span class="o">.</span><span class="n">classes_</span><span class="p">,</span> <span class="n">label_encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">label_encoder</span><span class="o">.</span><span class="n">classes_</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reverse_label_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">label_encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">label_encoder</span><span class="o">.</span><span class="n">classes_</span><span class="p">),</span> <span class="n">label_encoder</span><span class="o">.</span><span class="n">classes_</span><span class="p">))</span>

        <span class="c1"># åˆ›å»ºå¹¶è®­ç»ƒæ¨¡å‹</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameters</span><span class="p">)</span>

        <span class="c1"># äº¤å‰éªŒè¯è¯„ä¼°</span>
        <span class="n">cv_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y_encoded</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>

        <span class="c1"># è®­ç»ƒæœ€ç»ˆæ¨¡å‹</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y_encoded</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_trained</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># è®¡ç®—è®­ç»ƒæŒ‡æ ‡</span>
        <span class="n">train_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># æ·»åŠ äº¤å‰éªŒè¯ç»“æœ</span>
        <span class="n">train_metrics</span><span class="p">[</span><span class="s2">&quot;cv_mean_accuracy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cv_scores</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">train_metrics</span><span class="p">[</span><span class="s2">&quot;cv_std_accuracy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cv_scores</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>

        <span class="c1"># æ›´æ–°å…ƒæ•°æ®</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s2">&quot;last_trained&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s2">&quot;training_samples&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">),</span>
            <span class="s2">&quot;feature_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_columns</span><span class="p">),</span>
            <span class="s2">&quot;prediction_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;label_mapping&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_mapping</span><span class="p">,</span>
            <span class="s2">&quot;metrics&quot;</span><span class="p">:</span> <span class="n">train_metrics</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Model trained successfully. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Accuracy: </span><span class="si">{</span><span class="n">train_metrics</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;CV Accuracy: </span><span class="si">{</span><span class="n">train_metrics</span><span class="p">[</span><span class="s1">&#39;cv_mean_accuracy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> Â± </span><span class="si">{</span><span class="n">train_metrics</span><span class="p">[</span><span class="s1">&#39;cv_std_accuracy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">train_metrics</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        é¢„æµ‹æ¯”èµ›ç»“æœ</span>

<span class="sd">        Args:</span>
<span class="sd">            X: ç‰¹å¾æ•°æ®</span>

<span class="sd">        Returns:</span>
<span class="sd">            é¢„æµ‹ç»“æœ</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_trained</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Model must be trained before prediction&quot;</span><span class="p">)</span>

        <span class="n">predictions_encoded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="c1"># è½¬æ¢å›åŸå§‹æ ‡ç­¾</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_label_mapping</span><span class="p">[</span><span class="n">pred</span><span class="p">]</span> <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">predictions_encoded</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">predict_match</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">home_team</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">away_team</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">return_probabilities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        é¢„æµ‹å•åœºæ¯”èµ›ç»“æœ</span>

<span class="sd">        Args:</span>
<span class="sd">            home_team: ä¸»é˜Ÿåç§°</span>
<span class="sd">            away_team: å®¢é˜Ÿåç§°</span>
<span class="sd">            features: ç‰¹å¾å­—å…¸</span>
<span class="sd">            return_probabilities: æ˜¯å¦è¿”å›æ¦‚ç‡</span>

<span class="sd">        Returns:</span>
<span class="sd">            é¢„æµ‹ç»“æœå­—å…¸</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_trained</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Model must be trained before prediction&quot;</span><span class="p">)</span>

        <span class="c1"># è½¬æ¢ç‰¹å¾ä¸ºDataFrame</span>
        <span class="n">feature_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">features</span><span class="p">])</span>

        <span class="c1"># ç¡®ä¿ç‰¹å¾åˆ—é¡ºåºæ­£ç¡®</span>
        <span class="n">feature_df</span> <span class="o">=</span> <span class="n">feature_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_columns</span><span class="p">]</span>

        <span class="c1"># é¢„æµ‹</span>
        <span class="n">prediction_encoded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">feature_df</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_label_mapping</span><span class="p">[</span><span class="n">prediction_encoded</span><span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;home_team&quot;</span><span class="p">:</span> <span class="n">home_team</span><span class="p">,</span>
            <span class="s2">&quot;away_team&quot;</span><span class="p">:</span> <span class="n">away_team</span><span class="p">,</span>
            <span class="s2">&quot;prediction&quot;</span><span class="p">:</span> <span class="n">prediction</span><span class="p">,</span>
            <span class="s2">&quot;prediction_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;features_used&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
            <span class="s2">&quot;prediction_time&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
        <span class="p">}</span>

        <span class="c1"># æ·»åŠ æ¦‚ç‡ä¿¡æ¯</span>
        <span class="k">if</span> <span class="n">return_probabilities</span><span class="p">:</span>
            <span class="n">probabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">feature_df</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># æ„å»ºæ¦‚ç‡å­—å…¸</span>
            <span class="n">prob_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">class_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_encoder</span><span class="o">.</span><span class="n">classes_</span><span class="p">):</span>
                <span class="n">prob_dict</span><span class="p">[</span><span class="n">class_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">probabilities</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;probabilities&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob_dict</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;confidence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">probabilities</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">batch_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        æ‰¹é‡é¢„æµ‹æ¯”èµ›ç»“æœ</span>

<span class="sd">        Args:</span>
<span class="sd">            matches: æ¯”èµ›åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ åŒ…å« home_team, away_team, features</span>

<span class="sd">        Returns:</span>
<span class="sd">            é¢„æµ‹ç»“æœåˆ—è¡¨</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_match</span><span class="p">(</span>
                    <span class="n">home_team</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;home_team&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">away_team</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;away_team&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">features</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="p">{}),</span>
                    <span class="n">return_probabilities</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to predict match: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># æ·»åŠ é”™è¯¯ç»“æœ</span>
                <span class="n">error_result</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;home_team&quot;</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;home_team&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;away_team&quot;</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;away_team&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                    <span class="s2">&quot;prediction&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_result</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">explain_prediction</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">home_team</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">away_team</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">top_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        è§£é‡Šé¢„æµ‹ç»“æœ</span>

<span class="sd">        Args:</span>
<span class="sd">            home_team: ä¸»é˜Ÿåç§°</span>
<span class="sd">            away_team: å®¢é˜Ÿåç§°</span>
<span class="sd">            features: ç‰¹å¾å­—å…¸</span>
<span class="sd">            top_features: è¿”å›æœ€é‡è¦çš„ç‰¹å¾æ•°é‡</span>

<span class="sd">        Returns:</span>
<span class="sd">            è§£é‡Šç»“æœ</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># è·å–é¢„æµ‹ç»“æœ</span>
        <span class="n">prediction_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_match</span><span class="p">(</span><span class="n">home_team</span><span class="p">,</span> <span class="n">away_team</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span>

        <span class="c1"># è·å–ç‰¹å¾é‡è¦æ€§</span>
        <span class="n">feature_importance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feature_importance</span><span class="p">()</span>

        <span class="c1"># è·å–å½“å‰ç‰¹å¾çš„é‡è¦æ€§</span>
        <span class="n">current_features_importance</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">feature</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">features</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">feature_importance</span><span class="p">:</span>
                <span class="n">current_features_importance</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
                    <span class="s2">&quot;importance&quot;</span><span class="p">:</span> <span class="n">feature_importance</span><span class="p">[</span><span class="n">feature</span><span class="p">],</span>
                <span class="p">}</span>

        <span class="c1"># æ’åºå¹¶å–å‰Nä¸ªæœ€é‡è¦çš„ç‰¹å¾</span>
        <span class="n">sorted_features</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">current_features_importance</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;importance&quot;</span><span class="p">],</span>
            <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)[:</span><span class="n">top_features</span><span class="p">]</span>

        <span class="n">explanation</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;match&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">home_team</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">away_team</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;prediction&quot;</span><span class="p">:</span> <span class="n">prediction_result</span><span class="p">[</span><span class="s2">&quot;prediction&quot;</span><span class="p">],</span>
            <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="n">prediction_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;confidence&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;top_features&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">feature</span><span class="p">,</span>
                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;importance&quot;</span><span class="p">:</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;importance&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;impact&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_feature_impact</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">feature</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">sorted_features</span>
            <span class="p">],</span>
            <span class="s2">&quot;model_info&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
                <span class="s2">&quot;prediction_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="s2">&quot;feature_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_columns</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">explanation</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_feature_impact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è®¡ç®—ç‰¹å¾å¯¹é¢„æµ‹çš„å½±å“&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;æ­£å‘å½±å“ (+</span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;è´Ÿå‘å½±å“ (</span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;ä¸­æ€§å½±å“ (0.00)&quot;</span>
</code></pre></div>
<h2 id="_8">ğŸ”§ æ¨¡å‹è®­ç»ƒ<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<h3 id="1_1">1. è®­ç»ƒæ•°æ®å‡†å¤‡<a class="headerlink" href="#1_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># src/ml/data_preparation.py</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">LabelEncoder</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="k">class</span><span class="w"> </span><span class="nc">FootballDataPreparer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;è¶³çƒæ•°æ®é¢„å¤„ç†å™¨&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_encoders</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_columns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">prepare_match_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">matches_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">target_column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;result&quot;</span><span class="p">,</span>
        <span class="n">test_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
        <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">42</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        å‡†å¤‡æ¯”èµ›æ•°æ®ç”¨äºè®­ç»ƒ</span>

<span class="sd">        Args:</span>
<span class="sd">            matches_df: æ¯”èµ›æ•°æ®DataFrame</span>
<span class="sd">            target_column: ç›®æ ‡åˆ—å</span>
<span class="sd">            test_size: æµ‹è¯•é›†æ¯”ä¾‹</span>
<span class="sd">            random_state: éšæœºç§å­</span>

<span class="sd">        Returns:</span>
<span class="sd">            (X_train, y_train, X_test, y_test)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Preparing data with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matches_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> matches&quot;</span><span class="p">)</span>

        <span class="c1"># æ•°æ®æ¸…æ´—</span>
        <span class="n">cleaned_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_data</span><span class="p">(</span><span class="n">matches_df</span><span class="p">)</span>

        <span class="c1"># ç‰¹å¾å·¥ç¨‹</span>
        <span class="n">features_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engineer_features</span><span class="p">(</span><span class="n">cleaned_df</span><span class="p">)</span>

        <span class="c1"># å‡†å¤‡ç‰¹å¾å’Œç›®æ ‡</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">features_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">target_column</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">features_df</span><span class="p">[</span><span class="n">target_column</span><span class="p">]</span>

        <span class="c1"># ç¼–ç åˆ†ç±»å˜é‡</span>
        <span class="n">X_encoded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encode_categorical_features</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="c1"># ç‰¹å¾æ ‡å‡†åŒ–</span>
        <span class="n">X_scaled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_features</span><span class="p">(</span><span class="n">X_encoded</span><span class="p">)</span>

        <span class="c1"># åˆ†å‰²æ•°æ®</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
            <span class="n">X_scaled</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">feature_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data prepared: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span><span class="si">}</span><span class="s2"> training, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="si">}</span><span class="s2"> testing samples&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_clean_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ•°æ®æ¸…æ´—&quot;&quot;&quot;</span>
        <span class="c1"># ç§»é™¤ç¼ºå¤±å€¼è¿‡å¤šçš„è¡Œ</span>
        <span class="n">df_clean</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">thresh</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.7</span><span class="p">)</span>

        <span class="c1"># å¡«å……ç¼ºå¤±å€¼</span>
        <span class="n">numeric_columns</span> <span class="o">=</span> <span class="n">df_clean</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
        <span class="n">df_clean</span><span class="p">[</span><span class="n">numeric_columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="n">numeric_columns</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="n">numeric_columns</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">())</span>

        <span class="n">categorical_columns</span> <span class="o">=</span> <span class="n">df_clean</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">categorical_columns</span><span class="p">:</span>
            <span class="n">df_clean</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df_clean</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_engineer_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç‰¹å¾å·¥ç¨‹&quot;&quot;&quot;</span>
        <span class="n">df_features</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># ä¸»åœºä¼˜åŠ¿ç‰¹å¾</span>
        <span class="k">if</span> <span class="s1">&#39;home_team&#39;</span> <span class="ow">in</span> <span class="n">df_features</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;away_team&#39;</span> <span class="ow">in</span> <span class="n">df_features</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">df_features</span><span class="p">[</span><span class="s1">&#39;is_home_favorite&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">df_features</span><span class="p">[</span><span class="s1">&#39;home_team_rating&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">df_features</span><span class="p">[</span><span class="s1">&#39;away_team_rating&#39;</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1"># æœ€è¿‘è¡¨ç°ç‰¹å¾</span>
        <span class="k">if</span> <span class="s1">&#39;home_team_recent_form&#39;</span> <span class="ow">in</span> <span class="n">df_features</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">df_features</span><span class="p">[</span><span class="s1">&#39;home_team_form_trend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">df_features</span><span class="p">[</span><span class="s1">&#39;home_team_recent_form&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="c1"># å†å²äº¤é”‹ç‰¹å¾</span>
        <span class="k">if</span> <span class="s1">&#39;head_to_head_wins&#39;</span> <span class="ow">in</span> <span class="n">df_features</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">df_features</span><span class="p">[</span><span class="s1">&#39;head_to_head_win_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">df_features</span><span class="p">[</span><span class="s1">&#39;head_to_head_wins&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df_features</span><span class="p">[</span><span class="s1">&#39;head_to_head_matches&#39;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">df_features</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_encode_categorical_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç¼–ç åˆ†ç±»ç‰¹å¾&quot;&quot;&quot;</span>
        <span class="n">X_encoded</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">categorical_columns</span> <span class="o">=</span> <span class="n">X_encoded</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">categorical_columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_encoders</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label_encoders</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
                <span class="n">X_encoded</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_encoders</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_encoded</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># å¤„ç†æœªè§è¿‡çš„ç±»åˆ«</span>
                <span class="n">known_classes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_encoders</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">classes_</span><span class="p">)</span>
                <span class="n">X_encoded</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_encoded</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">known_classes</span> <span class="k">else</span> <span class="s1">&#39;unknown&#39;</span>
                <span class="p">)</span>

                <span class="c1"># å¦‚æœæœ‰æ–°ç±»åˆ«ï¼Œé‡æ–°æ‹Ÿåˆç¼–ç å™¨</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">X_encoded</span><span class="p">[</span><span class="n">col</span><span class="p">])</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">known_classes</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">label_encoders</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">classes_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">label_encoders</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">classes_</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span>
                    <span class="p">)</span>

                <span class="n">X_encoded</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_encoders</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_encoded</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">X_encoded</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_scale_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç‰¹å¾æ ‡å‡†åŒ–&quot;&quot;&quot;</span>
        <span class="n">X_scaled</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">numeric_columns</span> <span class="o">=</span> <span class="n">X_scaled</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_columns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># é¦–æ¬¡æ‹Ÿåˆ</span>
            <span class="n">X_scaled</span><span class="p">[</span><span class="n">numeric_columns</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">[</span><span class="n">numeric_columns</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">X_scaled</span><span class="p">[</span><span class="n">numeric_columns</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">[</span><span class="n">numeric_columns</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">X_scaled</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">prepare_prediction_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">match_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ä¸ºå•åœºæ¯”èµ›é¢„æµ‹å‡†å¤‡ç‰¹å¾</span>

<span class="sd">        Args:</span>
<span class="sd">            match_data: æ¯”èµ›æ•°æ®å­—å…¸</span>

<span class="sd">        Returns:</span>
<span class="sd">            é¢„å¤„ç†åçš„ç‰¹å¾DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">match_data</span><span class="p">])</span>
        <span class="n">df_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engineer_features</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df_encoded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encode_categorical_features</span><span class="p">(</span><span class="n">df_features</span><span class="p">)</span>
        <span class="n">df_scaled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_features</span><span class="p">(</span><span class="n">df_encoded</span><span class="p">)</span>

        <span class="c1"># ç¡®ä¿ç‰¹å¾é¡ºåºä¸€è‡´</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_columns</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_columns</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df_scaled</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">df_scaled</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">df_scaled</span> <span class="o">=</span> <span class="n">df_scaled</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_columns</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">df_scaled</span>
</code></pre></div>
<h3 id="2_1">2. æ¨¡å‹è®­ç»ƒå™¨<a class="headerlink" href="#2_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># src/ml/model_trainer.py</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">cross_val_score</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">mlflow</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">mlflow.sklearn</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">..models.football_prediction_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">FootballPredictionModel</span><span class="p">,</span> <span class="n">PredictionType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.data_preparation</span><span class="w"> </span><span class="kn">import</span> <span class="n">FootballDataPreparer</span>

<span class="k">class</span><span class="w"> </span><span class="nc">FootballModelTrainer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;è¶³çƒæ¨¡å‹è®­ç»ƒå™¨&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        åˆå§‹åŒ–è®­ç»ƒå™¨</span>

<span class="sd">        Args:</span>
<span class="sd">            config: è®­ç»ƒé…ç½®</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_preparer</span> <span class="o">=</span> <span class="n">FootballDataPreparer</span><span class="p">()</span>

        <span class="c1"># MLflowé…ç½®</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mlflow_enabled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mlflow_enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlflow_enabled</span><span class="p">:</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mlflow_tracking_uri&quot;</span><span class="p">,</span> <span class="s2">&quot;http://localhost:5000&quot;</span><span class="p">))</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mlflow_experiment&quot;</span><span class="p">,</span> <span class="s2">&quot;football-prediction&quot;</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">train_match_result_model</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">matches_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">target_column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;result&quot;</span><span class="p">,</span>
        <span class="n">hyperparameter_tuning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FootballPredictionModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        è®­ç»ƒæ¯”èµ›ç»“æœé¢„æµ‹æ¨¡å‹</span>

<span class="sd">        Args:</span>
<span class="sd">            matches_df: æ¯”èµ›æ•°æ®</span>
<span class="sd">            target_column: ç›®æ ‡åˆ—å</span>
<span class="sd">            hyperparameter_tuning: æ˜¯å¦è¿›è¡Œè¶…å‚æ•°è°ƒä¼˜</span>

<span class="sd">        Returns:</span>
<span class="sd">            è®­ç»ƒå¥½çš„æ¨¡å‹</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting match result model training&quot;</span><span class="p">)</span>

        <span class="c1"># å‡†å¤‡æ•°æ®</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_preparer</span><span class="o">.</span><span class="n">prepare_match_data</span><span class="p">(</span>
            <span class="n">matches_df</span><span class="p">,</span> <span class="n">target_column</span>
        <span class="p">)</span>

        <span class="c1"># åˆ›å»ºæ¨¡å‹</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">FootballPredictionModel</span><span class="p">(</span>
            <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;match_result_predictor&quot;</span><span class="p">,</span>
            <span class="n">prediction_type</span><span class="o">=</span><span class="n">PredictionType</span><span class="o">.</span><span class="n">MATCH_RESULT</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlflow_enabled</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;match_result_</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">_%H%M%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_train_with_mlflow</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">hyperparameter_tuning</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_train_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">hyperparameter_tuning</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_train_model</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">FootballPredictionModel</span><span class="p">,</span>
        <span class="n">X_train</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">y_train</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
        <span class="n">X_test</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">y_test</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
        <span class="n">hyperparameter_tuning</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FootballPredictionModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è®­ç»ƒæ¨¡å‹&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">hyperparameter_tuning</span><span class="p">:</span>
            <span class="c1"># è¶…å‚æ•°è°ƒä¼˜</span>
            <span class="n">best_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameter_tuning</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
            <span class="n">model</span><span class="o">.</span><span class="n">hyperparameters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">best_params</span><span class="p">)</span>

        <span class="c1"># è®­ç»ƒæ¨¡å‹</span>
        <span class="n">train_metrics</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

        <span class="c1"># è¯„ä¼°æ¨¡å‹</span>
        <span class="n">test_metrics</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>

        <span class="c1"># è®°å½•ç»“æœ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training completed. Test accuracy: </span><span class="si">{</span><span class="n">test_metrics</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_training_report</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_metrics</span><span class="p">,</span> <span class="n">test_metrics</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">model</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_train_with_mlflow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">FootballPredictionModel</span><span class="p">,</span>
        <span class="n">X_train</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">y_train</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
        <span class="n">X_test</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">y_test</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
        <span class="n">hyperparameter_tuning</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FootballPredictionModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ä½¿ç”¨MLflowè®­ç»ƒæ¨¡å‹&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">hyperparameter_tuning</span><span class="p">:</span>
            <span class="n">best_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hyperparameter_tuning</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
            <span class="n">model</span><span class="o">.</span><span class="n">hyperparameters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">best_params</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">best_params</span><span class="p">)</span>

        <span class="c1"># è®°å½•å‚æ•°</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">({</span>
            <span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">model_type</span><span class="p">,</span>
            <span class="s2">&quot;prediction_type&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">prediction_type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;training_samples&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span>
            <span class="s2">&quot;test_samples&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">),</span>
            <span class="s2">&quot;feature_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
        <span class="p">})</span>

        <span class="c1"># è®­ç»ƒæ¨¡å‹</span>
        <span class="n">train_metrics</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

        <span class="c1"># è¯„ä¼°æ¨¡å‹</span>
        <span class="n">test_metrics</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>

        <span class="c1"># è®°å½•æŒ‡æ ‡</span>
        <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_value</span> <span class="ow">in</span> <span class="n">train_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metric_value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;train_</span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">metric_value</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_value</span> <span class="ow">in</span> <span class="n">test_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metric_value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;test_</span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">metric_value</span><span class="p">)</span>

        <span class="c1"># è®°å½•æ¨¡å‹</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>

        <span class="c1"># è®°å½•ç‰¹å¾é‡è¦æ€§</span>
        <span class="n">feature_importance</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_feature_importance</span><span class="p">()</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_dict</span><span class="p">(</span><span class="n">feature_importance</span><span class="p">,</span> <span class="s2">&quot;feature_importance.json&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training completed with MLflow. Test accuracy: </span><span class="si">{</span><span class="n">test_metrics</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">model</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_hyperparameter_tuning</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è¶…å‚æ•°è°ƒä¼˜&quot;&quot;&quot;</span>

        <span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>
            <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
            <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
            <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
            <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="s1">&#39;log2&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
        <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
            <span class="n">rf</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>

        <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best parameters: </span><span class="si">{</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best CV score: </span><span class="si">{</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_training_report</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">FootballPredictionModel</span><span class="p">,</span>
        <span class="n">train_metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">test_metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">X_test</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">y_test</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆè®­ç»ƒæŠ¥å‘Š&quot;&quot;&quot;</span>

        <span class="c1"># é¢„æµ‹æµ‹è¯•é›†</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

        <span class="c1"># ç”Ÿæˆåˆ†ç±»æŠ¥å‘Š</span>
        <span class="n">class_report</span> <span class="o">=</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">output_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># ç”Ÿæˆæ··æ·†çŸ©é˜µ</span>
        <span class="n">conf_matrix</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

        <span class="c1"># è·å–ç‰¹å¾é‡è¦æ€§</span>
        <span class="n">feature_importance</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_feature_importance</span><span class="p">()</span>

        <span class="c1"># åˆ›å»ºæŠ¥å‘Š</span>
        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;model_info&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
                <span class="s2">&quot;prediction_type&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">prediction_type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="s2">&quot;training_time&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_trained&quot;</span><span class="p">),</span>
                <span class="s2">&quot;model_version&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">),</span>
            <span class="p">},</span>
            <span class="s2">&quot;data_info&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;training_samples&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">//</span> <span class="mi">3</span><span class="p">,</span>  <span class="c1"># ä¼°ç®—è®­ç»ƒé›†å¤§å°</span>
                <span class="s2">&quot;test_samples&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">),</span>
                <span class="s2">&quot;feature_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">feature_columns</span><span class="p">),</span>
                <span class="s2">&quot;target_classes&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">label_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;label_mapping&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="p">[],</span>
            <span class="p">},</span>
            <span class="s2">&quot;performance&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;train_metrics&quot;</span><span class="p">:</span> <span class="n">train_metrics</span><span class="p">,</span>
                <span class="s2">&quot;test_metrics&quot;</span><span class="p">:</span> <span class="n">test_metrics</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;classification_report&quot;</span><span class="p">:</span> <span class="n">class_report</span><span class="p">,</span>
            <span class="s2">&quot;confusion_matrix&quot;</span><span class="p">:</span> <span class="n">conf_matrix</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s2">&quot;feature_importance&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="nb">sorted</span><span class="p">(</span><span class="n">feature_importance</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
            <span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># ä¿å­˜æŠ¥å‘Š</span>
        <span class="n">reports_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reports_dir&quot;</span><span class="p">,</span> <span class="s2">&quot;ml_reports&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">reports_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">report_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">reports_dir</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;training_report_</span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">_%H%M%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">.json&quot;</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">report_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training report saved to: </span><span class="si">{</span><span class="n">report_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="_9">ğŸ“Š æ¨¡å‹è¯„ä¼°<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h2>
<h3 id="1_2">1. è¯„ä¼°æŒ‡æ ‡<a class="headerlink" href="#1_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># src/ml/model_evaluation.py</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span>
    <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">,</span>
    <span class="n">precision_recall_curve</span><span class="p">,</span> <span class="n">roc_curve</span>
<span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ModelEvaluator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æ¨¡å‹è¯„ä¼°å™¨&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">comprehensive_evaluation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">,</span>
        <span class="n">X_test</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">y_test</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
        <span class="n">target_classes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ç»¼åˆæ¨¡å‹è¯„ä¼°</span>

<span class="sd">        Args:</span>
<span class="sd">            model: è®­ç»ƒå¥½çš„æ¨¡å‹</span>
<span class="sd">            X_test: æµ‹è¯•ç‰¹å¾</span>
<span class="sd">            y_test: æµ‹è¯•æ ‡ç­¾</span>
<span class="sd">            target_classes: ç›®æ ‡ç±»åˆ«åˆ—è¡¨</span>

<span class="sd">        Returns:</span>
<span class="sd">            è¯„ä¼°ç»“æœå­—å…¸</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Evaluating model with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="si">}</span><span class="s2"> test samples&quot;</span><span class="p">)</span>

        <span class="c1"># è·å–é¢„æµ‹ç»“æœ</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">y_proba</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">y_proba</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Model does not support probability prediction&quot;</span><span class="p">)</span>

        <span class="c1"># åŸºç¡€æŒ‡æ ‡</span>
        <span class="n">basic_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_basic_metrics</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">y_proba</span><span class="p">)</span>

        <span class="c1"># è¯¦ç»†åˆ†ç±»æŠ¥å‘Š</span>
        <span class="n">class_report</span> <span class="o">=</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">target_names</span><span class="o">=</span><span class="n">target_classes</span><span class="p">,</span> <span class="n">output_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># æ··æ·†çŸ©é˜µ</span>
        <span class="n">conf_matrix</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

        <span class="c1"># ROCæ›²çº¿æ•°æ® (å¦‚æœæ˜¯äºŒåˆ†ç±»)</span>
        <span class="n">roc_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">y_proba</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_test</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">roc_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_roc_curve</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_proba</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="c1"># ç‰¹å¾é‡è¦æ€§</span>
        <span class="n">feature_importance</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_feature_importance</span><span class="p">()</span>

        <span class="c1"># é¢„æµ‹åˆ†å¸ƒåˆ†æ</span>
        <span class="n">prediction_distribution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyze_prediction_distribution</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

        <span class="c1"># é”™è¯¯åˆ†æ</span>
        <span class="n">error_analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyze_predictions</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">y_proba</span><span class="p">)</span>

        <span class="n">evaluation_results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;basic_metrics&quot;</span><span class="p">:</span> <span class="n">basic_metrics</span><span class="p">,</span>
            <span class="s2">&quot;classification_report&quot;</span><span class="p">:</span> <span class="n">class_report</span><span class="p">,</span>
            <span class="s2">&quot;confusion_matrix&quot;</span><span class="p">:</span> <span class="n">conf_matrix</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s2">&quot;feature_importance&quot;</span><span class="p">:</span> <span class="n">feature_importance</span><span class="p">,</span>
            <span class="s2">&quot;prediction_distribution&quot;</span><span class="p">:</span> <span class="n">prediction_distribution</span><span class="p">,</span>
            <span class="s2">&quot;error_analysis&quot;</span><span class="p">:</span> <span class="n">error_analysis</span><span class="p">,</span>
            <span class="s2">&quot;roc_curve&quot;</span><span class="p">:</span> <span class="n">roc_data</span><span class="p">,</span>
            <span class="s2">&quot;evaluation_time&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">evaluation_results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_basic_metrics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">y_true</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
        <span class="n">y_pred</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">y_proba</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è®¡ç®—åŸºç¡€è¯„ä¼°æŒ‡æ ‡&quot;&quot;&quot;</span>

        <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;recall&quot;</span><span class="p">:</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;f1_score&quot;</span><span class="p">:</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># AUC (å¦‚æœæ”¯æŒæ¦‚ç‡é¢„æµ‹)</span>
        <span class="k">if</span> <span class="n">y_proba</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_true</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># äºŒåˆ†ç±»</span>
                    <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;auc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_proba</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># å¤šåˆ†ç±»</span>
                    <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;auc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_proba</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s2">&quot;ovr&quot;</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Could not calculate AUC score&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">metrics</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_roc_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_true</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">y_scores</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è®¡ç®—ROCæ›²çº¿æ•°æ®&quot;&quot;&quot;</span>
        <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_scores</span><span class="p">)</span>
        <span class="n">auc_score</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_scores</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;false_positive_rate&quot;</span><span class="p">:</span> <span class="n">fpr</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s2">&quot;true_positive_rate&quot;</span><span class="p">:</span> <span class="n">tpr</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s2">&quot;thresholds&quot;</span><span class="p">:</span> <span class="n">thresholds</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s2">&quot;auc&quot;</span><span class="p">:</span> <span class="n">auc_score</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_analyze_prediction_distribution</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">y_true</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
        <span class="n">y_pred</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åˆ†æé¢„æµ‹åˆ†å¸ƒ&quot;&quot;&quot;</span>

        <span class="c1"># å®é™…åˆ†å¸ƒ</span>
        <span class="n">actual_distribution</span> <span class="o">=</span> <span class="n">y_true</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

        <span class="c1"># é¢„æµ‹åˆ†å¸ƒ</span>
        <span class="n">pred_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>
        <span class="n">predicted_distribution</span> <span class="o">=</span> <span class="n">pred_series</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

        <span class="c1"># æŒ‰ç±»åˆ«çš„å‡†ç¡®æ€§</span>
        <span class="n">class_accuracy</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">class_name</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_true</span><span class="p">):</span>
            <span class="n">class_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_true</span> <span class="o">==</span> <span class="n">class_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">class_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">class_accuracy</span><span class="p">[</span><span class="n">class_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span>
                    <span class="n">y_true</span><span class="p">[</span><span class="n">class_mask</span><span class="p">],</span> <span class="n">y_pred</span><span class="p">[</span><span class="n">class_mask</span><span class="p">]</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;actual_distribution&quot;</span><span class="p">:</span> <span class="n">actual_distribution</span><span class="p">,</span>
            <span class="s2">&quot;predicted_distribution&quot;</span><span class="p">:</span> <span class="n">predicted_distribution</span><span class="p">,</span>
            <span class="s2">&quot;class_accuracy&quot;</span><span class="p">:</span> <span class="n">class_accuracy</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_analyze_predictions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">X_test</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">y_true</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
        <span class="n">y_pred</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">y_proba</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åˆ†æé¢„æµ‹ç»“æœ&quot;&quot;&quot;</span>

        <span class="c1"># é”™è¯¯é¢„æµ‹çš„æ ·æœ¬</span>
        <span class="n">incorrect_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_true</span> <span class="o">!=</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="n">incorrect_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">incorrect_mask</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># ç½®ä¿¡åº¦åˆ†æ (å¦‚æœæœ‰æ¦‚ç‡)</span>
        <span class="n">confidence_analysis</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">y_proba</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">predicted_confidence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_proba</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">confidence_analysis</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;mean_confidence&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">predicted_confidence</span><span class="p">)),</span>
                <span class="s2">&quot;correct_predictions_mean_confidence&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">predicted_confidence</span><span class="p">[</span><span class="o">~</span><span class="n">incorrect_mask</span><span class="p">])</span>
                <span class="p">),</span>
                <span class="s2">&quot;incorrect_predictions_mean_confidence&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">predicted_confidence</span><span class="p">[</span><span class="n">incorrect_mask</span><span class="p">])</span>
                <span class="p">),</span>
            <span class="p">}</span>

        <span class="c1"># é”™è¯¯æ ·æœ¬åˆ†æ</span>
        <span class="n">error_samples</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">incorrect_indices</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>  <span class="c1"># åªåˆ†æå‰10ä¸ªé”™è¯¯æ ·æœ¬</span>
            <span class="n">error_info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span>
                <span class="s2">&quot;true_label&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">y_true</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]),</span>
                <span class="s2">&quot;predicted_label&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">y_pred</span><span class="p">[</span><span class="n">idx</span><span class="p">]),</span>
                <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="n">X_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">y_proba</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">error_info</span><span class="p">[</span><span class="s2">&quot;predicted_probabilities&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_proba</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">error_info</span><span class="p">[</span><span class="s2">&quot;confidence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_proba</span><span class="p">[</span><span class="n">idx</span><span class="p">]))</span>

            <span class="n">error_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_info</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;total_errors&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">incorrect_indices</span><span class="p">)),</span>
            <span class="s2">&quot;error_rate&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">incorrect_indices</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_true</span><span class="p">)),</span>
            <span class="s2">&quot;confidence_analysis&quot;</span><span class="p">:</span> <span class="n">confidence_analysis</span><span class="p">,</span>
            <span class="s2">&quot;error_samples&quot;</span><span class="p">:</span> <span class="n">error_samples</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_evaluation_report</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">evaluation_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">save_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆè¯„ä¼°æŠ¥å‘Š&quot;&quot;&quot;</span>

        <span class="n">report</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2"># æ¨¡å‹è¯„ä¼°æŠ¥å‘Š</span>

<span class="s2">## æ¨¡å‹ä¿¡æ¯</span>
<span class="s2">- **æ¨¡å‹åç§°**: </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span>
<span class="s2">- **è¯„ä¼°æ—¶é—´**: </span><span class="si">{</span><span class="n">evaluation_results</span><span class="p">[</span><span class="s1">&#39;evaluation_time&#39;</span><span class="p">]</span><span class="si">}</span>

<span class="s2">## åŸºç¡€æ€§èƒ½æŒ‡æ ‡</span>
<span class="s2">&quot;&quot;&quot;</span>

        <span class="c1"># æ·»åŠ åŸºç¡€æŒ‡æ ‡</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="n">evaluation_results</span><span class="p">[</span><span class="s1">&#39;basic_metrics&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_value</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">report</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- **</span><span class="si">{</span><span class="n">metric_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">**: </span><span class="si">{</span><span class="n">metric_value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># æ·»åŠ é¢„æµ‹åˆ†å¸ƒ</span>
        <span class="n">pred_dist</span> <span class="o">=</span> <span class="n">evaluation_results</span><span class="p">[</span><span class="s1">&#39;prediction_distribution&#39;</span><span class="p">]</span>
        <span class="n">report</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">## é¢„æµ‹åˆ†å¸ƒåˆ†æ</span>

<span class="s2">### å®é™…åˆ†å¸ƒ</span>
<span class="s2">&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">pred_dist</span><span class="p">[</span><span class="s1">&#39;actual_distribution&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">report</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">report</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">### é¢„æµ‹åˆ†å¸ƒ</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">pred_dist</span><span class="p">[</span><span class="s1">&#39;predicted_distribution&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">report</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">report</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">### å„ç±»åˆ«å‡†ç¡®ç‡</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">accuracy</span> <span class="ow">in</span> <span class="n">pred_dist</span><span class="p">[</span><span class="s1">&#39;class_accuracy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">report</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">accuracy</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># æ·»åŠ é”™è¯¯åˆ†æ</span>
        <span class="n">error_analysis</span> <span class="o">=</span> <span class="n">evaluation_results</span><span class="p">[</span><span class="s1">&#39;error_analysis&#39;</span><span class="p">]</span>
        <span class="n">report</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">## é”™è¯¯åˆ†æ</span>
<span class="s2">- **æ€»é”™è¯¯æ•°**: </span><span class="si">{</span><span class="n">error_analysis</span><span class="p">[</span><span class="s1">&#39;total_errors&#39;</span><span class="p">]</span><span class="si">}</span>
<span class="s2">- **é”™è¯¯ç‡**: </span><span class="si">{</span><span class="n">error_analysis</span><span class="p">[</span><span class="s1">&#39;error_rate&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span>
<span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">error_analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;confidence_analysis&#39;</span><span class="p">):</span>
            <span class="n">conf_analysis</span> <span class="o">=</span> <span class="n">error_analysis</span><span class="p">[</span><span class="s1">&#39;confidence_analysis&#39;</span><span class="p">]</span>
            <span class="n">report</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">### ç½®ä¿¡åº¦åˆ†æ</span>
<span class="s2">- **å¹³å‡ç½®ä¿¡åº¦**: </span><span class="si">{</span><span class="n">conf_analysis</span><span class="p">[</span><span class="s1">&#39;mean_confidence&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span>
<span class="s2">- **æ­£ç¡®é¢„æµ‹å¹³å‡ç½®ä¿¡åº¦**: </span><span class="si">{</span><span class="n">conf_analysis</span><span class="p">[</span><span class="s1">&#39;correct_predictions_mean_confidence&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span>
<span class="s2">- **é”™è¯¯é¢„æµ‹å¹³å‡ç½®ä¿¡åº¦**: </span><span class="si">{</span><span class="n">conf_analysis</span><span class="p">[</span><span class="s1">&#39;incorrect_predictions_mean_confidence&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span>
<span class="s2">&quot;&quot;&quot;</span>

        <span class="c1"># æ·»åŠ ç‰¹å¾é‡è¦æ€§</span>
        <span class="n">feature_importance</span> <span class="o">=</span> <span class="n">evaluation_results</span><span class="p">[</span><span class="s1">&#39;feature_importance&#39;</span><span class="p">]</span>
        <span class="n">report</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">## ç‰¹å¾é‡è¦æ€§ (Top 10)</span>
<span class="s2">&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">importance</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="nb">sorted</span><span class="p">(</span><span class="n">feature_importance</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="n">report</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">. **</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">**: </span><span class="si">{</span><span class="n">importance</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># ä¿å­˜æŠ¥å‘Š</span>
        <span class="k">if</span> <span class="n">save_path</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Evaluation report saved to: </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">report</span>
</code></pre></div>
<h2 id="_10">ğŸš€ æ¨¡å‹éƒ¨ç½²<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h2>
<h3 id="1_3">1. æ¨¡å‹æœåŠ¡åŒ–<a class="headerlink" href="#1_3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># src/ml/model_service.py</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">fastapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">HTTPException</span><span class="p">,</span> <span class="n">BackgroundTasks</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">..models.football_prediction_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">FootballPredictionModel</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PredictionRequest</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;é¢„æµ‹è¯·æ±‚æ¨¡å‹&quot;&quot;&quot;</span>
    <span class="n">home_team</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;ä¸»é˜Ÿåç§°&quot;</span><span class="p">)</span>
    <span class="n">away_team</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;å®¢é˜Ÿåç§°&quot;</span><span class="p">)</span>
    <span class="n">features</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;ç‰¹å¾æ•°æ®&quot;</span><span class="p">)</span>
    <span class="n">include_explanation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;æ˜¯å¦åŒ…å«è§£é‡Š&quot;</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BatchPredictionRequest</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æ‰¹é‡é¢„æµ‹è¯·æ±‚æ¨¡å‹&quot;&quot;&quot;</span>
    <span class="n">matches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;æ¯”èµ›åˆ—è¡¨&quot;</span><span class="p">)</span>
    <span class="n">include_explanations</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;æ˜¯å¦åŒ…å«è§£é‡Š&quot;</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PredictionResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;é¢„æµ‹å“åº”æ¨¡å‹&quot;&quot;&quot;</span>
    <span class="n">request_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;è¯·æ±‚ID&quot;</span><span class="p">)</span>
    <span class="n">prediction</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;é¢„æµ‹ç»“æœ&quot;</span><span class="p">)</span>
    <span class="n">explanation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;é¢„æµ‹è§£é‡Š&quot;</span><span class="p">)</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;é¢„æµ‹æ—¶é—´&quot;</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ModelService</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æ¨¡å‹æœåŠ¡&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FootballPredictionModel</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_queue</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_processing</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">register_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">FootballPredictionModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ³¨å†Œæ¨¡å‹&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">model_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model registered: </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FootballPredictionModel</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–æ¨¡å‹&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">predict_match</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">request</span><span class="p">:</span> <span class="n">PredictionRequest</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;football_predictor&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PredictionResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        é¢„æµ‹å•åœºæ¯”èµ›</span>

<span class="sd">        Args:</span>
<span class="sd">            request: é¢„æµ‹è¯·æ±‚</span>
<span class="sd">            model_name: æ¨¡å‹åç§°</span>

<span class="sd">        Returns:</span>
<span class="sd">            é¢„æµ‹å“åº”</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Model </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="o">.</span><span class="n">is_trained</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Model is not trained&quot;</span><span class="p">)</span>

            <span class="c1"># æ£€æŸ¥ç¼“å­˜</span>
            <span class="n">cache_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_cache_key</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cache_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_cache</span><span class="p">:</span>
                <span class="n">cached_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cache hit for request: </span><span class="si">{</span><span class="n">request_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">PredictionResponse</span><span class="p">(</span>
                    <span class="n">request_id</span><span class="o">=</span><span class="n">request_id</span><span class="p">,</span>
                    <span class="n">prediction</span><span class="o">=</span><span class="n">cached_result</span><span class="p">[</span><span class="s2">&quot;prediction&quot;</span><span class="p">],</span>
                    <span class="n">explanation</span><span class="o">=</span><span class="n">cached_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;explanation&quot;</span><span class="p">),</span>
                    <span class="n">timestamp</span><span class="o">=</span><span class="n">cached_result</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span>
                <span class="p">)</span>

            <span class="c1"># æ‰§è¡Œé¢„æµ‹</span>
            <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_match</span><span class="p">(</span>
                <span class="n">home_team</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">home_team</span><span class="p">,</span>
                <span class="n">away_team</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">away_team</span><span class="p">,</span>
                <span class="n">features</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">features</span><span class="p">,</span>
                <span class="n">return_probabilities</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

            <span class="c1"># ç”Ÿæˆè§£é‡Š (å¦‚æœéœ€è¦)</span>
            <span class="n">explanation</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">include_explanation</span><span class="p">:</span>
                <span class="n">explanation</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">explain_prediction</span><span class="p">(</span>
                    <span class="n">home_team</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">home_team</span><span class="p">,</span>
                    <span class="n">away_team</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">away_team</span><span class="p">,</span>
                    <span class="n">features</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">features</span>
                <span class="p">)</span>

            <span class="c1"># ç¼“å­˜ç»“æœ</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;prediction&quot;</span><span class="p">:</span> <span class="n">prediction</span><span class="p">,</span>
                <span class="s2">&quot;explanation&quot;</span><span class="p">:</span> <span class="n">explanation</span><span class="p">,</span>
                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prediction_cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prediction completed: </span><span class="si">{</span><span class="n">request_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">PredictionResponse</span><span class="p">(</span>
                <span class="n">request_id</span><span class="o">=</span><span class="n">request_id</span><span class="p">,</span>
                <span class="n">prediction</span><span class="o">=</span><span class="n">prediction</span><span class="p">,</span>
                <span class="n">explanation</span><span class="o">=</span><span class="n">explanation</span><span class="p">,</span>
                <span class="n">timestamp</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prediction failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">batch_predict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">request</span><span class="p">:</span> <span class="n">BatchPredictionRequest</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;football_predictor&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PredictionResponse</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        æ‰¹é‡é¢„æµ‹</span>

<span class="sd">        Args:</span>
<span class="sd">            request: æ‰¹é‡é¢„æµ‹è¯·æ±‚</span>
<span class="sd">            model_name: æ¨¡å‹åç§°</span>

<span class="sd">        Returns:</span>
<span class="sd">            é¢„æµ‹å“åº”åˆ—è¡¨</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Model </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="o">.</span><span class="n">is_trained</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Model is not trained&quot;</span><span class="p">)</span>

        <span class="c1"># å‡†å¤‡æ‰¹é‡é¢„æµ‹æ•°æ®</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">matches</span><span class="p">:</span>
            <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;home_team&quot;</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;home_team&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;away_team&quot;</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;away_team&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="p">})</span>

        <span class="c1"># æ‰§è¡Œæ‰¹é‡é¢„æµ‹</span>
        <span class="n">batch_results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">batch_predict</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>

        <span class="c1"># ç”Ÿæˆå“åº”</span>
        <span class="n">responses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">batch_results</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;error&quot;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="c1"># é”™è¯¯å“åº”</span>
                <span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PredictionResponse</span><span class="p">(</span>
                    <span class="n">request_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;batch_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">prediction</span><span class="o">=</span><span class="n">result</span><span class="p">,</span>
                    <span class="n">explanation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">timestamp</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
                <span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># æˆåŠŸå“åº”</span>
                <span class="n">explanation</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">include_explanations</span><span class="p">:</span>
                    <span class="n">explanation</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">explain_prediction</span><span class="p">(</span>
                        <span class="n">home_team</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;home_team&quot;</span><span class="p">],</span>
                        <span class="n">away_team</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;away_team&quot;</span><span class="p">],</span>
                        <span class="n">features</span><span class="o">=</span><span class="n">matches</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;features&quot;</span><span class="p">]</span>
                    <span class="p">)</span>

                <span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PredictionResponse</span><span class="p">(</span>
                    <span class="n">request_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;batch_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">prediction</span><span class="o">=</span><span class="n">result</span><span class="p">,</span>
                    <span class="n">explanation</span><span class="o">=</span><span class="n">explanation</span><span class="p">,</span>
                    <span class="n">timestamp</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;prediction_time&quot;</span><span class="p">]</span>
                <span class="p">))</span>

        <span class="k">return</span> <span class="n">responses</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_cache_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">PredictionRequest</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆç¼“å­˜é”®&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>

        <span class="n">key_data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">home_team</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">away_team</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">items</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">key_data</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ¸…ç©ºç¼“å­˜&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Prediction cache cleared&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_model_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–æ¨¡å‹ä¿¡æ¯&quot;&quot;&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Model </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
            <span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">model_type</span><span class="p">,</span>
            <span class="s2">&quot;prediction_type&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">prediction_type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;is_trained&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">is_trained</span><span class="p">,</span>
            <span class="s2">&quot;feature_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">feature_columns</span><span class="p">),</span>
            <span class="s2">&quot;target_classes&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">target_classes</span><span class="p">,</span>
            <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
        <span class="p">}</span>

<span class="c1"># åˆ›å»ºFastAPIåº”ç”¨</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Football Prediction API&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">)</span>
<span class="n">model_service</span> <span class="o">=</span> <span class="n">ModelService</span><span class="p">()</span>

<span class="c1"># æ³¨å†Œé»˜è®¤æ¨¡å‹</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..models.prediction_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">default_model</span>
<span class="n">model_service</span><span class="o">.</span><span class="n">register_model</span><span class="p">(</span><span class="n">default_model</span><span class="p">)</span>

<span class="c1"># APIç«¯ç‚¹</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/predict&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">PredictionResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">predict_match</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">PredictionRequest</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;é¢„æµ‹å•åœºæ¯”èµ›&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="k">await</span> <span class="n">model_service</span><span class="o">.</span><span class="n">predict_match</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/predict/batch&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">PredictionResponse</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">batch_predict</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">BatchPredictionRequest</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æ‰¹é‡é¢„æµ‹æ¯”èµ›&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="k">await</span> <span class="n">model_service</span><span class="o">.</span><span class="n">batch_predict</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/models&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_models</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;åˆ—å‡ºæ‰€æœ‰æ¨¡å‹&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;models&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">model_service</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/models/</span><span class="si">{model_name}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_model_info</span><span class="p">(</span><span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;è·å–æ¨¡å‹ä¿¡æ¯&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">model_service</span><span class="o">.</span><span class="n">get_model_info</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/models/</span><span class="si">{model_name}</span><span class="s2">/register&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">register_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æ³¨å†Œæ–°æ¨¡å‹&quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">FootballPredictionModel</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_path</span><span class="p">):</span>
        <span class="n">model_service</span><span class="o">.</span><span class="n">register_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Model </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> registered successfully&quot;</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Failed to load model&quot;</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/cache&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">clear_cache</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æ¸…ç©ºé¢„æµ‹ç¼“å­˜&quot;&quot;&quot;</span>
    <span class="n">model_service</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Cache cleared&quot;</span><span class="p">}</span>
</code></pre></div>
<h2 id="_11">ğŸ“ˆ æ¨¡å‹ç›‘æ§<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h2>
<h3 id="1_4">1. æ€§èƒ½ç›‘æ§<a class="headerlink" href="#1_4" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># src/ml/model_monitor.py</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">prometheus_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">Histogram</span><span class="p">,</span> <span class="n">Gauge</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ModelMonitor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;æ¨¡å‹ç›‘æ§å™¨&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="c1"># PrometheusæŒ‡æ ‡</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_requests_total</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span>
            <span class="s1">&#39;model_prediction_requests_total&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Total number of prediction requests&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;model_name&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_duration</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span>
            <span class="s1">&#39;model_prediction_duration_seconds&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Time spent making predictions&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;model_name&#39;</span><span class="p">],</span>
            <span class="n">buckets</span><span class="o">=</span><span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_accuracy</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span>
            <span class="s1">&#39;model_prediction_accuracy&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Current model accuracy&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;model_name&#39;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_drift_score</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span>
            <span class="s1">&#39;model_data_drift_score&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Data drift score&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;model_name&#39;</span><span class="p">,</span> <span class="s1">&#39;feature&#39;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># ç›‘æ§æ•°æ®å­˜å‚¨</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alert_thresholds</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;accuracy_drop&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>      <span class="c1"># å‡†ç¡®ç‡ä¸‹é™10%</span>
            <span class="s2">&quot;prediction_latency&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="c1"># é¢„æµ‹å»¶è¿Ÿè¶…è¿‡2ç§’</span>
            <span class="s2">&quot;error_rate&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>        <span class="c1"># é”™è¯¯ç‡è¶…è¿‡5%</span>
            <span class="s2">&quot;data_drift&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>         <span class="c1"># æ•°æ®æ¼‚ç§»è¶…è¿‡20%</span>
        <span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">record_prediction</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">prediction_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">prediction_result</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è®°å½•é¢„æµ‹è¯·æ±‚&quot;&quot;&quot;</span>

        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;success&quot;</span> <span class="k">if</span> <span class="n">success</span> <span class="k">else</span> <span class="s2">&quot;error&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_requests_total</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">status</span>
        <span class="p">)</span><span class="o">.</span><span class="n">inc</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_duration</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span>
        <span class="p">)</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">prediction_time</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_model_accuracy</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">accuracy</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ›´æ–°æ¨¡å‹å‡†ç¡®ç‡&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_accuracy</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span>
        <span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)</span>

        <span class="c1"># æ£€æŸ¥æ˜¯å¦éœ€è¦å‘Šè­¦</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_accuracy_drop</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">detect_data_drift</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">current_features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">reference_features</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ£€æµ‹æ•°æ®æ¼‚ç§»&quot;&quot;&quot;</span>

        <span class="n">drift_scores</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">current_features</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">reference_features</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="c1"># è®¡ç®—åˆ†å¸ƒå·®å¼‚ (ç®€åŒ–å®ç°)</span>
                <span class="n">current_mean</span> <span class="o">=</span> <span class="n">current_features</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">ref_mean</span> <span class="o">=</span> <span class="n">reference_features</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">current_std</span> <span class="o">=</span> <span class="n">current_features</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
                <span class="n">ref_std</span> <span class="o">=</span> <span class="n">reference_features</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

                <span class="c1"># è®¡ç®—æ¼‚ç§»åˆ†æ•°</span>
                <span class="n">mean_diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">current_mean</span> <span class="o">-</span> <span class="n">ref_mean</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ref_std</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)</span>
                <span class="n">std_ratio</span> <span class="o">=</span> <span class="n">current_std</span> <span class="o">/</span> <span class="p">(</span><span class="n">ref_std</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)</span>

                <span class="n">drift_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">mean_diff</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">std_ratio</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">drift_scores</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">drift_score</span>

                <span class="c1"># æ›´æ–°PrometheusæŒ‡æ ‡</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_drift_score</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span>
                    <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
                    <span class="n">feature</span><span class="o">=</span><span class="n">feature</span>
                <span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">drift_score</span><span class="p">)</span>

        <span class="c1"># æ£€æŸ¥æ˜¯å¦éœ€è¦å‘Šè­¦</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_data_drift_alert</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">drift_scores</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">drift_scores</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_check_accuracy_drop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">current_accuracy</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ£€æŸ¥å‡†ç¡®ç‡ä¸‹é™å‘Šè­¦&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">model_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_data</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">last_accuracy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_data</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_accuracy&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">last_accuracy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">accuracy_drop</span> <span class="o">=</span> <span class="n">last_accuracy</span> <span class="o">-</span> <span class="n">current_accuracy</span>

            <span class="k">if</span> <span class="n">accuracy_drop</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">alert_thresholds</span><span class="p">[</span><span class="s2">&quot;accuracy_drop&quot;</span><span class="p">]:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_alert</span><span class="p">(</span>
                    <span class="s2">&quot;accuracy_drop&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;Model </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> accuracy dropped by </span><span class="si">{</span><span class="n">accuracy_drop</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
                        <span class="s2">&quot;last_accuracy&quot;</span><span class="p">:</span> <span class="n">last_accuracy</span><span class="p">,</span>
                        <span class="s2">&quot;current_accuracy&quot;</span><span class="p">:</span> <span class="n">current_accuracy</span><span class="p">,</span>
                        <span class="s2">&quot;drop&quot;</span><span class="p">:</span> <span class="n">accuracy_drop</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_data</span><span class="p">[</span><span class="n">model_name</span><span class="p">][</span><span class="s2">&quot;last_accuracy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_accuracy</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_check_data_drift_alert</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">drift_scores</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;æ£€æŸ¥æ•°æ®æ¼‚ç§»å‘Šè­¦&quot;&quot;&quot;</span>

        <span class="n">max_drift</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">drift_scores</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">max_drift</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">alert_thresholds</span><span class="p">[</span><span class="s2">&quot;data_drift&quot;</span><span class="p">]:</span>
            <span class="c1"># æ‰¾åˆ°æ¼‚ç§»æœ€å¤§çš„ç‰¹å¾</span>
            <span class="n">max_drift_feature</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">drift_scores</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_alert</span><span class="p">(</span>
                <span class="s2">&quot;data_drift&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;Significant data drift detected in model </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">{</span>
                    <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
                    <span class="s2">&quot;max_drift&quot;</span><span class="p">:</span> <span class="n">max_drift</span><span class="p">,</span>
                    <span class="s2">&quot;max_drift_feature&quot;</span><span class="p">:</span> <span class="n">max_drift_feature</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s2">&quot;drift_scores&quot;</span><span class="p">:</span> <span class="n">drift_scores</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_send_alert</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">alert_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">details</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;å‘é€å‘Šè­¦&quot;&quot;&quot;</span>

        <span class="n">alert</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;alert_type&quot;</span><span class="p">:</span> <span class="n">alert_type</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
            <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="n">details</span><span class="p">,</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_alert_severity</span><span class="p">(</span><span class="n">alert_type</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ALERT: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># è¿™é‡Œå¯ä»¥é›†æˆå®é™…çš„å‘Šè­¦ç³»ç»Ÿ (é‚®ä»¶ã€Slackç­‰)</span>
        <span class="c1"># await self.alert_sender.send_alert(alert)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_alert_severity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alert_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;è·å–å‘Šè­¦ä¸¥é‡ç¨‹åº¦&quot;&quot;&quot;</span>

        <span class="n">severity_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;accuracy_drop&quot;</span><span class="p">:</span> <span class="s2">&quot;warning&quot;</span><span class="p">,</span>
            <span class="s2">&quot;data_drift&quot;</span><span class="p">:</span> <span class="s2">&quot;warning&quot;</span><span class="p">,</span>
            <span class="s2">&quot;high_latency&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
            <span class="s2">&quot;high_error_rate&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">severity_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">alert_type</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">generate_monitoring_report</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">time_range</span><span class="p">:</span> <span class="n">timedelta</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ç”Ÿæˆç›‘æ§æŠ¥å‘Š&quot;&quot;&quot;</span>

        <span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">time_range</span>

        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
            <span class="s2">&quot;report_period&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">end_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                <span class="s2">&quot;duration_hours&quot;</span><span class="p">:</span> <span class="n">time_range</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;performance_metrics&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;total_requests&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;success_rate&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;average_latency&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;current_accuracy&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;data_drift&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s2">&quot;alerts&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;recommendations&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>

        <span class="c1"># æ”¶é›†ç›‘æ§æ•°æ® (ç®€åŒ–å®ç°)</span>
        <span class="k">if</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_data</span><span class="p">:</span>
            <span class="n">model_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitoring_data</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span>

            <span class="n">report</span><span class="p">[</span><span class="s2">&quot;performance_metrics&quot;</span><span class="p">][</span><span class="s2">&quot;current_accuracy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_accuracy&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c1"># ç”Ÿæˆå»ºè®®</span>
            <span class="k">if</span> <span class="n">model_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_accuracy&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.7</span><span class="p">:</span>
                <span class="n">report</span><span class="p">[</span><span class="s2">&quot;recommendations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;è€ƒè™‘é‡æ–°è®­ç»ƒæ¨¡å‹ä»¥æé«˜å‡†ç¡®ç‡&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;recent_drift_scores&quot;</span><span class="p">,</span> <span class="p">{}))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">report</span><span class="p">[</span><span class="s2">&quot;recommendations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;æ£€æµ‹åˆ°æ•°æ®æ¼‚ç§»ï¼Œå»ºè®®æ›´æ–°è®­ç»ƒæ•°æ®&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">report</span>
</code></pre></div>
<h2 id="_12">ğŸ“š æœ€ä½³å®è·µ<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h2>
<h3 id="1_5">1. æ¨¡å‹å¼€å‘æœ€ä½³å®è·µ<a class="headerlink" href="#1_5" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>æ•°æ®è´¨é‡</strong></li>
<li>ç¡®ä¿è®­ç»ƒæ•°æ®çš„å®Œæ•´æ€§å’Œå‡†ç¡®æ€§</li>
<li>è¿›è¡Œé€‚å½“çš„æ•°æ®æ¸…æ´—å’Œé¢„å¤„ç†</li>
<li>
<p>å¤„ç†ç¼ºå¤±å€¼å’Œå¼‚å¸¸å€¼</p>
</li>
<li>
<p><strong>ç‰¹å¾å·¥ç¨‹</strong></p>
</li>
<li>é€‰æ‹©ä¸é¢„æµ‹ç›®æ ‡ç›¸å…³çš„ç‰¹å¾</li>
<li>é¿å…æ•°æ®æ³„éœ² (feature leakage)</li>
<li>
<p>è¿›è¡Œç‰¹å¾æ ‡å‡†åŒ–å’Œå½’ä¸€åŒ–</p>
</li>
<li>
<p><strong>æ¨¡å‹é€‰æ‹©</strong></p>
</li>
<li>ä»ç®€å•çš„åŸºçº¿æ¨¡å‹å¼€å§‹</li>
<li>æ ¹æ®é—®é¢˜ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„ç®—æ³•</li>
<li>
<p>è€ƒè™‘æ¨¡å‹çš„è§£é‡Šæ€§éœ€æ±‚</p>
</li>
<li>
<p><strong>éªŒè¯ç­–ç•¥</strong></p>
</li>
<li>ä½¿ç”¨æ—¶é—´åºåˆ—åˆ†å‰²é¿å…æœªæ¥æ•°æ®æ³„éœ²</li>
<li>è¿›è¡Œäº¤å‰éªŒè¯ç¡®ä¿æ¨¡å‹ç¨³å®šæ€§</li>
<li>ä¿ç•™ç‹¬ç«‹çš„æµ‹è¯•é›†è¿›è¡Œæœ€ç»ˆè¯„ä¼°</li>
</ol>
<h3 id="2_2">2. éƒ¨ç½²æœ€ä½³å®è·µ<a class="headerlink" href="#2_2" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>æ¨¡å‹ç‰ˆæœ¬ç®¡ç†</strong></li>
<li>ä½¿ç”¨MLflowç­‰å·¥å…·è·Ÿè¸ªæ¨¡å‹ç‰ˆæœ¬</li>
<li>ä¿å­˜å®Œæ•´çš„æ¨¡å‹å…ƒæ•°æ®</li>
<li>
<p>å»ºç«‹æ¨¡å‹å›æ»šæœºåˆ¶</p>
</li>
<li>
<p><strong>æ€§èƒ½ç›‘æ§</strong></p>
</li>
<li>ç›‘æ§é¢„æµ‹å»¶è¿Ÿå’Œååé‡</li>
<li>è·Ÿè¸ªæ¨¡å‹æ€§èƒ½æŒ‡æ ‡å˜åŒ–</li>
<li>
<p>è®¾ç½®åˆç†çš„å‘Šè­¦é˜ˆå€¼</p>
</li>
<li>
<p><strong>å®‰å…¨è€ƒè™‘</strong></p>
</li>
<li>ä¿æŠ¤æ¨¡å‹æ–‡ä»¶å’Œè®­ç»ƒæ•°æ®</li>
<li>å®ç°APIè®¿é—®æ§åˆ¶</li>
<li>
<p>è®°å½•é¢„æµ‹è¯·æ±‚æ—¥å¿—</p>
</li>
<li>
<p><strong>å¯æ‰©å±•æ€§</strong></p>
</li>
<li>è®¾è®¡æ°´å¹³æ‰©å±•çš„æ¶æ„</li>
<li>å®ç°æ¨¡å‹è´Ÿè½½å‡è¡¡</li>
<li>ä¼˜åŒ–é¢„æµ‹æœåŠ¡æ€§èƒ½</li>
</ol>
<h2 id="_13">ğŸ“‹ ç›¸å…³æ–‡æ¡£<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="../../reference/DATABASE_SCHEMA/">æ•°æ®åº“æ¶æ„æ–‡æ¡£</a></li>
<li><a href="../../reference/DEVELOPMENT_GUIDE/">å¼€å‘æŒ‡å—</a></li>
<li><a href="../../reference/DATA_COLLECTION_SETUP/">æ•°æ®é‡‡é›†é…ç½®æŒ‡å—</a></li>
<li><a href="../../reference/API_REFERENCE/">APIæ–‡æ¡£</a></li>
<li><a href="../../reference/glossary/">æœ¯è¯­è¡¨</a></li>
</ul>
<hr />
<p><strong>æ–‡æ¡£ç‰ˆæœ¬</strong>: 1.0
<strong>æœ€åæ›´æ–°</strong>: 2025-10-23
<strong>ç»´æŠ¤è€…</strong>: å¼€å‘å›¢é˜Ÿ</p>












                

  <!-- æ·»åŠ é¡µé¢å¯¼èˆªåŠ©æ‰‹ -->
  

              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  å›åˆ°é¡µé¢é¡¶éƒ¨
</button>
        
      </main>
      
  
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="é¡µè„š" >
        
          
          <a href="../../ops/runbooks/DISASTER_RECOVERY_RUNBOOK/" class="md-footer__link md-footer__link--prev" aria-label="ä¸Šä¸€é¡µ: ç¾éš¾æ¢å¤">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                ä¸Šä¸€é¡µ
              </span>
              <div class="md-ellipsis">
                ç¾éš¾æ¢å¤
              </div>
            </div>
          </a>
        
        
          
          <a href="../../project/CHANGELOG/" class="md-footer__link md-footer__link--next" aria-label="ä¸‹ä¸€é¡µ: å˜æ›´æ—¥å¿—">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                ä¸‹ä¸€é¡µ
              </span>
              <div class="md-ellipsis">
                å˜æ›´æ—¥å¿—
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Football Prediction Team
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      

  <!-- è‡ªå®šä¹‰é¡µè„šå†…å®¹ -->
  <footer class="md-footer-meta">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        <div class="md-footer-copyright__highlight">
          Â© 2025 Football Prediction Team -
          åŸºäº <a href="https://www.mkdocs.org/">MkDocs</a> å’Œ
          <a href="https://squidfunk.github.io/mkdocs-material/">Material for MkDocs</a> æ„å»º
        </div>
        <div class="md-footer-copyright__small">
          æ–‡æ¡£æœ€åæ›´æ–°: 2025-10-23 |
          ç‰ˆæœ¬: v1.0.0
        </div>
      </div>

      <!-- ç¤¾äº¤é“¾æ¥ (æš‚æ—¶æ³¨é‡Šæ‰) -->
      <!--
      <div class="md-footer-social">
        
      </div>
      -->
    </div>
  </footer>

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.tooltips", "header.autohide", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
  
      <script src="../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    

  <!-- Google Analytics (é…ç½®ä¸ºé™æ€å€¼) -->
  <!--
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXX-X"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-XXXXX-X');
  </script>
  -->

  </body>
</html>