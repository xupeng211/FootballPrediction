[pytest]
addopts = -v --tb=short --strict-markers --durations=10 --maxfail=1 --disable-warnings --cov=src --cov-report=term-missing:skip-covered --cov-fail-under=70
markers =
  unit: 纯单元测试 (无外部依赖)
  integration: 集成测试 (有外部依赖)
  slow: 慢测试 (>5秒)
  asyncio: marks tests as async (deselect with '-m "not asyncio"')
  e2e: marks tests as end-to-end tests
  docker: marks tests requiring Docker services
  performance: marks tests as performance tests
  timeout: marks tests with timeout limits
  edge_case: marks tests as edge case tests
  failure_scenario: marks tests as failure scenario tests
  mlflow: marks tests related to MLflow
  db: 数据库相关测试
  kafka: Kafka 相关测试
  celery: Celery 相关测试
  ml: 机器学习相关测试
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
filterwarnings =
  ignore::DeprecationWarning
  ignore::PendingDeprecationWarning
  ignore:.*pytest.mark.asyncio.*:pytest.PytestUnknownMarkWarning
  ignore::RuntimeWarning:tests.*
  error::UserWarning
  # Marshmallow 4 兼容性警告抑制 - 针对第三方库(Great Expectations)
  ignore:.*Number.*field should not be instantiated.*
minversion = 7.0
# required_plugins = pytest-asyncio,pytest-cov
