# GitHub Actions 工作流文档

## 🔄 优化后的工作流架构

我们将原来的15个工作流优化为6个主要工作流（现在使用中文命名），建立了完整的反馈循环，提高了效率和可维护性。

### 📊 工作流对比

| 优化前 | 优化后 | 改进 |
|--------|--------|------|
| 15个工作流 | 6个工作流 | 减少60% |
| 缺少反馈闭环 | 完整的问题跟踪 | 提高自动化 |
| 执行频率混乱 | 合理的执行时机 | 节省资源 |
| 手动管理多 | 自动化程度高 | 减少维护成本 |

### 🚀 核心工作流

#### 1. **CI流水线.yml** - CI持续集成流水线

- **功能**: 完整的持续集成流程
- **触发**: push到main/develop/hotfix/**分支，PR
- **阶段**:
  - 基础检查（快速失败）
  - 代码质量（linting + type checking）
  - 测试和覆盖率（80%阈值）
  - 镜像构建
  - 安全扫描
  - 结果通知

#### 2. **部署流水线.yml** - 部署流程

- **功能**: 自动化部署到staging/production
- **触发**: CI持续集成流水线成功后
- **特性**:
  - 环境判断（staging/production）
  - ECR镜像推送
  - Kubernetes部署
  - 生产环境健康检查
  - 失败回滚机制

#### 3. **MLOps机器学习流水线.yml** - MLOps机器学习流水线

- **功能**: 机器学习运维自动化
- **触发**: 每日8:00 UTC，手动触发
- **阶段**:
  - 反馈更新
  - 性能报告生成
  - 重训练检查
  - **自动重训练和部署**（新增）
  - 模型监控
  - 数据清理
  - 汇总报告

#### 4. **项目同步流水线.yml** - 项目同步

- **功能**: 实时项目状态同步
- **触发**: PR关闭，手动触发
- **任务**:
  - 看板状态同步
  - PR状态更新
  - Issues状态同步

#### 5. **问题跟踪流水线.yml** - 问题跟踪

- **功能**: 自动问题跟踪和解决
- **触发**: CI失败，MLOps失败，手动触发
- **特性**:
  - CI失败自动创建Issue
  - MLOps问题自动跟踪
  - 问题解决后自动关闭
  - 完整的问题生命周期管理

#### 6. **项目维护流水线.yml** - 项目维护

- **功能**: 周期性项目维护
- **触发**: 每周一凌晨2点，手动触发
- **任务**:
  - 文档自动更新
  - 清理过期内容
  - 生成统计报告
  - 归档旧报告

### 📈 性能优化

#### 1. **智能执行**

```yaml
# 只在相关文件变更时运行
if: needs.basic-checks.outputs.should-run == 'true'
```

#### 2. **依赖管理**

```yaml
needs: [quality-check, test-and-coverage]
```

#### 3. **缓存策略**

```yaml
# 缓存pip依赖
key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements*.txt') }}
```

### 🏗️ 工作流依赖图

```
CI持续集成流水线 (基础CI)
├── quality-check (代码质量)
├── test-and-coverage (测试)
├── build (构建)
└── deploy (部署)
    └── production-checks (生产检查)

mlops (MLOps流程)
├── feedback-update
├── performance-report
├── retrain-check
├── model-monitor
└── cleanup

project-management (项目管理)
├── kanban-audit
├── kanban-history
└── docs-update
```

### 🔧 触发条件优化

#### 原有问题

- 6个工作流监听push事件
- 重复执行造成资源浪费

#### 优化方案

1. **单一入口**: 只有CI持续集成流水线监听push
2. **依赖链**: 其他工作流通过workflow_run触发
3. **条件执行**: 基于文件变更决定是否运行

### 📋 使用建议

#### 1. **日常开发**

- 推送代码 → 自动触发CI
- PR → 自动运行测试和覆盖率
- 合并到main → 自动部署到staging

#### 2. **MLOps操作**

- 每日自动生成报告
- 手动触发重训练检查
- 模型监控和预警

#### 3. **项目管理**

- PR关闭时自动更新看板
- 每日同步和清理任务
- 文档自动更新

### 🚀 下一步优化

1. **添加工作流监控面板**
2. **优化并行执行策略**
3. **添加更详细的执行日志**
4. **集成更多第三方工具通知
