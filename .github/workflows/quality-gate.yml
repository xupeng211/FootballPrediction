name: Quality Gate Check

on:
  workflow_dispatch:
  workflow_call:

jobs:
  quality-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4.1.6

      - name: Set up Python
        uses: actions/setup-python@v4.7.1
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements/requirements.lock || pip install -r requirements/base.txt

      - name: Run lint and type checks
        run: make lint

      - name: Run unit tests
        run: make test

      - name: Enforce coverage threshold
        run: make coverage COVERAGE_THRESHOLD=80

      - name: Quality Gate Status
        if: success()
        run: |
          echo "âœ… Quality gate passed!"
          echo "ðŸ“ˆ Code is getting better!"
