# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## ğŸŒ è¯­è¨€è®¾ç½®

**é‡è¦è§„åˆ™ï¼šåœ¨ä¸ç”¨æˆ·äº¤æµæ—¶ï¼Œè¯·ä½¿ç”¨ç®€ä½“ä¸­æ–‡å›å¤ã€‚** ç”¨æˆ·ä¸æ‡‚è‹±æ–‡ï¼Œæ‰€ä»¥æ‰€æœ‰è§£é‡Šå’Œè¯´æ˜éƒ½åº”è¯¥ç”¨ä¸­æ–‡ã€‚

- ä¸ç”¨æˆ·çš„æ‰€æœ‰å¯¹è¯éƒ½ä½¿ç”¨ç®€ä½“ä¸­æ–‡
- ä»£ç æ³¨é‡Šå¯ä»¥ä½¿ç”¨è‹±æ–‡ï¼Œä½†è§£é‡Šè¦ç”¨ä¸­æ–‡
- é”™è¯¯ä¿¡æ¯å’ŒæŠ€æœ¯æœ¯è¯­çš„è§£é‡Šä¹Ÿè¦ç”¨ä¸­æ–‡

## é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªè¶³çƒé¢„æµ‹ç³»ç»Ÿï¼Œä½¿ç”¨ FastAPIã€SQLAlchemyã€Redis å’Œ PostgreSQL æ„å»ºã€‚é¡¹ç›®é‡‡ç”¨ç°ä»£ Python æ¶æ„ï¼Œå…·æœ‰å®Œæ•´çš„æµ‹è¯•ã€CI/CD å’Œ MLOps åŠŸèƒ½ã€‚

## å¼€å‘å‘½ä»¤

### ç¯å¢ƒè®¾ç½®
```bash
make install          # ä»é”æ–‡ä»¶å®‰è£…ä¾èµ–
make env-check        # æ£€æŸ¥å¼€å‘ç¯å¢ƒæ˜¯å¦å¥åº·
make context          # åŠ è½½é¡¹ç›®ä¸Šä¸‹æ–‡ä¾› AI å¼€å‘ä½¿ç”¨
```

### æµ‹è¯•
```bash
make test             # è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
make test-quick       # å¿«é€Ÿå•å…ƒæµ‹è¯•ï¼ˆå¸¦è¶…æ—¶é™åˆ¶ï¼‰
make test-unit        # åªè¿è¡Œå•å…ƒæµ‹è¯•ï¼ˆæ ‡è®°ä¸º 'unit' çš„ï¼‰
make test-phase1      # è¿è¡Œç¬¬ä¸€é˜¶æ®µæ ¸å¿ƒ API æµ‹è¯•
make test-api         # è¿è¡Œæ‰€æœ‰ API æµ‹è¯•
make test.containers  # è¿è¡Œéœ€è¦ Docker å®¹å™¨çš„æµ‹è¯•
make coverage         # è¿è¡Œæµ‹è¯•å¹¶æ£€æŸ¥è¦†ç›–ç‡ï¼ˆé»˜è®¤80%ï¼‰
make coverage-fast    # å¿«é€Ÿè¦†ç›–ç‡æ£€æŸ¥ï¼ˆä»…å•å…ƒæµ‹è¯•ï¼‰
make coverage-local   # æœ¬åœ°è¦†ç›–ç‡æ£€æŸ¥ï¼ˆè¦æ±‚60%ï¼‰
```

### ä»£ç è´¨é‡
```bash
make lint             # è¿è¡Œ ruff å’Œ mypy æ£€æŸ¥
make fmt              # ä½¿ç”¨ ruff æ ¼å¼åŒ–ä»£ç ï¼ˆå·²æ›¿æ¢ black å’Œ isortï¼‰
make prepush          # å®Œæ•´çš„æäº¤å‰éªŒè¯ï¼ˆruff + mypy + pytestï¼‰
make ci               # æ¨¡æ‹Ÿ GitHub Actions CI æµç¨‹
```

### æœ¬åœ° CI éªŒè¯
```bash
./ci-verify.sh        # åœ¨æœ¬åœ°è¿è¡Œå®Œæ•´çš„ CI éªŒè¯
make test-phase1      # è¿è¡Œç¬¬ä¸€é˜¶æ®µæ ¸å¿ƒ API æµ‹è¯•
```

## æ¶æ„è¯´æ˜

### æ ¸å¿ƒç»“æ„
- **`src/api/`** - FastAPI ç«¯ç‚¹å’Œæ¨¡å¼
- **`src/database/`** - SQLAlchemy æ¨¡å‹ã€è¿ç§»å’Œè¿æ¥ç®¡ç†
- **`src/services/`** - ä¸šåŠ¡é€»è¾‘å±‚
- **`src/models/`** - æœºå™¨å­¦ä¹ æ¨¡å‹å’Œé¢„æµ‹æœåŠ¡
- **`src/cache/`** - Redis ç¼“å­˜å±‚
- **`src/monitoring/`** - ç³»ç»Ÿç›‘æ§å’ŒæŒ‡æ ‡
- **`src/utils/`** - é€šç”¨å·¥å…·

### å…³é”®æ¨¡å¼
- ä½¿ç”¨æ”¯æŒå¼‚æ­¥çš„ SQLAlchemy
- æ•°æ®è®¿é—®ä½¿ç”¨ä»“åº“æ¨¡å¼
- é€šè¿‡ FastAPI çš„ä¾èµ–ç³»ç»Ÿè¿›è¡Œä¾èµ–æ³¨å…¥
- æµ‹è¯•æ•°æ®ä½¿ç”¨å·¥å‚æ¨¡å¼ï¼ˆè§ `tests/factories/`ï¼‰
- å…¨é¢ä½¿ç”¨ Pydantic æ¨¡å‹è¿›è¡Œæ•°æ®éªŒè¯

## æµ‹è¯•æŒ‡å—

### æµ‹è¯•ç»„ç»‡
- å•å…ƒæµ‹è¯•ï¼š`tests/unit/` - æµ‹è¯•å•ä¸ªå‡½æ•°/ç±»
- é›†æˆæµ‹è¯•ï¼š`tests/integration/` - æµ‹è¯•æ¨¡å—äº¤äº’
- æµ‹è¯•å¤¹å…·ï¼š`tests/factories/` - ä½¿ç”¨å·¥å‚æ¨¡å¼ç”Ÿæˆæµ‹è¯•æ•°æ®
- å…±äº«å¤¹å…·ï¼š`tests/conftest.py` - pytest é…ç½®

### æµ‹è¯•æ‰§è¡Œ
- å§‹ç»ˆä½¿ç”¨ Makefile å‘½ä»¤è¿›è¡Œæµ‹è¯•ï¼ˆä¸è¦ç›´æ¥è¿è¡Œ pytestï¼‰
- å¼€å‘æ—¶ä½¿ç”¨ `make test-quick` è·å¾—å¿«é€Ÿåé¦ˆï¼ˆå¸¦è¶…æ—¶å’Œå¤±è´¥é™åˆ¶ï¼‰
- ä½¿ç”¨ `make coverage-fast` ç”Ÿæˆä¸åŒ…å«æ…¢æµ‹è¯•çš„è¦†ç›–ç‡æŠ¥å‘Š
- è¦†ç›–ç‡è¦æ±‚ï¼šCI ç¯å¢ƒ >=80%ï¼Œæœ¬åœ°å¼€å‘ >=60%ï¼ˆä½¿ç”¨ coverage-localï¼‰
- è¿è¡Œå•ä¸ªæµ‹è¯•ï¼š`pytest tests/unit/test_specific.py::test_function`

### æµ‹è¯•å®¹å™¨
- å¯¹éœ€è¦çœŸå®æœåŠ¡çš„é›†æˆæµ‹è¯•ä½¿ç”¨ TestContainers
- è¿è¡Œ `make test.containers` è¿›è¡ŒåŸºäº Docker çš„æµ‹è¯•

## å¼€å‘å·¥ä½œæµç¨‹

1. ä½¿ç”¨ `make dev-setup` å¿«é€Ÿè®¾ç½®ç¯å¢ƒ
2. å¼€å‘å‰ç”¨ `make context` åŠ è½½ä¸Šä¸‹æ–‡
3. å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨ `make test-quick` è·å¾—å¿«é€Ÿåé¦ˆ
4. æäº¤å‰è¿è¡Œ `make prepush`
5. æ¨é€å‰æ‰§è¡Œ `./ci-verify.sh` ç¡®ä¿ CI é€šè¿‡

## é‡è¦è¯´æ˜

- é¡¹ç›®ä½¿ç”¨ pip-tools è¿›è¡Œä¾èµ–ç®¡ç†ï¼ˆrequirements/ ç›®å½•ï¼‰
- ä»£ç æ ¼å¼åŒ–å’Œæ£€æŸ¥å·²è¿ç§»åˆ° ruffï¼ˆæ›¿ä»£ flake8ã€blackã€isortï¼‰
- æ‰€æœ‰ Python ä»£ç å¿…é¡»é€šè¿‡ ruff å’Œ mypy æ£€æŸ¥
- æµ‹è¯•ä½¿ç”¨ pytest å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
- Docker Compose æä¾›æœ¬åœ°å¼€å‘çš„ PostgreSQLã€Redis å’Œ Nginx
- MLOps æµç¨‹åŒ…æ‹¬æ¨¡å‹é‡è®­ç»ƒå’Œåé¦ˆå¾ªç¯

## å¸¸è§é—®é¢˜

- å¦‚æœæµ‹è¯•è¿è¡Œç¼“æ…¢ï¼Œä½¿ç”¨ `make test-quick` æˆ– `make coverage-fast`
- å¯¹äºæ•°æ®åº“ç›¸å…³çš„æµ‹è¯•å¤±è´¥ï¼Œç¡®ä¿ Docker æœåŠ¡æ­£åœ¨è¿è¡Œï¼š`docker-compose up -d`
- å¦‚æœå¯¼å…¥å¤±è´¥ï¼Œç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»ï¼š`source .venv/bin/activate`
- ruff åŒæ—¶å¤„ç†ä»£ç æ£€æŸ¥å’Œæ ¼å¼åŒ–ï¼Œä½¿ç”¨ `make fmt` ä¼šè‡ªåŠ¨è¿è¡Œ `ruff format` å’Œ `ruff check --fix`
- æœ¬åœ°å¼€å‘å»ºè®®ä½¿ç”¨ `make coverage-local`ï¼ˆ60%é˜ˆå€¼ï¼‰è€Œä¸æ˜¯ `make coverage`ï¼ˆ80%é˜ˆå€¼ï¼‰
