# ğŸ“‹ æŠ€æœ¯å€ºåŠ¡è¿˜å€ºæŒ‡å— (Test Debt Recovery Guide)

> ğŸ“… **åˆ›å»ºæ—¶é—´**: 2025-11-20
> ğŸ“Š **å½“å‰çŠ¶æ€**: 308ä¸ªæµ‹è¯•è¢«éš”ç¦»åœ¨ `tests/skipped_tests.txt` ä¸­
> ğŸ¯ **ç›®æ ‡**: å»ºç«‹æ ‡å‡†åŒ–ã€å¯é‡å¤çš„æŠ€æœ¯å€ºåŠ¡ä¿®å¤æµç¨‹

---

## ğŸ¯ æ‰§è¡Œæ‘˜è¦

æœ¬æ–‡æ¡£ä¸ºå›¢é˜Ÿæä¾›äº†ä¸€å¥—å®Œæ•´çš„æŠ€æœ¯å€ºåŠ¡ç®¡ç†å’Œä¿®å¤æŒ‡å—ã€‚æˆ‘ä»¬å·²ç»é€šè¿‡è‡ªåŠ¨åŒ–å·¥å…·æˆåŠŸå›æ”¶äº†2154ä¸ªæµ‹è¯•ï¼Œç°åœ¨éœ€è¦æŒ‰ç…§æ ‡å‡†æµç¨‹é€æ­¥ä¿®å¤å‰©ä½™çš„æŠ€æœ¯å€ºåŠ¡ã€‚

### ğŸ“Š å½“å‰çŠ¶æ€æ¦‚è§ˆ

| æŒ‡æ ‡ | å½“å‰å€¼ | ç›®æ ‡å€¼ | çŠ¶æ€ |
|------|--------|--------|------|
| è·³è¿‡æµ‹è¯•æ•°é‡ | 308 | 50 | ğŸŸ¡ è¿›è¡Œä¸­ |
| æµ‹è¯•è¦†ç›–ç‡ | 29.0% | 40% | ğŸŸ¡ è¿›è¡Œä¸­ |
| CIç¨³å®šæ€§ | âœ… ç»¿ç¯ | âœ… ç»¿ç¯ | ğŸŸ¢ å·²è¾¾æ ‡ |
| æŠ€æœ¯å€ºåŠ¡ç­‰çº§ | ä¸­ç­‰ | ä½ | ğŸŸ¡ æ”¹å–„ä¸­ |

---

## ğŸ”§ æ ‡å‡†ä¿®å¤æµç¨‹ (Standard Recovery Procedure)

### æ­¥éª¤1: é€‰æ‹©ä¿®å¤ç›®æ ‡
```bash
# æŸ¥çœ‹å½“å‰è·³è¿‡æµ‹è¯•
cat tests/skipped_tests.txt

# æŒ‰æ¨¡å—ç»Ÿè®¡åˆ†å¸ƒ
grep "tests/unit" tests/skipped_tests.txt | sed 's|/[^/]*$||' | sort | uniq -c | sort -nr

# æ¨èä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
# 1. utils/ - å·¥å…·ç±»ï¼Œä¾èµ–å°‘
# 2. domain/ - ä¸šåŠ¡æ ¸å¿ƒï¼Œå½±å“å¤§
# 3. services/ - åº”ç”¨æœåŠ¡
# 4. api/ - æ¥å£å±‚
# 5. database/ - æ•°æ®å±‚
```

### æ­¥éª¤2: ä»è·³è¿‡åˆ—è¡¨ä¸­ç§»é™¤
```bash
# é€‰æ‹©ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œä¾‹å¦‚ utils/test_formatters.py
sed -i '/tests\/unit\/utils\/test_formatters.py/d' tests/skipped_tests.txt

# æˆ–è€…ä½¿ç”¨ç¼–è¾‘å™¨æ‰‹åŠ¨åˆ é™¤ç›¸å…³è¡Œ
# ç¡®ä¿åˆ é™¤æ‰€æœ‰ç›¸å…³çš„æµ‹è¯•æ–¹æ³•æ¡ç›®
```

### æ­¥éª¤3: æœ¬åœ°éªŒè¯
```bash
# è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
pytest tests/unit/utils/test_formatters.py -v --tb=long

# å¦‚æœå¤±è´¥ï¼Œåˆ†æé”™è¯¯ä¿¡æ¯
# å¸¸è§é”™è¯¯ç±»å‹ï¼š
# - ImportError: ç¼ºå°‘ä¾èµ–æˆ–å¯¼å…¥é”™è¯¯
# - AttributeError: æ–¹æ³•ä¸å­˜åœ¨
# - TypeError: å‚æ•°ç±»å‹ä¸åŒ¹é…
# - AssertionError: æµ‹è¯•æ–­è¨€å¤±è´¥
```

### æ­¥éª¤4: ä¿®å¤ä»£ç é€»è¾‘
```bash
# æ ¹æ®é”™è¯¯ä¿¡æ¯è¿›è¡Œé’ˆå¯¹æ€§ä¿®å¤
# 1. æ£€æŸ¥æºä»£ç é€»è¾‘
# 2. æŸ¥çœ‹æµ‹è¯•ç”¨ä¾‹æœŸæœ›
# 3. ä¿®æ”¹ä»£ç æˆ–æµ‹è¯•ï¼ˆä¼˜å…ˆä¿®æ”¹ä»£ç ï¼‰
# 4. ç¡®ä¿ä¿®å¤åé€»è¾‘æ­£ç¡®

# è¿è¡Œæµ‹è¯•ç›´åˆ°é€šè¿‡
pytest tests/unit/utils/test_formatters.py -v
```

### æ­¥éª¤5: é›†æˆæµ‹è¯•éªŒè¯
```bash
# è¿è¡Œç›¸å…³æ¨¡å—æµ‹è¯•
pytest tests/unit/utils/ -v

# è¿è¡Œå®Œæ•´å•å…ƒæµ‹è¯•
make test.unit

# ç¡®ä¿æ²¡æœ‰ç ´åå…¶ä»–æµ‹è¯•
```

### æ­¥éª¤6: æäº¤ä¿®å¤
```bash
# æäº¤ä¿®å¤
git add tests/skipped_tests.txt <fixed_files>
git commit -m "fix(test): Recover test_formatters.py from tech debt

- Fix import/path issues in formatters module
- All 41 tests now passing
- Remove from skipped list

ğŸš€ Generated with [Claude Code](https://claude.ai/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"

git push origin main
```

---

## ğŸ›¡ï¸ é“å¾‹ä¸åŸåˆ™ (Iron Rules)

### ğŸš« **ç»å¯¹ç¦æ­¢çš„è¡Œä¸º**
1. **æ°¸è¿œä¸è¦æäº¤è®©CIå˜çº¢çš„ä»£ç **
   - å³ä½¿ä½ è®¤ä¸ºä¿®å¤å¾ˆé‡è¦ï¼Œä¹Ÿä¸èƒ½ç ´åæ„å»º
   - çº¢ç¯æ„å»ºä¼šé˜»æ­¢å›¢é˜Ÿæ‰€æœ‰äººçš„å·¥ä½œ

2. **æ°¸è¿œä¸è¦ç›´æ¥ä¿®æ”¹CIé…ç½®æ¥è·³è¿‡é—®é¢˜**
   - ä¸è¦ä¿®æ”¹ `.github/workflows/ci_pipeline_v2.yml`
   - ä¸è¦é™ä½æµ‹è¯•æ ‡å‡†æˆ–è´¨é‡é—¨ç¦

3. **æ°¸è¿œä¸è¦æ‰¹é‡åˆ é™¤è·³è¿‡æµ‹è¯•è€Œä¸éªŒè¯**
   - æ¯ä¸ªä¿®å¤éƒ½éœ€è¦éªŒè¯å…¶å¯è¡Œæ€§
   - ä¸è¦ä¸ºäº†è¿½æ±‚æ•°é‡è€Œç‰ºç‰²è´¨é‡

### âœ… **å¿…é¡»éµå¾ªçš„åŸåˆ™**
1. **å•ä¸ªæ–‡ä»¶ä¿®å¤åŸåˆ™**
   - ä¸€æ¬¡åªä¿®å¤ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶
   - é¿å…å¤§è§„æ¨¡åŒæ—¶ä¿®æ”¹

2. **æœ¬åœ°éªŒè¯ä¼˜å…ˆåŸåˆ™**
   - ç¡®ä¿æœ¬åœ°æµ‹è¯•é€šè¿‡å†æäº¤
   - ä½¿ç”¨ `make prepush` è¿›è¡Œå®Œæ•´éªŒè¯

3. **æ¸è¿›å¼æ”¹è¿›åŸåˆ™**
   - ä»ç®€å•çš„å·¥å…·ç±»å¼€å§‹
   - é€æ­¥å‘å¤æ‚çš„ä¸šåŠ¡é€»è¾‘æ¨è¿›

4. **æ–‡æ¡£åŒæ­¥åŸåˆ™**
   - ä¿®å¤åæ›´æ–°ç›¸å…³æ–‡æ¡£
   - è®°å½•ä¿®å¤è¿‡ç¨‹å’Œç»éªŒ

---

## ğŸ” é—®é¢˜åˆ†ç±»ä¸è§£å†³æ–¹æ¡ˆ

### 1. å¯¼å…¥é”™è¯¯ (ImportError)
```python
# å¸¸è§é—®é¢˜
from src.utils.missing_module import some_function  # ModuleNotFoundError

# è§£å†³æ–¹æ¡ˆ
# 1. æ£€æŸ¥æ¨¡å—è·¯å¾„æ˜¯å¦æ­£ç¡®
# 2. ç¡®ä¿æ¨¡å—åœ¨ src/ ç›®å½•ä¸­å­˜åœ¨
# 3. æ£€æŸ¥ __init__.py æ–‡ä»¶
# 4. éªŒè¯æ¨¡å—ç»“æ„
```

### 2. å±æ€§é”™è¯¯ (AttributeError)
```python
# å¸¸è§é—®é¢˜
obj.non_existent_method()  # AttributeError: 'Class' object has no attribute 'non_existent_method'

# è§£å†³æ–¹æ¡ˆ
# 1. æ£€æŸ¥æ–¹æ³•åæ˜¯å¦æ­£ç¡®
# 2. ç¡®è®¤å¯¹è±¡ç±»å‹
# 3. æŸ¥çœ‹ç±»å®šä¹‰å’Œæ–¹æ³•ç­¾å
# 4. æ›´æ–°æµ‹è¯•ä½¿ç”¨æ­£ç¡®çš„æ–¹æ³•å
```

### 3. ç±»å‹é”™è¯¯ (TypeError)
```python
# å¸¸è§é—®é¢˜
function(wrong_type_argument)  # TypeError: expected str, got int

# è§£å†³æ–¹æ¡ˆ
# 1. æ£€æŸ¥å‡½æ•°ç­¾å
# 2. è°ƒæ•´å‚æ•°ç±»å‹
# 3. æ›´æ–°æµ‹è¯•æä¾›æ­£ç¡®ç±»å‹çš„å‚æ•°
# 4. è€ƒè™‘æ·»åŠ ç±»å‹è½¬æ¢
```

### 4. æ–­è¨€é”™è¯¯ (AssertionError)
```python
# å¸¸è§é—®é¢˜
assert actual_value == expected_value  # AssertionError

# è§£å†³æ–¹æ¡ˆ
# 1. æ£€æŸ¥æµ‹è¯•é€»è¾‘æ˜¯å¦æ­£ç¡®
# 2. éªŒè¯é¢„æœŸå€¼æ˜¯å¦åˆç†
# 3. æ£€æŸ¥ä»£ç å®ç°é€»è¾‘
# 4. å¯èƒ½éœ€è¦æ›´æ–°æµ‹è¯•é¢„æœŸæˆ–ä¿®å¤ä»£ç 
```

---

## ğŸ“Š å·¥å…·å’Œå‘½ä»¤å‚è€ƒ

### ğŸ” **åˆ†æå‘½ä»¤**
```bash
# æŸ¥çœ‹è·³è¿‡æµ‹è¯•ç»Ÿè®¡
wc -l tests/skipped_tests.txt

# æŒ‰æ¨¡å—åˆ†ç»„
grep "tests/unit" tests/skipped_tests.txt | sed 's|/[^/]*::.*||' | sort | uniq -c

# æŸ¥çœ‹ç‰¹å®šæ–‡ä»¶çš„è·³è¿‡æƒ…å†µ
grep "test_formatters.py" tests/skipped_tests.txt
```

### ğŸ§ª **æµ‹è¯•å‘½ä»¤**
```bash
# å•ä¸ªæ–‡ä»¶æµ‹è¯•
pytest tests/unit/utils/test_formatters.py -v

# è¯¦ç»†é”™è¯¯è¾“å‡º
pytest tests/unit/utils/test_formatters.py -v --tb=long

# åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•
pytest tests/unit/utils/test_formatters.py -v --lf

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–¹æ³•
pytest tests/unit/utils/test_formatters.py::TestFormatDatetime::test_format_datetime_default -v
```

### ğŸ”§ **è´¨é‡æ£€æŸ¥å‘½ä»¤**
```bash
# ä»£ç æ ¼å¼åŒ–
make fix-code

# è´¨é‡æ£€æŸ¥
make check-quality

# å®Œæ•´éªŒè¯
make prepush

# æ›´æ–°æŠ€æœ¯å€ºåŠ¡æŠ¥å‘Š
python3 scripts/report_skipped_tests.py
```

---

## ğŸ“ˆ è¿›åº¦è·Ÿè¸ªä¸æŠ¥å‘Š

### ğŸ“Š **æ¯å‘¨æŠ¥å‘Šæ¨¡æ¿**
```markdown
## æŠ€æœ¯å€ºåŠ¡å‘¨æŠ¥ (Week XX)

### ä¿®å¤æˆæœ
- æœ¬å‘¨ä¿®å¤: X ä¸ªæµ‹è¯•æ–‡ä»¶
- ç´¯è®¡ä¿®å¤: Y ä¸ªæµ‹è¯•æ–‡ä»¶
- å‰©ä½™è·³è¿‡: Z ä¸ªæµ‹è¯•

### å…·ä½“ä¿®å¤
- [x] tests/unit/utils/test_formatters.py (41ä¸ªæµ‹è¯•)
- [x] tests/unit/utils/test_validators.py (12ä¸ªæµ‹è¯•)
- [ ] tests/unit/services/test_auth_service.py (35ä¸ªæµ‹è¯•)

### é‡åˆ°çš„é—®é¢˜
- **é—®é¢˜**: å¤æ‚ä¾èµ–å…³ç³»éš¾ä»¥è§£å†³
- **è§£å†³æ–¹æ¡ˆ**: é‡æ„ç›¸å…³ä»£ç ï¼Œé™ä½è€¦åˆåº¦

### ä¸‹å‘¨è®¡åˆ’
- ä¼˜å…ˆä¿®å¤ services æ¨¡å—çš„æµ‹è¯•
- ç›®æ ‡ä¿®å¤ 15-20 ä¸ªæµ‹è¯•
```

### ğŸ“‹ **è¿›åº¦ä»ªè¡¨æ¿**
```bash
# ç”Ÿæˆå½“å‰çŠ¶æ€æŠ¥å‘Š
echo "=== æŠ€æœ¯å€ºåŠ¡çŠ¶æ€ ==="
echo "è·³è¿‡æµ‹è¯•æ•°é‡: $(wc -l < tests/skipped_tests.txt)"
echo "æ¢å¤æµ‹è¯•æ•°é‡: $(python3 scripts/report_skipped_tests.py | grep 'æ€»è·³è¿‡æµ‹è¯•æ•°' | awk '{print $4}')"
echo "æ¢å¤ç™¾åˆ†æ¯”: $(python3 -c "
original = 1117
current = $(wc -l < tests/skipped_tests.txt)
recovery = ((original - current) / original * 100)
print(f'{recovery:.1f}%')
")"
```

---

## ğŸ¤ å›¢é˜Ÿåä½œæŒ‡å—

### ğŸ‘¥ **è§’è‰²åˆ†å·¥**
- **æŠ€æœ¯è´Ÿè´£äºº**: æ•´ä½“è§„åˆ’ï¼Œä»£ç å®¡æŸ¥
- **é«˜çº§å·¥ç¨‹å¸ˆ**: å¤æ‚æ¨¡å—ä¿®å¤ï¼Œæ¶æ„ä¼˜åŒ–
- **ä¸­çº§å·¥ç¨‹å¸ˆ**: æ ‡å‡†æ¨¡å—ä¿®å¤ï¼Œæµ‹è¯•ç¼–å†™
- **åˆçº§å·¥ç¨‹å¸ˆ**: ç®€å•å·¥å…·ç±»ä¿®å¤ï¼Œæ–‡æ¡£æ›´æ–°

### ğŸ”„ **ä»£ç å®¡æŸ¥è¦ç‚¹**
1. **åŠŸèƒ½æ€§**: ä¿®å¤æ˜¯å¦è§£å†³äº†åŸå§‹é—®é¢˜
2. **è´¨é‡æ€§**: ä»£ç æ˜¯å¦éµå¾ªé¡¹ç›®æ ‡å‡†
3. **æµ‹è¯•æ€§**: æ˜¯å¦æ·»åŠ äº†å¿…è¦çš„æµ‹è¯•
4. **æ–‡æ¡£æ€§**: æ˜¯å¦æ›´æ–°äº†ç›¸å…³æ–‡æ¡£

### ğŸ“‹ **Pull Requestæ¨¡æ¿**
```markdown
## ä¿®å¤è¯´æ˜
- ä¿®å¤çš„æµ‹è¯•æ–‡ä»¶: tests/unit/utils/test_formatters.py
- æ¢å¤çš„æµ‹è¯•æ•°é‡: 41ä¸ª
- ä¿®å¤çš„ä¸»è¦é—®é¢˜: å¯¼å…¥è·¯å¾„é”™è¯¯å’Œæ–¹æ³•ç­¾åå˜æ›´

## æµ‹è¯•éªŒè¯
- [x] å•ä¸ªæ–‡ä»¶æµ‹è¯•é€šè¿‡
- [x] æ¨¡å—æµ‹è¯•é€šè¿‡
- [x] å®Œæ•´å•å…ƒæµ‹è¯•é€šè¿‡
- [x] CIæ„å»ºéªŒè¯

## å½±å“èŒƒå›´
- æ— ç ´åæ€§å˜æ›´
- å‘åå…¼å®¹
- ä¸å½±å“å…¶ä»–æ¨¡å—

## ç›¸å…³æ–‡æ¡£
- [æŠ€æœ¯å€ºåŠ¡è¿˜å€ºæŒ‡å—](docs/TEST_DEBT_GUIDE.md)
- [é¡¹ç›®äº¤æ¥æŒ‡å—](docs/PROJECT_HANDOVER.md)
```

---

## ğŸš€ è‡ªåŠ¨åŒ–å·¥å…·ä½¿ç”¨

### ğŸŒ¾ **The Test Harvester**
```bash
# å®šæœŸè¿è¡Œæµ‹è¯•æ”¶å‰²å™¨
python3 scripts/harvest_passing_tests.py

# æ¼”ç»ƒæ¨¡å¼ï¼ˆä¸å®é™…ä¿®æ”¹æ–‡ä»¶ï¼‰
python3 scripts/harvest_passing_tests.py --dry-run
```

### ğŸ“Š **æŠ€æœ¯å€ºåŠ¡æŠ¥å‘Š**
```bash
# æ›´æ–°æŠ€æœ¯å€ºåŠ¡æŠ¥å‘Š
python3 scripts/report_skipped_tests.py

# æŸ¥çœ‹HTMLæŠ¥å‘Š
make cov.html
```

### ğŸ”§ **ä»£ç è´¨é‡å·¥å…·**
```bash
# è‡ªåŠ¨ä»£ç ä¿®å¤
make fix-code

# ç”Ÿæˆè´¨é‡è¯„åˆ†
make check-quality

# å®‰å…¨æ‰«æ
make security-check
```

---

## ğŸ¯ æˆåŠŸæŒ‡æ ‡

### ğŸ“Š **é‡åŒ–ç›®æ ‡**
- **çŸ­æœŸç›®æ ‡** (1ä¸ªæœˆ): å‡å°‘åˆ°200ä¸ªè·³è¿‡æµ‹è¯•
- **ä¸­æœŸç›®æ ‡** (3ä¸ªæœˆ): å‡å°‘åˆ°100ä¸ªè·³è¿‡æµ‹è¯•
- **é•¿æœŸç›®æ ‡** (6ä¸ªæœˆ): å‡å°‘åˆ°50ä¸ªè·³è¿‡æµ‹è¯•
- **ç»ˆæç›®æ ‡**: è¦†ç›–ç‡è¾¾åˆ°40%

### ğŸ† **è´¨é‡æŒ‡æ ‡**
- CIæ„å»ºæˆåŠŸç‡: ä¿æŒ100%
- æµ‹è¯•é€šè¿‡ç‡: ä¿æŒ95%+
- ä»£ç è´¨é‡è¯„åˆ†: ä¿æŒAçº§
- å®‰å…¨æ‰«æ: æ— é«˜å±æ¼æ´

---

## ğŸ“ æ”¯æŒä¸å¸®åŠ©

### ğŸ†˜ **é‡åˆ°é—®é¢˜æ—¶**
1. **æŸ¥çœ‹æ—¥å¿—**: è¯¦ç»†åˆ†ææµ‹è¯•å¤±è´¥åŸå› 
2. **è¯·æ•™åŒäº‹**: å¯»æ±‚æ›´æœ‰ç»éªŒçš„å¼€å‘è€…å¸®åŠ©
3. **å‚è€ƒæ–‡æ¡£**: æŸ¥çœ‹ç›¸å…³æŠ€æœ¯æ–‡æ¡£
4. **ä½¿ç”¨å·¥å…·**: åˆ©ç”¨è‡ªåŠ¨åŒ–å·¥å…·è¾…åŠ©åˆ†æ

### ğŸ“š **å­¦ä¹ èµ„æº**
- [Pythonæµ‹è¯•æœ€ä½³å®è·µ](https://docs.pytest.org/)
- [ä»£ç è´¨é‡æŒ‡å—](docs/TESTING_GUIDE.md)
- [é¡¹ç›®æ¶æ„æ–‡æ¡£](docs/PROJECT_HANDOVER.md)
- [CI/CDé…ç½®è¯´æ˜](.github/workflows/)

---

## ğŸ“ æ€»ç»“

æŠ€æœ¯å€ºåŠ¡ç®¡ç†æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œéœ€è¦å›¢é˜Ÿçš„å…±åŒåŠªåŠ›å’Œè€å¿ƒã€‚é€šè¿‡éµå¾ªæœ¬æŒ‡å—ä¸­çš„æ ‡å‡†åŒ–æµç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š

1. **ç³»ç»Ÿæ€§åœ°**é€æ­¥è§£å†³æŠ€æœ¯å€ºåŠ¡
2. **å®‰å…¨åœ°**ä¿æŒCI/CDæµæ°´çº¿ç¨³å®š
3. **é«˜æ•ˆåœ°**æå‡ä»£ç è´¨é‡å’Œæµ‹è¯•è¦†ç›–ç‡
4. **å¯æŒç»­åœ°**æ”¹è¿›é¡¹ç›®æ•´ä½“å¥åº·çŠ¶å†µ

è®°ä½ï¼š**è´¨é‡æ˜¯å›¢é˜Ÿçš„è´£ä»»ï¼Œä¸æ˜¯ä¸ªäººçš„è´Ÿæ‹…ã€‚**

---

*æ–‡æ¡£ç‰ˆæœ¬: v1.0 | ç»´æŠ¤è€…: DevOpså›¢é˜Ÿ | æœ€åæ›´æ–°: 2025-11-20*