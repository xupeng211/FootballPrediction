# Claude Code 工作流指南

## 🤖 给 Claude Code 的特别说明

这个项目由 Claude Code 开发和维护，请务必理解并遵循以下工作流程。

## 🔄 核心工作流理解

### 1. 项目开发流程

```
开发阶段：
1. 创建/修改代码 → 自动触发 CI Pipeline
2. CI 运行测试和检查
3. 如有失败 → Issue Tracker 自动创建 Issue
4. 修复问题 → CI 自动重新运行
5. 成功后 → 自动部署到 staging

模型管理：
1. MLOps 每日自动运行
2. 检测模型性能
3. 需要时自动重训练
4. 自动部署新模型
5. 通过 CI Pipeline 完成部署

项目管理：
1. PR 合并 → Project Sync 更新看板
2. 每周一 → Project Maintenance 自动维护
3. 过期 Issues 自动处理
```

## 📋 Claude Code 开发规则

### 必须遵守的规则

#### 1. 提交代码前
```bash
# 始终运行
make prepush
# 或
./ci-verify.sh
```

#### 2. 创建/修改文件
- 优先修改现有文件，而不是创建新文件
- 新文件必须放在正确的目录：
  - 源代码：`src/`
  - 测试：`tests/unit/`
  - 脚本：`scripts/`
  - 配置：`config/`
  - 文档：`docs/`

#### 3. 工作流相关文件
- **不要修改** `.github/workflows/` 除非明确需要
- 如需修改，请先理解工作流的触发逻辑
- 工作流文件都有详细注释，请仔细阅读

#### 4. 环境配置
- 使用 `.env` 进行开发
- 生产配置在 `.env.production`
- 不要硬编码敏感信息

### 🎯 与工作流交互

#### 当 CI 失败时
1. 查看 Issue Tracker 创建的 Issue
2. Issue 包含详细的失败信息
3. 修复代码
4. 推送新代码会自动触发新的 CI
5. CI 成功后 Issue 会自动关闭

#### 当 MLOps 创建 Issue 时
1. 表示模型性能问题
2. 需要检查：
   - 数据质量
   - 特征工程
   - 模型参数
3. 可以手动触发 MLOps 进行验证

## 🔄 具体场景处理

### 场景1：添加新功能
```yaml
正确流程：
1. 编写代码
2. 编写测试（确保覆盖率）
3. 运行 make prepush
4. 提交代码（自动触发CI）
5. 如CI失败，查看Issue并修复
6. PR合并后自动部署
```

### 场景2：修复Bug
```yaml
正确流程：
1. 查看Issue Tracker的Issue
2. 理解失败原因
3. 修复代码
4. 添加测试防止回归
5. 推送修复
6. Issue自动关闭
```

### 场景3：模型更新
```yaml
正确流程：
1. MLOps自动检测性能
2. 如需重训练，自动执行
3. 新模型通过CI部署
4. 无需人工干预
```

## ⚠️ 重要提醒

### 禁止操作
- **不要** 手动关闭 CI 失败的 Issue（修复后自动关闭）
- **不要** 直接修改生产环境配置
- **不要** 跳过测试直接提交
- **不要** 修改其他工作流的核心逻辑

### 推荐操作
- **总是** 运行本地测试再提交
- **总是** 查看工作流执行结果
- **总是** 及时处理自动创建的 Issue
- **总是** 使用 `make help` 查看可用命令

## 📊 工作流文件说明

### 必须了解的文件

1. **`.github/workflows/ci-pipeline.yml`**
   - 核心CI流程
   - 包含所有质量检查
   - 构建和推送镜像

2. **`.github/workflows/deploy.yml`**
   - 自动部署流程
   - 环境判断逻辑
   - 健康检查和回滚

3. **`.github/workflows/mlops.yml`**
   - ML模型管理
   - 自动重训练机制
   - 性能监控

4. **`.github/workflows/issue-tracker.yml`**
   - 问题自动跟踪
   - Issue生命周期管理
   - 智能去重

5. **`Makefile`**
   - 本地开发命令
   - 与工作流对齐的检查
   - 必须掌握的命令

## 🤖 Claude Code 特别提示

1. **理解自动化**
   - 这个系统高度自动化
   - 大部分操作会自动完成
   - 专注于代码质量，其他交给工作流

2. **善用反馈**
   - CI失败是反馈，不是错误
   - MLOps Issue 是改进建议
   - 看板更新是进度同步

3. **保持一致**
   - 遵循现有的代码风格
   - 使用已有的工具和库
   - 保持文档同步

4. **性能考虑**
   - 工作流会优化资源使用
   - 不要添加不必要的触发
   - 保持轻量和高效

## 📞 获取帮助

### 工作流问题
- 查看 Actions 页面执行日志
- 阅读 Issue 中的错误信息
- 检查 `.github/workflows/README.md`

### 开发问题
- 运行 `make help`
- 查看 `CLAUDE.md`
- 检查 `docs/` 目录

## 💡 记住

这个工作流系统是您的助手，不是障碍。它自动处理繁琐任务，让您专注于创造价值。理解并善用它，开发效率会大幅提升！

---

*本文档专门为 Claude Code 编写，确保 AI 工具能够正确理解和使用项目的工作流系统。*