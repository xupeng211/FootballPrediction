# 依赖漏洞与升级报告

## 📅 生成时间
2025-10-02

## 🔍 扫描工具
- 工具: pip-audit 2.7.0
- 范围: 所有已安装的 Python 包

## ⚠️ 发现的漏洞

### 高危漏洞 (1个)

1. **mlflow 3.4.0** - CVE-2024-37059
   - **漏洞ID**: GHSA-wf7f-8fxf-xfxc
   - **严重性**: 高危
   - **描述**: Deserialization of untrusted data can occur in versions of the MLflow platform running version 0.5.0 or newer, enabling a maliciously uploaded PyTorch model to run arbitrary code on an end user's system when interacted with.
   - **修复版本**: 无 (需要替换或升级到最新版本)
   - **影响**: 远程代码执行
   - **建议**: 立即升级到最新版本或评估替换方案

### 中危漏洞 (2个)

2. **authlib 1.6.1** - CVE-2025-59420
   - **漏洞ID**: GHSA-9ggr-2464-2j32
   - **严重性**: 中危
   - **描述**: JWS verification accepts tokens that declare unknown critical header parameters (`crit`), violating RFC 7515 "must-understand" semantics
   - **修复版本**: 1.6.4
   - **影响**: 认证绕过、权限提升
   - **建议**: 升级到 1.6.4 或更高版本

3. **jupyterlab 4.4.7** - CVE-2025-59842
   - **漏洞ID**: GHSA-vvfj-2jqx-52jm
   - **严重性**: 低危
   - **描述**: Links generated with LaTeX typesetters in Markdown files did not include the `noopener` attribute
   - **修复版本**: 4.4.8
   - **影响**: 反向标签页钓鱼攻击
   - **建议**: 升级到 4.4.8 或更高版本

### 工具漏洞 (1个)

4. **pip 25.2** - CVE-2025-8869
   - **漏洞ID**: GHSA-4xh5-x5gv-qwph
   - **严重性**: 中危
   - **描述**: In the fallback extraction path for source distributions, pip used Python's tarfile module without verifying that symbolic/hard link targets resolve inside the intended extraction directory
   - **修复版本**: 无 (已包含在 25.2 中)
   - **影响**: 任意文件覆盖
   - **状态**: 已在当前版本修复

## 📊 风险评估

### 需要立即处理
- **mlflow**: 存在远程代码执行风险，需要立即处理
- **authlib**: 存在认证绕过风险，建议尽快升级

### 可以计划处理
- **jupyterlab**: 风险较低，可在下次更新时处理
- **pip**: 已在当前版本修复，无需额外处理

## 🎯 推荐行动计划

### Phase 8.1: 高危依赖升级 (立即执行)

1. **mlflow 升级**
   ```bash
   pip install --upgrade mlflow
   ```
   如果升级失败，考虑：
   - 评估是否真的需要 MLflow
   - 查找替代方案 (如 DVC、Weights & Biases)

2. **authlib 升级**
   ```bash
   pip install --upgrade authlib==1.6.4
   ```

3. **jupyterlab 升级**
   ```bash
   pip install --upgrade jupyterlab
   ```

### Phase 8.2: 验证升级

1. 重新运行漏洞扫描：
   ```bash
   pip-audit
   ```

2. 运行测试确保兼容性：
   ```bash
   make test-quick
   ```

## 📝 豁免依赖评估

根据 Phase 8 要求，以下依赖可能需要豁免：

### 已知无法升级的依赖
- feast 0.53.0: pydantic 版本冲突，可能需要保留
- protobuf 6.32.0: MLflow 依赖，需要协调升级
- sqlalchemy-utils 0.42.0: 需要检查替代方案

### 建议的豁免条件
1. feast: 如果没有安全漏洞，可以暂时保留
2. 其他依赖: 必须先验证是否有已知漏洞

## 📋 后续步骤

1. **立即执行**: 升级高危依赖
2. **创建豁免文档**: 对于无法升级的依赖，创建 `SECURITY_RISK_ACCEPTED.md`
3. **CI 集成**: 在 CI 流程中添加依赖安全检查
4. **定期扫描**: 建立每周依赖安全扫描机制

## 🔗 相关文档

- [Phase 8 进度报告](../_reports/PHASE8_PROGRESS.md)
- [任务看板](../../TASK_KANBAN.md)
- [安全指南](../ops/SECURITY_GUIDE.md)