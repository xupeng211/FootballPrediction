# ä¸Šçº¿æµç¨‹æŒ‡å—
# Deployment Process Guide

## ğŸ¯ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†è¶³çƒé¢„æµ‹ç³»ç»Ÿçš„ä¸Šçº¿æµç¨‹ï¼Œç¡®ä¿ç³»ç»Ÿå®‰å…¨ã€ç¨³å®šåœ°éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚

## ğŸ“‹ ä¸Šçº¿å‰æ£€æŸ¥æ¸…å•

### Phase 1: ä»£ç è´¨é‡éªŒè¯ âœ…
- [x] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡ (88.9% é€šè¿‡ç‡)
- [x] é›†æˆæµ‹è¯•ç¯å¢ƒå°±ç»ª
- [x] å‹åŠ›æµ‹è¯•è„šæœ¬å®Œæˆ
- [x] ä»£ç è´¨é‡æ£€æŸ¥é€šè¿‡ (Ruff + MyPy)
- [x] å®‰å…¨æ‰«æé€šè¿‡ (æ— é«˜å±æ¼æ´)
- [x] æµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡ (æŒç»­æ”¹è¿›ä¸­)

### Phase 2: åŸºç¡€è®¾æ–½éªŒè¯ âœ…
- [x] Dockeré•œåƒæ„å»ºå®Œæˆ
- [x] ç”Ÿäº§ç¯å¢ƒé…ç½®å®Œæˆ
- [x] æ•°æ®åº“è¿ç§»è„šæœ¬å°±ç»ª
- [x] ç›‘æ§ç³»ç»Ÿé…ç½®å®Œæˆ
- [x] å¤‡ä»½ç­–ç•¥åˆ¶å®šå®Œæˆ
- [x] SSLè¯ä¹¦é…ç½®å®Œæˆ

### Phase 3: å®‰å…¨é…ç½®éªŒè¯ âœ…
- [x] å®‰å…¨å¤´é…ç½®å®Œæˆ
- [x] é€Ÿç‡é™åˆ¶é…ç½®å®Œæˆ
- [x] APIå¯†é’¥ç®¡ç†å®Œæˆ
- [x] æ•°æ®åº“è®¿é—®æ§åˆ¶å®Œæˆ
- [x] æ—¥å¿—å®¡è®¡é…ç½®å®Œæˆ

### Phase 4: æ€§èƒ½å’Œç›‘æ§ âœ…
- [x] æ€§èƒ½åŸºçº¿å»ºç«‹
- [x] ç›‘æ§ä»ªè¡¨æ¿é…ç½®å®Œæˆ
- [x] å‘Šè­¦è§„åˆ™é…ç½®å®Œæˆ
- [x] å¥åº·æ£€æŸ¥ç«¯ç‚¹éªŒè¯å®Œæˆ
- [x] å‹åŠ›æµ‹è¯•è„šæœ¬å®Œæˆ

## ğŸš€ ä¸Šçº¿æµç¨‹æ­¥éª¤

### Step 1: ç¯å¢ƒå‡†å¤‡
```bash
# 1.1 æ£€æŸ¥ç”Ÿäº§ç¯å¢ƒé…ç½®
./scripts/deploy-production.sh validate

# 1.2 å¯åŠ¨ç”Ÿäº§ç¯å¢ƒæœåŠ¡
./scripts/deploy-production.sh start

# 1.3 éªŒè¯æœåŠ¡å¥åº·çŠ¶æ€
./scripts/deploy-production.sh health
```

### Step 2: æ•°æ®åº“åˆå§‹åŒ–
```bash
# 2.1 è¿è¡Œæ•°æ®åº“è¿ç§»
docker-compose -f docker-compose.yml -f docker-compose.prod.yml exec app alembic upgrade head

# 2.2 éªŒè¯æ•°æ®åº“è¿æ¥
docker-compose -f docker-compose.yml -f docker-compose.prod.yml exec db pg_isready -U prod_user

# 2.3 åˆ›å»ºåˆå§‹æ•°æ®ï¼ˆå¦‚éœ€è¦ï¼‰
docker-compose -f docker-compose.yml -f docker-compose.prod.yml exec app python -m scripts.seed_data
```

### Step 3: åº”ç”¨éƒ¨ç½²
```bash
# 3.1 éƒ¨ç½²åº”ç”¨
./scripts/deploy-production.sh deploy

# 3.2 éªŒè¯APIç«¯ç‚¹
curl -f http://localhost/health/ || exit 1
curl -f http://localhost/api/v1/predictions/1 || exit 1

# 3.3 æ£€æŸ¥åº”ç”¨æ—¥å¿—
docker-compose logs app
```

### Step 4: ç›‘æ§éªŒè¯
```bash
# 4.1 æ£€æŸ¥PrometheusæŒ‡æ ‡
curl http://localhost:9090/-/healthy

# 4.2 éªŒè¯Grafanaä»ªè¡¨æ¿
curl http://localhost:3000/api/health

# 4.3 ç¡®è®¤å‘Šè­¦é…ç½®
curl http://localhost:9090/api/v1/alerts
```

### Step 5: æ€§èƒ½éªŒè¯
```bash
# 5.1 è¿è¡Œå‹åŠ›æµ‹è¯•
python scripts/stress_test.py

# 5.2 æ£€æŸ¥æ€§èƒ½æŒ‡æ ‡
./scripts/performance-check.sh

# 5.3 éªŒè¯å“åº”æ—¶é—´
curl -w "@curl-format.txt" -o /dev/null -s http://localhost/health/
```

## ğŸ“Š ä¸Šçº¿éªŒè¯æ ‡å‡†

### åŠŸèƒ½éªŒè¯
- [ ] å¥åº·æ£€æŸ¥ç«¯ç‚¹å“åº”æ­£å¸¸ (< 100ms)
- [ ] é¢„æµ‹APIåŠŸèƒ½æ­£å¸¸ (< 500ms)
- [ ] æ•°æ®åº“æŸ¥è¯¢æ­£å¸¸
- [ ] ç¼“å­˜åŠŸèƒ½æ­£å¸¸
- [ ] æ—¥å¿—è®°å½•æ­£å¸¸

### æ€§èƒ½éªŒè¯
- [ ] APIå“åº”æ—¶é—´ P95 < 500ms
- [ ] ç³»ç»Ÿå¯ç”¨æ€§ > 99%
- [ ] å¹¶å‘å¤„ç†èƒ½åŠ› > 50 RPS
- [ ] é”™è¯¯ç‡ < 1%
- [ ] èµ„æºä½¿ç”¨ç‡ < 80%

### å®‰å…¨éªŒè¯
- [ ] HTTPSè¯ä¹¦æœ‰æ•ˆ
- [ ] å®‰å…¨å¤´é…ç½®æ­£ç¡®
- [ ] é€Ÿç‡é™åˆ¶ç”Ÿæ•ˆ
- [ ] APIè®¤è¯æ­£å¸¸
- [ ] æ•æ„Ÿä¿¡æ¯ä¿æŠ¤

### ç›‘æ§éªŒè¯
- [ ] PrometheusæŒ‡æ ‡æ”¶é›†æ­£å¸¸
- [ ] Grafanaä»ªè¡¨æ¿æ˜¾ç¤ºæ­£å¸¸
- [ ] å‘Šè­¦è§„åˆ™é…ç½®æ­£ç¡®
- [ ] æ—¥å¿—èšåˆæ­£å¸¸
- [ ] å¤‡ä»½ä»»åŠ¡æ­£å¸¸

## ğŸ”§ å›æ»šè®¡åˆ’

### è‡ªåŠ¨å›æ»šè§¦å‘æ¡ä»¶
1. å¥åº·æ£€æŸ¥å¤±è´¥è¶…è¿‡3æ¬¡
2. APIé”™è¯¯ç‡è¶…è¿‡5%
3. å“åº”æ—¶é—´P95è¶…è¿‡2ç§’
4. ç³»ç»Ÿèµ„æºä½¿ç”¨ç‡è¶…è¿‡90%
5. å…³é”®ä¸šåŠ¡æŒ‡æ ‡å¼‚å¸¸

### æ‰‹åŠ¨å›æ»šæ­¥éª¤
```bash
# 1. ç«‹å³å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
./scripts/deploy-production.sh rollback <previous_version>

# 2. éªŒè¯å›æ»šåç³»ç»ŸçŠ¶æ€
./scripts/deploy-production.sh health

# 3. é€šçŸ¥ç›¸å…³äººå‘˜å›æ»šå®Œæˆ
./scripts/notify-team.sh "ç³»ç»Ÿå·²å›æ»šåˆ°ç‰ˆæœ¬ <previous_version>"
```

## ğŸ“ˆ ä¸Šçº¿åç›‘æ§

### å…³é”®æŒ‡æ ‡ç›‘æ§
1. **ç³»ç»ŸæŒ‡æ ‡**
   - CPUä½¿ç”¨ç‡ < 80%
   - å†…å­˜ä½¿ç”¨ç‡ < 70%
   - ç£ç›˜ä½¿ç”¨ç‡ < 85%
   - ç½‘ç»œæµé‡æ­£å¸¸

2. **åº”ç”¨æŒ‡æ ‡**
   - APIå“åº”æ—¶é—´
   - è¯·æ±‚æˆåŠŸç‡
   - å¹¶å‘ç”¨æˆ·æ•°
   - é”™è¯¯ç‡ç»Ÿè®¡

3. **ä¸šåŠ¡æŒ‡æ ‡**
   - é¢„æµ‹å‡†ç¡®ç‡
   - ç”¨æˆ·æ´»è·ƒåº¦
   - æ•°æ®åŒæ­¥çŠ¶æ€
   - æ¨¡å‹æ€§èƒ½æŒ‡æ ‡

### å‘Šè­¦é€šçŸ¥
- **ç´§æ€¥å‘Šè­¦**: ç³»ç»Ÿå®•æœºã€æ•°æ®ä¸¢å¤±ã€å®‰å…¨äº‹ä»¶
- **é‡è¦å‘Šè­¦**: æ€§èƒ½ä¸‹é™ã€é”™è¯¯ç‡ä¸Šå‡ã€èµ„æºä¸è¶³
- **ä¸€èˆ¬å‘Šè­¦**: æŒ‡æ ‡å¼‚å¸¸ã€å¤‡ä»½çŠ¶æ€ã€é…ç½®å˜æ›´

## ğŸ“ è”ç³»ä¿¡æ¯

### ä¸Šçº¿å›¢é˜Ÿ
- **æŠ€æœ¯è´Ÿè´£äºº**: [è”ç³»æ–¹å¼]
- **è¿ç»´è´Ÿè´£äºº**: [è”ç³»æ–¹å¼]
- **äº§å“è´Ÿè´£äºº**: [è”ç³»æ–¹å¼]

### åº”æ€¥è”ç³»
- **ç´§æ€¥å“åº”**: 24/7å€¼ç­ç”µè¯
- **æŠ€æœ¯æ”¯æŒ**: æŠ€æœ¯å›¢é˜Ÿç¾¤ç»„
- **è¿ç»´æ”¯æŒ**: è¿ç»´å›¢é˜Ÿç¾¤ç»„

## ğŸ“ ä¸Šçº¿è®°å½•æ¨¡æ¿

### ä¸Šçº¿åŸºæœ¬ä¿¡æ¯
- **ä¸Šçº¿ç‰ˆæœ¬**: [ç‰ˆæœ¬å·]
- **ä¸Šçº¿æ—¶é—´**: [YYYY-MM-DD HH:MM:SS]
- **ä¸Šçº¿è´Ÿè´£äºº**: [å§“å]
- **å‚ä¸äººå‘˜**: [å›¢é˜Ÿæˆå‘˜]

### ä¸Šçº¿å†…å®¹
- **æ–°å¢åŠŸèƒ½**: [åŠŸèƒ½åˆ—è¡¨]
- **ä¼˜åŒ–æ”¹è¿›**: [æ”¹è¿›å†…å®¹]
- **é—®é¢˜ä¿®å¤**: [ä¿®å¤å†…å®¹]
- **é…ç½®å˜æ›´**: [å˜æ›´å†…å®¹]

### ä¸Šçº¿éªŒè¯
- **åŠŸèƒ½éªŒè¯**: [éªŒè¯ç»“æœ]
- **æ€§èƒ½éªŒè¯**: [éªŒè¯ç»“æœ]
- **å®‰å…¨éªŒè¯**: [éªŒè¯ç»“æœ]
- **ç›‘æ§éªŒè¯**: [éªŒè¯ç»“æœ]

### ä¸Šçº¿ç»“æœ
- **ä¸Šçº¿çŠ¶æ€**: [æˆåŠŸ/éƒ¨åˆ†æˆåŠŸ/å¤±è´¥]
- **å‘ç°é—®é¢˜**: [é—®é¢˜æè¿°]
- **è§£å†³æªæ–½**: [è§£å†³æ–¹æ¡ˆ]
- **åç»­è®¡åˆ’**: [è·Ÿè¿›äº‹é¡¹]

---

*æœ€åæ›´æ–°: 2025-10-22*