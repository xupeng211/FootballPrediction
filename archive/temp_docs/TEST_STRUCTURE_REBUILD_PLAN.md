# ğŸ§ª æµ‹è¯•ç»“æ„é‡å»ºè®¡åˆ’ (TEST_STRUCTURE_REBUILD_PLAN.md)

> **ç”Ÿæˆæ—¶é—´**: 2025-10-24
> **ä¸“å®¶**: æµ‹è¯•æ¶æ„ä¸“å®¶
> **é¡¹ç›®**: è¶³çƒèµ›æœé¢„æµ‹ç³»ç»Ÿ (Football Prediction System)

---

## ğŸ“Š å½“å‰æµ‹è¯•å¥—ä»¶ç°çŠ¶åˆ†æ

### ğŸ” åŸºç¡€ç»Ÿè®¡
- **æµ‹è¯•æ–‡ä»¶æ€»æ•°**: 760ä¸ª
- **åŒ…å«æµ‹è¯•å‡½æ•°çš„æ–‡ä»¶**: 690ä¸ª (90.8%)
- **åŒ…å«æ–­è¨€çš„æ–‡ä»¶**: 636ä¸ª (83.7%)
- **å‘½åè§„èŒƒæ–‡ä»¶**: 719ä¸ª (94.6%)
- **ä½¿ç”¨Mockçš„æ–‡ä»¶**: 458ä¸ª (60.3%)
- **æ€»ä»£ç è¡Œæ•°**: 190,557è¡Œ
- **æ— æµ‹è¯•å‡½æ•°çš„æ–‡ä»¶**: 70ä¸ª (9.2%)

### ğŸ“‚ ç›®å½•ç»“æ„åˆ†æ
```
tests/ (760 files)
â”œâ”€â”€ unit/                    (673 files) - å•å…ƒæµ‹è¯• â­
â”œâ”€â”€ integration/             (26 files)  - é›†æˆæµ‹è¯•
â”œâ”€â”€ e2e/                     (10 files)  - ç«¯åˆ°ç«¯æµ‹è¯•
â”œâ”€â”€ performance/             (1 file)    - æ€§èƒ½æµ‹è¯•
â”œâ”€â”€ api/                     (8 files)   - APIæµ‹è¯•
â”œâ”€â”€ database/                (7 files)   - æ•°æ®åº“æµ‹è¯•
â”œâ”€â”€ services/                (21 files)  - æœåŠ¡æµ‹è¯•
â”œâ”€â”€ cache/                   (4 files)   - ç¼“å­˜æµ‹è¯•
â”œâ”€â”€ fixtures/                (7 files)   - æµ‹è¯•å¤¹å…·
â”œâ”€â”€ helpers/                 (7 files)   - æµ‹è¯•è¾…åŠ©å·¥å…·
â”œâ”€â”€ mocks/                   (7 files)   - Mockå¯¹è±¡
â”œâ”€â”€ disabled/                (empty)     - å·²ç¦ç”¨æµ‹è¯•
â””â”€â”€ problematic/             (empty)     - é—®é¢˜æµ‹è¯•
```

### âš ï¸ å‘ç°çš„ä¸»è¦é—®é¢˜

1. **ç»“æ„æ··ä¹±**: æµ‹è¯•æ–‡ä»¶åˆ†æ•£åœ¨å¤šä¸ªå­ç›®å½•ä¸­ï¼Œç¼ºä¹ç»Ÿä¸€ç»„ç»‡
2. **å‘½åä¸ä¸€è‡´**: 41ä¸ªæ–‡ä»¶å‘½åä¸ç¬¦åˆæ ‡å‡†è§„èŒƒ
3. **åŠŸèƒ½é‡å **: unitç›®å½•ä¸‹åŒ…å«integrationæµ‹è¯•ï¼ŒèŒè´£ä¸æ¸…
4. **èµ„æºæµªè´¹**: 70ä¸ªæ–‡ä»¶æ— æµ‹è¯•å‡½æ•°ï¼Œå ç”¨å­˜å‚¨å’Œç»´æŠ¤èµ„æº
5. **ä¾èµ–ç¼ºå¤±**: 124ä¸ªæ–‡ä»¶ç¼ºå°‘æ–­è¨€ï¼Œæµ‹è¯•ä»·å€¼ä½
6. **ç¼“å­˜æ±¡æŸ“**: å¤§é‡__pycache__ç›®å½•å½±å“æ‰§è¡Œæ•ˆç‡

---

## ğŸ¯ é‡æ„ç›®æ ‡ä¸åŸåˆ™

### æ ¸å¿ƒç›®æ ‡
- âœ… æå‡æµ‹è¯•è¦†ç›–ç‡ä»13.52%åˆ°30%+
- âœ… æ ‡å‡†åŒ–æµ‹è¯•ç›®å½•ç»“æ„
- âœ… ç»Ÿä¸€å‘½åè§„èŒƒå’Œæ ‡è®°ä½“ç³»
- âœ… æå‡æµ‹è¯•æ‰§è¡Œæ•ˆç‡
- âœ… å¢å¼ºæµ‹è¯•å¯ç»´æŠ¤æ€§

### é‡æ„åŸåˆ™
1. **ä¸ç ´åä¸»åˆ†æ”¯å¯è¿è¡Œæ€§**
2. **ä¿ç•™åŠŸèƒ½å®Œæ•´çš„æµ‹è¯•**
3. **éµå¾ªpytestæœ€ä½³å®è·µ**
4. **å®ç°æ¨¡å—åŒ–æµ‹è¯•ç»„ç»‡**
5. **å»ºç«‹æ¸…æ™°çš„ä¾èµ–éš”ç¦»**

---

## ğŸ“ å»ºè®®çš„æ ‡å‡†åŒ–ç»“æ„

```
tests/
â”œâ”€â”€ unit/                           # å•å…ƒæµ‹è¯• (ç›®æ ‡: 85% of tests)
â”‚   â”œâ”€â”€ api/                       # APIå±‚å•å…ƒæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_api_endpoints.py
â”‚   â”‚   â”œâ”€â”€ test_api_models.py
â”‚   â”‚   â””â”€â”€ test_api_validators.py
â”‚   â”œâ”€â”€ domain/                    # é¢†åŸŸå±‚å•å…ƒæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_domain_models.py
â”‚   â”‚   â”œâ”€â”€ test_domain_services.py
â”‚   â”‚   â””â”€â”€ test_domain_events.py
â”‚   â”œâ”€â”€ services/                  # æœåŠ¡å±‚å•å…ƒæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_prediction_service.py
â”‚   â”‚   â”œâ”€â”€ test_data_service.py
â”‚   â”‚   â””â”€â”€ test_cache_service.py
â”‚   â”œâ”€â”€ database/                  # æ•°æ®åº“å•å…ƒæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_repositories.py
â”‚   â”‚   â”œâ”€â”€ test_models.py
â”‚   â”‚   â””â”€â”€ test_connections.py
â”‚   â”œâ”€â”€ utils/                     # å·¥å…·ç±»å•å…ƒæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_validators.py
â”‚   â”‚   â”œâ”€â”€ test_formatters.py
â”‚   â”‚   â””â”€â”€ test_crypto_utils.py
â”‚   â””â”€â”€ fixtures/                  # å•å…ƒæµ‹è¯•å¤¹å…·
â”‚       â”œâ”€â”€ conftest.py
â”‚       â”œâ”€â”€ sample_data.py
â”‚       â””â”€â”€ mock_objects.py
â”œâ”€â”€ integration/                    # é›†æˆæµ‹è¯• (ç›®æ ‡: 12% of tests)
â”‚   â”œâ”€â”€ test_api_database_integration.py
â”‚   â”œâ”€â”€ test_cache_integration.py
â”‚   â”œâ”€â”€ test_messaging_integration.py
â”‚   â””â”€â”€ test_external_api_integration.py
â”œâ”€â”€ e2e/                           # ç«¯åˆ°ç«¯æµ‹è¯• (ç›®æ ‡: 2% of tests)
â”‚   â”œâ”€â”€ test_user_workflows.py
â”‚   â”œâ”€â”€ test_prediction_pipeline.py
â”‚   â””â”€â”€ test_data_collection_flow.py
â”œâ”€â”€ performance/                   # æ€§èƒ½æµ‹è¯• (ç›®æ ‡: 1% of tests)
â”‚   â”œâ”€â”€ test_api_performance.py
â”‚   â”œâ”€â”€ test_database_performance.py
â”‚   â””â”€â”€ test_cache_performance.py
â”œâ”€â”€ conftest.py                    # å…¨å±€é…ç½®
â”œâ”€â”€ helpers/                       # æµ‹è¯•è¾…åŠ©å·¥å…·
â”‚   â”œâ”€â”€ database_helpers.py
â”‚   â”œâ”€â”€ api_helpers.py
â”‚   â””â”€â”€ mock_helpers.py
â””â”€â”€ __init__.py
```

---

## ğŸ“‹ æ–‡ä»¶æ¸…ç†ä¸ä¿ç•™å»ºè®®

### âœ… å»ºè®®ä¿ç•™çš„æ–‡ä»¶ (650+ files)

**é«˜ä»·å€¼æ–‡ä»¶**:
- `tests/unit/api/test_*.py` (45 files) - APIæ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
- `tests/unit/domain/test_*.py` (89 files) - é¢†åŸŸé€»è¾‘æµ‹è¯•
- `tests/unit/services/test_*.py` (78 files) - ä¸šåŠ¡æœåŠ¡æµ‹è¯•
- `tests/unit/database/test_*.py` (67 files) - æ•°æ®è®¿é—®æµ‹è¯•
- `tests/integration/test_*.py` (20 files) - é›†æˆæµ‹è¯•

**è¾…åŠ©æ–‡ä»¶**:
- `tests/fixtures/sample_data.py` - æµ‹è¯•æ•°æ®
- `tests/helpers/database.py` - æ•°æ®åº“è¾…åŠ©
- `tests/conftest.py` - pytesté…ç½®

### âš ï¸ éœ€è¦é‡å‘½åçš„æ–‡ä»¶ (41ä¸ªæ–‡ä»¶)

**å‘½åä¸è§„èŒƒç¤ºä¾‹**:
```
unit/adapters/registry_test.py â†’ unit/adapters/test_registry.py
unit/api/monitoring_test.py â†’ unit/api/test_monitoring.py
unit/core/di_test.py â†’ unit/core/test_di_container.py
unit/events/bus_test.py â†’ unit/events/test_bus.py
unit/tasks/monitoring_test.py â†’ unit/tasks/test_monitoring.py
```

**é‡å‘½åè§„åˆ™**:
- å•å…ƒæµ‹è¯•: `test_<module>_<feature>.py`
- é›†æˆæµ‹è¯•: `test_integration_<module>.py`
- æ€§èƒ½æµ‹è¯•: `test_perf_<target>.py`

### âŒ å»ºè®®åˆ é™¤çš„æ–‡ä»¶ (70+ files)

**æ— æµ‹è¯•å‡½æ•°**: 70ä¸ªæ–‡ä»¶
- ä¸»è¦ä¸º `__init__.py` å’Œé…ç½®æ–‡ä»¶
- è¿‡æ—¶çš„mockæ–‡ä»¶
- é‡å¤çš„æµ‹è¯•å¤¹å…·

**æ— æ–­è¨€æ–‡ä»¶**: 124ä¸ªæ–‡ä»¶éœ€è¦å®¡æŸ¥
- ä»…åŒ…å«fixtureå®šä¹‰çš„æ–‡ä»¶
- æ¨¡æ‹Ÿæ•°æ®æ–‡ä»¶ï¼ˆç§»è‡³fixturesï¼‰

**é—®é¢˜æ–‡ä»¶**:
- ä¾èµ–å¤–éƒ¨æœåŠ¡çš„æµ‹è¯•
- åŒ…å«ç¡¬ç¼–ç è·¯å¾„çš„æµ‹è¯•
- æ‰§è¡Œæ—¶é—´è¿‡é•¿çš„æµ‹è¯•ï¼ˆç§»è‡³performanceï¼‰

---

## ğŸ”§ Pytestæ ‡è®°æ ‡å‡†åŒ–

### å»ºè®®çš„æ ‡è®°ä½“ç³»
```python
@pytest.mark.unit           # å•å…ƒæµ‹è¯• (85%)
@pytest.mark.integration    # é›†æˆæµ‹è¯• (12%)
@pytest.mark.e2e           # ç«¯åˆ°ç«¯æµ‹è¯• (2%)
@pytest.mark.performance   # æ€§èƒ½æµ‹è¯• (1%)
@pytest.mark.slow          # æ…¢é€Ÿæµ‹è¯•
@pytest.mark.database      # éœ€è¦æ•°æ®åº“
@pytest.mark.cache         # éœ€è¦ç¼“å­˜
@pytest.mark.external_api  # éœ€è¦å¤–éƒ¨API
@pytest.mark.auth          # è®¤è¯ç›¸å…³
```

### æ ‡è®°åº”ç”¨ç­–ç•¥
1. **å•å…ƒæµ‹è¯•**: æ·»åŠ  `@pytest.mark.unit`
2. **é›†æˆæµ‹è¯•**: æ·»åŠ  `@pytest.mark.integration`
3. **APIæµ‹è¯•**: æ·»åŠ  `@pytest.mark.api`
4. **æ•°æ®åº“æµ‹è¯•**: æ·»åŠ  `@pytest.mark.database`
5. **æ€§èƒ½æµ‹è¯•**: æ·»åŠ  `@pytest.mark.performance`
6. **æ…¢é€Ÿæµ‹è¯•**: æ·»åŠ  `@pytest.mark.slow`

---

## ğŸ¯ é‡æ„æ‰§è¡Œè®¡åˆ’

### Phase 1: ç»“æ„é‡ç»„ (é¢„è®¡å½±å“200+æ–‡ä»¶)
1. åˆ›å»ºæ ‡å‡†åŒ–ç›®å½•ç»“æ„
2. è¿ç§»æ–‡ä»¶åˆ°æ­£ç¡®ç›®å½•
3. é‡å‘½åä¸è§„èŒƒæ–‡ä»¶
4. åˆ é™¤å†—ä½™å’Œç©ºæ–‡ä»¶

### Phase 2: æ ‡è®°è§„èŒƒåŒ– (é¢„è®¡å½±å“400+æ–‡ä»¶)
1. ä¸ºç¼ºå¤±æ ‡è®°çš„æ–‡ä»¶æ·»åŠ æ ‡è®°
2. ç»Ÿä¸€æ ‡è®°å‘½åè§„èŒƒ
3. æ›´æ–°conftest.pyé…ç½®

### Phase 3: Mockä¸éš”ç¦»ä¼˜åŒ– (é¢„è®¡å½±å“300+æ–‡ä»¶)
1. ç»Ÿä¸€Mockå¯¼å…¥å’Œä½¿ç”¨
2. éš”ç¦»å¤–éƒ¨ä¾èµ–
3. ä¼˜åŒ–æµ‹è¯•å¤¹å…·

### Phase 4: è´¨é‡æå‡ (é¢„è®¡å½±å“124ä¸ªæ–‡ä»¶)
1. ä¸ºæ— æ–­è¨€æ–‡ä»¶æ·»åŠ æ–­è¨€
2. ä¿®å¤æµ‹è¯•é€»è¾‘é”™è¯¯
3. ä¼˜åŒ–æµ‹è¯•è¦†ç›–ç‡

---

## ğŸ“ˆ é¢„æœŸæ•ˆæœé¢„ä¼°

### æ–‡ä»¶æ•°é‡å˜åŒ–
```
é‡æ„å‰: 760 files (100%)
é‡æ„å: ~650 files (-15%)
- åˆ é™¤å†—ä½™: 70 files
- åˆå¹¶é‡å¤: 40 files
```

### æµ‹è¯•ç±»å‹åˆ†å¸ƒ
```
å•å…ƒæµ‹è¯•:   673 â†’ 553 (82% â†’ 85%)
é›†æˆæµ‹è¯•:   26  â†’ 78  (3% â†’ 12%)
ç«¯åˆ°ç«¯æµ‹è¯•: 10  â†’ 13  (1% â†’ 2%)
æ€§èƒ½æµ‹è¯•:   1   â†’ 6   (0% â†’ 1%)
```

### è¦†ç›–ç‡é¢„æœŸæå‡
```
å½“å‰è¦†ç›–ç‡: 13.52%
é‡æ„åé¢„æœŸ: 30-35%
ç›®æ ‡è¦†ç›–ç‡: 80% (é•¿æœŸ)
```

### æ‰§è¡Œæ•ˆç‡æå‡
- ç§»é™¤__pycache__æ±¡æŸ“: +20%
- ç»Ÿä¸€Mockä½¿ç”¨: +15%
- ä¼˜åŒ–æµ‹è¯•æ ‡è®°: +25%
- å¹¶è¡Œæ‰§è¡Œæ”¯æŒ: +40%

---

## ğŸš¨ é£é™©è¯„ä¼°ä¸ç¼“è§£

### é«˜é£é™©é¡¹
1. **å¤§é‡æ–‡ä»¶ç§»åŠ¨** - å¯èƒ½ç ´åå¯¼å…¥è·¯å¾„
   - ç¼“è§£: æ‰¹é‡æ›´æ–°å¯¼å…¥è¯­å¥
2. **æ ‡è®°å˜æ›´** - å¯èƒ½å½±å“CIé…ç½®
   - ç¼“è§£: ä¿æŒå‘åå…¼å®¹æ ‡è®°

### ä¸­é£é™©é¡¹
1. **Mocké‡æ„** - å¯èƒ½æ”¹å˜æµ‹è¯•è¡Œä¸º
   - ç¼“è§£: é€æ¨¡å—éªŒè¯
2. **æµ‹è¯•åˆ é™¤** - å¯èƒ½é™ä½è¦†ç›–ç‡
   - ç¼“è§£: å½±å“åˆ†ææŠ¥å‘Š

### ç¼“è§£æªæ–½
1. åˆ†é˜¶æ®µæ‰§è¡Œï¼Œæ¯é˜¶æ®µéªŒè¯
2. ä¿ç•™åŸæ–‡ä»¶å¤‡ä»½
3. æŒç»­ç›‘æ§è¦†ç›–ç‡å˜åŒ–
4. å»ºç«‹å›æ»šæœºåˆ¶

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’

### ç«‹å³æ‰§è¡Œ (ä»Šå¤©)
1. å¤‡ä»½å½“å‰tests/ç›®å½•
2. åˆ›å»ºæ–°çš„ç›®å½•ç»“æ„
3. é…ç½®pytest.iniå’Œ.coveragerc

### æœ¬å‘¨å†…å®Œæˆ
1. æ–‡ä»¶é‡ç»„å’Œé‡å‘½å
2. æ·»åŠ æ ‡å‡†åŒ–æ ‡è®°
3. æ›´æ–°å¯¼å…¥è·¯å¾„

### ä¸‹å‘¨ç›®æ ‡
1. Mockä¼˜åŒ–å’Œä¾èµ–éš”ç¦»
2. è´¨é‡éªŒè¯å’Œæµ‹è¯•ä¿®å¤
3. ç”Ÿæˆæœ€ç»ˆé‡æ„æŠ¥å‘Š

---

## ğŸ“Š æˆåŠŸæŒ‡æ ‡

### å®šé‡æŒ‡æ ‡
- [ ] æµ‹è¯•æ–‡ä»¶æ•°é‡å‡å°‘15% (760 â†’ 650)
- [ ] å‘½åè§„èŒƒç‡è¾¾åˆ°95%+
- [ ] æ ‡è®°è¦†ç›–ç‡è¾¾åˆ°90%+
- [ ] è¦†ç›–ç‡æå‡è‡³30%+
- [ ] æµ‹è¯•æ‰§è¡Œæ—¶é—´å‡å°‘20%

### å®šæ€§æŒ‡æ ‡
- [ ] ç›®å½•ç»“æ„æ¸…æ™°æ˜“æ‡‚
- [ ] æµ‹è¯•å‘½åè¯­ä¹‰æ˜ç¡®
- [ ] Mockä½¿ç”¨è§„èŒƒç»Ÿä¸€
- [ ] æµ‹è¯•ç‹¬ç«‹æ€§å¢å¼º
- [ ] ç»´æŠ¤æˆæœ¬é™ä½

---

**ğŸ“‹ å‡†å¤‡å°±ç»ª**: ç­‰å¾…æ‰§è¡Œç¡®è®¤åï¼Œå¼€å§‹Phase 1å®æ–½

**âš¡ ä¸“å®¶å»ºè®®**: å»ºè®®å…ˆåœ¨åˆ†æ”¯ä¸Šè¿›è¡Œé‡æ„ï¼ŒéªŒè¯é€šè¿‡åå†åˆå¹¶åˆ°ä¸»åˆ†æ”¯ã€‚

---

*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2025-10-24 | æµ‹è¯•æ¶æ„ä¸“å®¶*
