#!/usr/bin/env python3
"""
Batch-Î”-021: èµ”ç‡æ”¶é›†å™¨å…¨é¢æµ‹è¯• (Phase 5.3.1)

ç›®æ ‡æ–‡ä»¶: src/data/collectors/odds_collector.py
å½“å‰è¦†ç›–ç‡: 9% (127/144 è¡Œæœªè¦†ç›–)
ç›®æ ‡è¦†ç›–ç‡: â‰¥70%
æµ‹è¯•é‡ç‚¹: æ•°æ®è·å–ã€å¼‚å¸¸å¤„ç†ã€APIé›†æˆ
"""

import pytest
import asyncio
import json
from unittest.mock import Mock, patch, AsyncMock, MagicMock
from datetime import datetime, timedelta
from typing import Dict, Any, List
from decimal import Decimal

# é¢„å¯¼å…¥æ‰€æœ‰é‡é‡çº§ä¾èµ–
modules_to_mock = {
    'pandas': Mock(),
    'numpy': Mock(),
    'requests': Mock(),
    'aiohttp': Mock(),
    'asyncio': Mock()
}

with patch.dict('sys.modules', modules_to_mock):
    from src.data.collectors.odds_collector import OddsCollector
    from src.data.collectors.base_collector import CollectionResult


class TestOddsCollector:
    """èµ”ç‡æ”¶é›†å™¨å…¨é¢æµ‹è¯•"""

    def setup_method(self):
        """æ¯ä¸ªæµ‹è¯•æ–¹æ³•å‰çš„è®¾ç½®"""
        self.collector = OddsCollector(
            data_source="test_odds_api",
            api_key="test_key",
            base_url="https://test.api.com"
        )

    def test_collector_initialization(self):
        """æµ‹è¯•æ”¶é›†å™¨åˆå§‹åŒ–"""
        print("ğŸ§ª æµ‹è¯•æ”¶é›†å™¨åˆå§‹åŒ–...")

        # æµ‹è¯•é»˜è®¤åˆå§‹åŒ–
        collector = OddsCollector()
        assert collector.data_source == "odds_api"
        assert collector.api_key is None
        assert collector.base_url == "https://api.the-odds-api.com/v4"
        assert collector.time_window_minutes == 5
        assert isinstance(collector._recent_odds_keys, set)
        assert isinstance(collector._last_odds_values, dict)

        # æµ‹è¯•è‡ªå®šä¹‰é…ç½®åˆå§‹åŒ–
        custom_collector = OddsCollector(
            data_source="custom_api",
            api_key="test_key",
            base_url="https://custom.api.com",
            time_window_minutes=10
        )
        assert custom_collector.data_source == "custom_api"
        assert custom_collector.api_key == "test_key"
        assert custom_collector.base_url == "https://custom.api.com"
        assert custom_collector.time_window_minutes == 10

        print("âœ… æ”¶é›†å™¨åˆå§‹åŒ–æµ‹è¯•é€šè¿‡")

    @pytest.mark.asyncio
    async def test_collect_fixtures_skipped(self):
        """æµ‹è¯•collect_fixturesæ–¹æ³•ï¼ˆè·³è¿‡ï¼‰"""
        print("ğŸ§ª æµ‹è¯•collect_fixturesæ–¹æ³•...")

        result = await self.collector.collect_fixtures()

        assert isinstance(result, CollectionResult)
        assert result.data_source == "test_odds_api"
        assert result.collection_type == "fixtures"
        assert result.records_collected == 0
        assert result.success_count == 0
        assert result.error_count == 0
        assert result.status == "skipped"

        print("âœ… collect_fixturesæ–¹æ³•æµ‹è¯•é€šè¿‡")

    @pytest.mark.asyncio
    async def test_collect_live_scores_skipped(self):
        """æµ‹è¯•collect_live_scoresæ–¹æ³•ï¼ˆè·³è¿‡ï¼‰"""
        print("ğŸ§ª æµ‹è¯•collect_live_scoresæ–¹æ³•...")

        result = await self.collector.collect_live_scores()

        assert isinstance(result, CollectionResult)
        assert result.data_source == "test_odds_api"
        assert result.collection_type == "live_scores"
        assert result.records_collected == 0
        assert result.success_count == 0
        assert result.error_count == 0
        assert result.status == "skipped"

        print("âœ… collect_live_scoresæ–¹æ³•æµ‹è¯•é€šè¿‡")

    @pytest.mark.asyncio
    async def test_collect_odds_success(self):
        """æµ‹è¯•æˆåŠŸæ”¶é›†èµ”ç‡æ•°æ®"""
        print("ğŸ§ª æµ‹è¯•èµ”ç‡æ•°æ®æ”¶é›†...")

        # Mockä¾èµ–æ–¹æ³•
        mock_match_odds = [
            {
                "match_id": "1",
                "bookmaker": "bet365",
                "market_type": "h2h",
                "outcomes": [
                    {"name": "Arsenal", "price": 2.10},
                    {"name": "Draw", "price": 3.20},
                    {"name": "Chelsea", "price": 3.50}
                ],
                "last_update": "2023-01-01T12:00:00Z"
            }
        ]

        with patch.object(self.collector, '_get_active_bookmakers', return_value=["bet365"]):
            with patch.object(self.collector, '_get_upcoming_matches', return_value=["1"]):
                with patch.object(self.collector, '_clean_expired_odds_cache'):
                    with patch.object(self.collector, '_collect_match_odds', return_value=mock_match_odds):
                        with patch.object(self.collector, '_has_odds_changed', return_value=True):
                            with patch.object(self.collector, '_clean_odds_data', return_value=mock_match_odds[0]):
                                with patch.object(self.collector, '_save_to_bronze_layer'):
                                    result = await self.collector.collect_odds()

                                    assert result.success is True
                                    assert result.records_collected == 1
                                    assert result.success_count == 1
                                    assert result.error_count == 0
                                    assert result.status == "success"
                                    assert len(result.collected_data) == 1

        print("âœ… èµ”ç‡æ•°æ®æ”¶é›†æµ‹è¯•é€šè¿‡")

    @pytest.mark.asyncio
    async def test_collect_odds_with_errors(self):
        """æµ‹è¯•æ”¶é›†èµ”ç‡æ•°æ®æ—¶çš„é”™è¯¯å¤„ç†"""
        print("ğŸ§ª æµ‹è¯•æ”¶é›†èµ”ç‡æ•°æ®é”™è¯¯å¤„ç†...")

        # Mock APIé”™è¯¯
        with patch.object(self.collector, '_get_active_bookmakers', side_effect=Exception("API Error")):
            result = await self.collector.collect_odds()

            assert result.success is False
            assert result.status == "failed"
            assert result.error_count == 1
            assert "API Error" in result.error_message

        print("âœ… æ”¶é›†èµ”ç‡æ•°æ®é”™è¯¯å¤„ç†æµ‹è¯•é€šè¿‡")

    @pytest.mark.asyncio
    async def test_get_active_bookmakers(self):
        """æµ‹è¯•è·å–æ´»è·ƒåšå½©å…¬å¸"""
        print("ğŸ§ª æµ‹è¯•è·å–æ´»è·ƒåšå½©å…¬å¸...")

        bookmakers = await self.collector._get_active_bookmakers()

        assert isinstance(bookmakers, list)
        assert len(bookmakers) > 0
        assert "bet365" in bookmakers
        assert "pinnacle" in bookmakers

        print("âœ… è·å–æ´»è·ƒåšå½©å…¬å¸æµ‹è¯•é€šè¿‡")

    @pytest.mark.asyncio
    async def test_get_active_bookmakers_error(self):
        """æµ‹è¯•è·å–æ´»è·ƒåšå½©å…¬å¸é”™è¯¯å¤„ç†"""
        print("ğŸ§ª æµ‹è¯•è·å–æ´»è·ƒåšå½©å…¬å¸é”™è¯¯å¤„ç†...")

        # æ¨¡æ‹Ÿå¼‚å¸¸
        with patch.object(self.collector, '_get_active_bookmakers', side_effect=Exception("Database error")):
            bookmakers = await self.collector._get_active_bookmakers()

            # åº”è¯¥è¿”å›é»˜è®¤åšå½©å…¬å¸
            assert isinstance(bookmakers, list)
            assert len(bookmakers) == 2
            assert "bet365" in bookmakers
            assert "pinnacle" in bookmakers

        print("âœ… è·å–æ´»è·ƒåšå½©å…¬å¸é”™è¯¯å¤„ç†æµ‹è¯•é€šè¿‡")

    @pytest.mark.asyncio
    async def test_get_upcoming_matches(self):
        """æµ‹è¯•è·å–å³å°†å¼€å§‹çš„æ¯”èµ›"""
        print("ğŸ§ª æµ‹è¯•è·å–å³å°†å¼€å§‹çš„æ¯”èµ›...")

        matches = await self.collector._get_upcoming_matches()

        assert isinstance(matches, list)
        # ç›®å‰è¿”å›ç©ºåˆ—è¡¨ä½œä¸ºå ä½ç¬¦

        print("âœ… è·å–å³å°†å¼€å§‹çš„æ¯”èµ›æµ‹è¯•é€šè¿‡")

    @pytest.mark.asyncio
    async def test_clean_expired_odds_cache(self):
        """æµ‹è¯•æ¸…ç†è¿‡æœŸèµ”ç‡ç¼“å­˜"""
        print("ğŸ§ª æµ‹è¯•æ¸…ç†è¿‡æœŸèµ”ç‡ç¼“å­˜...")

        # ç›®å‰åªæ˜¯å ä½ç¬¦å®ç°ï¼Œåº”è¯¥ä¸æŠ›å‡ºå¼‚å¸¸
        await self.collector._clean_expired_odds_cache()

        print("âœ… æ¸…ç†è¿‡æœŸèµ”ç‡ç¼“å­˜æµ‹è¯•é€šè¿‡")

    @pytest.mark.asyncio
    async def test_collect_match_odds(self):
        """æµ‹è¯•é‡‡é›†æŒ‡å®šæ¯”èµ›çš„èµ”ç‡æ•°æ®"""
        print("ğŸ§ª æµ‹è¯•é‡‡é›†æŒ‡å®šæ¯”èµ›çš„èµ”ç‡æ•°æ®...")

        mock_response = [
            {
                "id": "1",
                "bookmakers": [
                    {
                        "key": "bet365",
                        "markets": [
                            {
                                "key": "h2h",
                                "outcomes": [
                                    {"name": "Arsenal", "price": 2.10},
                                    {"name": "Chelsea", "price": 3.50}
                                ],
                                "last_update": "2023-01-01T12:00:00Z"
                            }
                        ]
                    }
                ]
            }
        ]

        with patch.object(self.collector, '_make_request', return_value=mock_response):
            result = await self.collector._collect_match_odds("1", ["bet365"], ["h2h"])

            assert isinstance(result, list)
            assert len(result) == 1
            assert result[0]["match_id"] == "1"
            assert result[0]["bookmaker"] == "bet365"
            assert result[0]["market_type"] == "h2h"
            assert len(result[0]["outcomes"]) == 2

        print("âœ… é‡‡é›†æŒ‡å®šæ¯”èµ›çš„èµ”ç‡æ•°æ®æµ‹è¯•é€šè¿‡")

    @pytest.mark.asyncio
    async def test_collect_match_odds_error(self):
        """æµ‹è¯•é‡‡é›†æŒ‡å®šæ¯”èµ›èµ”ç‡æ•°æ®çš„é”™è¯¯å¤„ç†"""
        print("ğŸ§ª æµ‹è¯•é‡‡é›†æŒ‡å®šæ¯”èµ›èµ”ç‡æ•°æ®é”™è¯¯å¤„ç†...")

        with patch.object(self.collector, '_make_request', side_effect=Exception("API Error")):
            result = await self.collector._collect_match_odds("1", ["bet365"], ["h2h"])

            assert result == []  # å‡ºé”™æ—¶è¿”å›ç©ºåˆ—è¡¨

        print("âœ… é‡‡é›†æŒ‡å®šæ¯”èµ›èµ”ç‡æ•°æ®é”™è¯¯å¤„ç†æµ‹è¯•é€šè¿‡")

    def test_generate_odds_key(self):
        """æµ‹è¯•ç”Ÿæˆèµ”ç‡å”¯ä¸€é”®"""
        print("ğŸ§ª æµ‹è¯•ç”Ÿæˆèµ”ç‡å”¯ä¸€é”®...")

        odds_data = {
            "match_id": "1",
            "bookmaker": "bet365",
            "market_type": "h2h"
        }

        key = self.collector._generate_odds_key(odds_data)

        assert isinstance(key, str)
        assert len(key) == 32  # MD5å“ˆå¸Œé•¿åº¦

        # ç›¸åŒæ•°æ®åº”è¯¥ç”Ÿæˆç›¸åŒçš„é”®
        key2 = self.collector._generate_odds_key(odds_data)
        assert key == key2

        print("âœ… ç”Ÿæˆèµ”ç‡å”¯ä¸€é”®æµ‹è¯•é€šè¿‡")

    @pytest.mark.asyncio
    async def test_has_odds_changed_true(self):
        """æµ‹è¯•èµ”ç‡å˜åŒ–æ£€æµ‹ï¼ˆæœ‰å˜åŒ–ï¼‰"""
        print("ğŸ§ª æµ‹è¯•èµ”ç‡å˜åŒ–æ£€æµ‹ï¼ˆæœ‰å˜åŒ–ï¼‰...")

        odds_data = {
            "match_id": "1",
            "bookmaker": "bet365",
            "market_type": "h2h",
            "outcomes": [
                {"name": "Arsenal", "price": 2.15},  # èµ”ç‡å˜åŒ–
                {"name": "Chelsea", "price": 3.50}
            ]
        }

        # è®¾ç½®ä¸Šæ¬¡è®°å½•çš„èµ”ç‡å€¼
        odds_id = "1:bet365:h2h"
        self.collector._last_odds_values[odds_id] = {
            "Arsenal": Decimal("2.10"),
            "Chelsea": Decimal("3.50")
        }

        has_changed = await self.collector._has_odds_changed(odds_data)
        assert has_changed is True

        print("âœ… èµ”ç‡å˜åŒ–æ£€æµ‹ï¼ˆæœ‰å˜åŒ–ï¼‰æµ‹è¯•é€šè¿‡")

    @pytest.mark.asyncio
    async def test_has_odds_changed_false(self):
        """æµ‹è¯•èµ”ç‡å˜åŒ–æ£€æµ‹ï¼ˆæ— å˜åŒ–ï¼‰"""
        print("ğŸ§ª æµ‹è¯•èµ”ç‡å˜åŒ–æ£€æµ‹ï¼ˆæ— å˜åŒ–ï¼‰...")

        odds_data = {
            "match_id": "1",
            "bookmaker": "bet365",
            "market_type": "h2h",
            "outcomes": [
                {"name": "Arsenal", "price": 2.10},
                {"name": "Chelsea", "price": 3.50}
            ]
        }

        # è®¾ç½®ä¸Šæ¬¡è®°å½•çš„èµ”ç‡å€¼
        odds_id = "1:bet365:h2h"
        self.collector._last_odds_values[odds_id] = {
            "Arsenal": Decimal("2.10"),
            "Chelsea": Decimal("3.50")
        }

        has_changed = await self.collector._has_odds_changed(odds_data)
        assert has_changed is False

        print("âœ… èµ”ç‡å˜åŒ–æ£€æµ‹ï¼ˆæ— å˜åŒ–ï¼‰æµ‹è¯•é€šè¿‡")

    @pytest.mark.asyncio
    async def test_has_odds_changed_first_time(self):
        """æµ‹è¯•é¦–æ¬¡èµ”ç‡å˜åŒ–æ£€æµ‹"""
        print("ğŸ§ª æµ‹è¯•é¦–æ¬¡èµ”ç‡å˜åŒ–æ£€æµ‹...")

        odds_data = {
            "match_id": "1",
            "bookmaker": "bet365",
            "market_type": "h2h",
            "outcomes": [
                {"name": "Arsenal", "price": 2.10},
                {"name": "Chelsea", "price": 3.50}
            ]
        }

        # ç¡®ä¿æ²¡æœ‰ä¸Šæ¬¡è®°å½•
        self.collector._last_odds_values.clear()

        has_changed = await self.collector._has_odds_changed(odds_data)
        assert has_changed is True  # é¦–æ¬¡è®°å½•åº”è¯¥è¿”å›True

        print("âœ… é¦–æ¬¡èµ”ç‡å˜åŒ–æ£€æµ‹æµ‹è¯•é€šè¿‡")

    @pytest.mark.asyncio
    async def test_clean_odds_data_success(self):
        """æµ‹è¯•æ¸…æ´—èµ”ç‡æ•°æ®ï¼ˆæˆåŠŸï¼‰"""
        print("ğŸ§ª æµ‹è¯•æ¸…æ´—èµ”ç‡æ•°æ®...")

        raw_odds = {
            "match_id": "1",
            "bookmaker": "bet365",
            "market_type": "h2h",
            "outcomes": [
                {"name": "Arsenal", "price": 2.10},
                {"name": "Draw", "price": 3.20},
                {"name": "Chelsea", "price": 3.50}
            ],
            "last_update": "2023-01-01T12:00:00Z"
        }

        cleaned = await self.collector._clean_odds_data(raw_odds)

        assert cleaned is not None
        assert cleaned["external_match_id"] == "1"
        assert cleaned["bookmaker"] == "bet365"
        assert cleaned["market_type"] == "h2h"
        assert len(cleaned["outcomes"]) == 3
        assert cleaned["processed"] is False
        assert "collected_at" in cleaned

        print("âœ… æ¸…æ´—èµ”ç‡æ•°æ®æµ‹è¯•é€šè¿‡")

    @pytest.mark.asyncio
    async def test_clean_odds_data_invalid(self):
        """æµ‹è¯•æ¸…æ´—æ— æ•ˆèµ”ç‡æ•°æ®"""
        print("ğŸ§ª æµ‹è¯•æ¸…æ´—æ— æ•ˆèµ”ç‡æ•°æ®...")

        # ç¼ºå°‘å¿…è¦å­—æ®µ
        invalid_odds = {
            "match_id": "1",
            "bookmaker": "bet365"
            # ç¼ºå°‘market_typeå’Œoutcomes
        }

        cleaned = await self.collector._clean_odds_data(invalid_odds)
        assert cleaned is None

        # æ— æ•ˆèµ”ç‡å€¼
        invalid_price_odds = {
            "match_id": "1",
            "bookmaker": "bet365",
            "market_type": "h2h",
            "outcomes": [
                {"name": "Arsenal", "price": 0.5}  # èµ”ç‡å°äº1
            ]
        }

        cleaned = await self.collector._clean_odds_data(invalid_price_odds)
        assert cleaned is None

        print("âœ… æ¸…æ´—æ— æ•ˆèµ”ç‡æ•°æ®æµ‹è¯•é€šè¿‡")

    @pytest.mark.asyncio
    async def test_collect_odds_partial_success(self):
        """æµ‹è¯•éƒ¨åˆ†æˆåŠŸçš„èµ”ç‡æ”¶é›†"""
        print("ğŸ§ª æµ‹è¯•éƒ¨åˆ†æˆåŠŸçš„èµ”ç‡æ”¶é›†...")

        # Mockä¸€äº›æˆåŠŸä¸€äº›å¤±è´¥çš„æƒ…å†µ
        with patch.object(self.collector, '_get_active_bookmakers', return_value=["bet365"]):
            with patch.object(self.collector, '_get_upcoming_matches', return_value=["1", "2"]):
                with patch.object(self.collector, '_clean_expired_odds_cache'):
                    # ç¬¬ä¸€ä¸ªæ¯”èµ›æˆåŠŸï¼Œç¬¬äºŒä¸ªæ¯”èµ›å¤±è´¥
                    def mock_collect_match_odds(match_id, bookmakers, markets):
                        if match_id == "1":
                            return [{
                                "match_id": "1",
                                "bookmaker": "bet365",
                                "market_type": "h2h",
                                "outcomes": [{"name": "Arsenal", "price": 2.10}],
                                "last_update": "2023-01-01T12:00:00Z"
                            }]
                        else:
                            raise Exception("API Error for match 2")

                    with patch.object(self.collector, '_collect_match_odds', side_effect=mock_collect_match_odds):
                        with patch.object(self.collector, '_has_odds_changed', return_value=True):
                            with patch.object(self.collector, '_clean_odds_data', side_effect=lambda x: x):
                                with patch.object(self.collector, '_save_to_bronze_layer'):
                                    result = await self.collector.collect_odds()

                                    assert result.status == "partial"
                                    assert result.success_count > 0
                                    assert result.error_count > 0
                                    assert result.records_collected > 0

        print("âœ… éƒ¨åˆ†æˆåŠŸçš„èµ”ç‡æ”¶é›†æµ‹è¯•é€šè¿‡")

    @pytest.mark.asyncio
    async def test_time_window_deduplication(self):
        """æµ‹è¯•æ—¶é—´çª—å£å»é‡æœºåˆ¶"""
        print("ğŸ§ª æµ‹è¯•æ—¶é—´çª—å£å»é‡...")

        # æµ‹è¯•å»é‡é”®ç”Ÿæˆ
        odds_data = {
            "match_id": "1",
            "bookmaker": "bet365",
            "market_type": "h2h"
        }

        key1 = self.collector._generate_odds_key(odds_data)

        # æ·»åŠ åˆ°å»é‡é›†åˆ
        self.collector._recent_odds_keys.add(key1)

        # å†æ¬¡ç”Ÿæˆç›¸åŒçš„æ•°æ®ï¼Œåº”è¯¥è¢«å»é‡
        key2 = self.collector._generate_odds_key(odds_data)
        assert key1 == key2
        assert key2 in self.collector._recent_odds_keys

        print("âœ… æ—¶é—´çª—å£å»é‡æµ‹è¯•é€šè¿‡")

    @pytest.mark.asyncio
    async def test_odds_change_detection_sensitivity(self):
        """æµ‹è¯•èµ”ç‡å˜åŒ–æ£€æµ‹çµæ•åº¦"""
        print("ğŸ§ª æµ‹è¯•èµ”ç‡å˜åŒ–æ£€æµ‹çµæ•åº¦...")

        odds_data = {
            "match_id": "1",
            "bookmaker": "bet365",
            "market_type": "h2h",
            "outcomes": [
                {"name": "Arsenal", "price": 2.101},  # å˜åŒ–å¾ˆå°
                {"name": "Chelsea", "price": 3.50}
            ]
        }

        # è®¾ç½®ä¸Šæ¬¡è®°å½•çš„èµ”ç‡å€¼
        odds_id = "1:bet365:h2h"
        self.collector._last_odds_values[odds_id] = {
            "Arsenal": Decimal("2.10"),
            "Chelsea": Decimal("3.50")
        }

        has_changed = await self.collector._has_odds_changed(odds_data)
        assert has_changed is False  # å˜åŒ–å°äº0.01é˜ˆå€¼

        print("âœ… èµ”ç‡å˜åŒ–æ£€æµ‹çµæ•åº¦æµ‹è¯•é€šè¿‡")


def test_odds_collector_comprehensive():
    """èµ”ç‡æ”¶é›†å™¨ç»¼åˆæµ‹è¯•"""
    print("ğŸš€ å¼€å§‹ Batch-Î”-021: èµ”ç‡æ”¶é›†å™¨å…¨é¢æµ‹è¯•...")

    test_instance = TestOddsCollector()

    # æ‰§è¡Œæ‰€æœ‰æµ‹è¯•
    tests = [
        test_instance.test_collector_initialization,
        test_instance.test_collect_fixtures_skipped,
        test_instance.test_collect_live_scores_skipped,
        test_instance.test_collect_odds_success,
        test_instance.test_collect_odds_with_errors,
        test_instance.test_get_active_bookmakers,
        test_instance.test_get_active_bookmakers_error,
        test_instance.test_get_upcoming_matches,
        test_instance.test_clean_expired_odds_cache,
        test_instance.test_collect_match_odds,
        test_instance.test_collect_match_odds_error,
        test_instance.test_generate_odds_key,
        test_instance.test_has_odds_changed_true,
        test_instance.test_has_odds_changed_false,
        test_instance.test_has_odds_changed_first_time,
        test_instance.test_clean_odds_data_success,
        test_instance.test_clean_odds_data_invalid,
        test_instance.test_collect_odds_partial_success,
        test_instance.test_time_window_deduplication,
        test_instance.test_odds_change_detection_sensitivity
    ]

    passed = 0
    failed = 0

    for test in tests:
        try:
            test_instance.setup_method()

            # æ£€æŸ¥æ˜¯å¦æ˜¯å¼‚æ­¥æµ‹è¯•
            if asyncio.iscoroutinefunction(test):
                asyncio.run(test())
            else:
                test()

            passed += 1
            print(f"  âœ… {test.__name__}")
        except Exception as e:
            failed += 1
            print(f"  âŒ {test.__name__}: {e}")

    print(f"\nğŸ“Š æµ‹è¯•ç»“æœ: {passed} é€šè¿‡, {failed} å¤±è´¥")

    if failed == 0:
        print("ğŸ‰ Batch-Î”-021: èµ”ç‡æ”¶é›†å™¨æµ‹è¯•å®Œæˆ")
        print("\nğŸ“‹ æµ‹è¯•è¦†ç›–çš„åŠŸèƒ½:")
        print("  - âœ… æ”¶é›†å™¨åˆå§‹åŒ–å’Œé…ç½®")
        print("  - âœ… èµ”ç‡æ•°æ®æ”¶é›†å’Œå¤„ç†")
        print("  - âœ… æ—¶é—´çª—å£å»é‡æœºåˆ¶")
        print("  - âœ… èµ”ç‡å˜åŒ–æ£€æµ‹")
        print("  - âœ… æ•°æ®æ¸…æ´—å’ŒéªŒè¯")
        print("  - âœ… é”™è¯¯å¤„ç†å’Œå¼‚å¸¸ç®¡ç†")
        print("  - âœ… åšå½©å…¬å¸ç®¡ç†")
        print("  - âœ… æ¯”èµ›æ•°æ®è·å–")
        print("  - âœ… ç¼“å­˜ç®¡ç†")
        print("  - âœ… éƒ¨åˆ†æˆåŠŸåœºæ™¯å¤„ç†")
    else:
        print("âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥")


if __name__ == "__main__":
    test_odds_collector_comprehensive()