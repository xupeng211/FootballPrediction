apiVersion: 1

policies:
  - orgId: 1
    receiver: 'default-contact-point'
    group_by: ['alertname', 'component']
    group_wait: '10s'
    group_interval: '30s'
    repeat_interval: '1h'
    routes:
      - match:
          component: 'data_collection'
        receiver: 'data-team-contact'
        group_wait: '5s'
        routes:
          - match:
              severity: 'critical'
            receiver: 'critical-alerts-contact'
            continue: true

      - match:
          component: 'scheduler'
        receiver: 'ops-team-contact'
        routes:
          - match:
              severity: 'critical'
            receiver: 'critical-alerts-contact'
            continue: true

      - match:
          component: 'database'
        receiver: 'dba-team-contact'

      - match:
          component: 'application'
        receiver: 'dev-team-contact'

contact_points:
  - orgId: 1
    name: 'default-contact-point'
    receivers:
      - uid: 'default_email'
        type: 'email'
        settings:
          addresses: 'admin@example.com'
          subject: 'Football Platform Alert: {{ .GroupLabels.alertname }}'
          message: |
            {{ range .Alerts }}
            告警: {{ .Annotations.summary }}
            详情: {{ .Annotations.description }}
            时间: {{ .StartsAt }}
            {{ end }}

  - orgId: 1
    name: 'critical-alerts-contact'
    receivers:
      - uid: 'critical_email'
        type: 'email'
        settings:
          addresses: 'critical-alerts@example.com'
          subject: '🚨 Critical Alert: {{ .GroupLabels.alertname }}'
          message: |
            严重告警！需要立即处理

            {{ range .Alerts }}
            告警: {{ .Annotations.summary }}
            详情: {{ .Annotations.description }}
            时间: {{ .StartsAt }}
            {{ end }}

  - orgId: 1
    name: 'data-team-contact'
    receivers:
      - uid: 'data_team_email'
        type: 'email'
        settings:
          addresses: 'data-team@example.com'
          subject: 'Data Alert: {{ .GroupLabels.alertname }}'

  - orgId: 1
    name: 'ops-team-contact'
    receivers:
      - uid: 'ops_team_email'
        type: 'email'
        settings:
          addresses: 'ops-team@example.com'
          subject: 'Ops Alert: {{ .GroupLabels.alertname }}'

  - orgId: 1
    name: 'dba-team-contact'
    receivers:
      - uid: 'dba_team_email'
        type: 'email'
        settings:
          addresses: 'dba-team@example.com'
          subject: 'Database Alert: {{ .GroupLabels.alertname }}'

  - orgId: 1
    name: 'dev-team-contact'
    receivers:
      - uid: 'dev_team_email'
        type: 'email'
        settings:
          addresses: 'dev-team@example.com'
          subject: 'Application Alert: {{ .GroupLabels.alertname }}'
