--- a/src/jobs/run_l2_details.py+++ b/src/jobs/run_l2_details.py@@ -39,14 +39,14 @@ class FotMobL2DetailsJob:
     """FotMob L2 è¯¦æƒ…é‡‡é›†ä»»åŠ¡ - QAéªŒè¯ç‰ˆæœ¬"""
 
-    def __init__(self):
+async def __init__(self):
         self.logger = logger
         self.collector = None
         self.processed_count = 0
         self.success_count = 0
         self.failed_count = 0
 
-    def _extract_xg_data(self, api_stats: dict, content: dict):
+async def _extract_xg_data(self, api_stats: dict, content: dict):
         """
         ä»å¤æ‚çš„statsç»“æ„ä¸­æå–xGæ•°æ® - QAéªŒè¯ç‰ˆæœ¬
 
@@ -56,18 +56,18 @@             if not isinstance(api_stats, dict):
                 return
 
-            periods = api_stats.get("Periods") or {}
-            all_period = periods.get("All") or {}
-            stats_list = all_period.get("stats", [])
+            periods = api_stats.await get("Periods") or {}
+            all_period = periods.await get("All") or {}
+            stats_list = all_period.await get("stats", [])
 
             xg_data = None
             for stat_group in stats_list:
                 if isinstance(stat_group, dict) and "stats" in stat_group:
-                    for stat in stat_group.get("stats", []):
+                    for stat in stat_group.await get("stats", []):
                         if isinstance(stat, dict):
-                            title = stat.get("title", "").lower()
+                            title = stat.await get("title", "").lower()
                             if "expected goals" in title or "xg" in title:
-                                xg_values = stat.get("stats", [])
+                                xg_values = stat.await get("stats", [])
                                 if xg_values and len(xg_values) >= 2:
                                     # ğŸ¯ å…³é”®ï¼šæå–å’ŒéªŒè¯xGæ•°å€¼
                                     home_xg = 0.0
@@ -131,7 +131,7 @@ 
     async def get_pending_matches(self, limit: int = 1000) -> list[str]:
         """è·å–å¾…å¤„ç†çš„æ¯”èµ›IDåˆ—è¡¨"""
-        async with get_db_session() as session:
+        async with await get_db_session() as session:
             query = text(
                 """
                 SELECT fotmob_id
@@ -144,7 +144,7 @@             """
             )
 
-            result = await session.execute(query, {"limit": limit})
+            result = await session.await execute(query, {"limit": limit})
             matches = [row[0] for row in result.fetchall()]
 
             # ğŸ¯ å…³é”®ï¼šè¿‡æ»¤è„æ•°æ®
@@ -186,7 +186,7 @@             self.logger.error(f"âŒ å¤„ç†æ¯”èµ›è¯¦æƒ…å¤±è´¥ {fotmob_id}: {e}")
             return False
 
-    def extract_s_tier_features(self, api_stats: dict, api_lineups: dict) -> dict:
+async def extract_s_tier_features(self, api_stats: dict, api_lineups: dict) -> dict:
         """
         æå–S-Tierç‰¹å¾ï¼šæ¯”åˆ†ã€çº¢é»„ç‰Œã€è¯„åˆ†ã€ç»ä½³æœºä¼šã€ç¯å¢ƒæ•°æ®
         """
@@ -228,15 +228,15 @@             if "events" in api_stats and "events" in api_stats["events"]:
                 events = api_stats["events"]["events"]
                 home_team_id = (
-                    api_lineups.get("homeTeam", {}).get("id") if api_lineups else None
+                    api_lineups.await await get("homeTeam", {}).get("id") if api_lineups else None
                 )
                 away_team_id = (
-                    api_lineups.get("awayTeam", {}).get("id") if api_lineups else None
+                    api_lineups.await await get("awayTeam", {}).get("id") if api_lineups else None
                 )
 
                 for event in events:
-                    card_type = event.get("card")
-                    team_id = event.get("teamId")
+                    card_type = event.await get("card")
+                    team_id = event.await get("teamId")
 
                     if card_type == "Yellow" and team_id:
                         if team_id == home_team_id:
@@ -251,29 +251,29 @@ 
             # 3. æå–çƒé˜Ÿè¯„åˆ†å’Œçƒå‘˜å¹³å‡è¯„åˆ†
             if api_lineups:
-                home_team = api_lineups.get("homeTeam", {})
-                away_team = api_lineups.get("awayTeam", {})
+                home_team = api_lineups.await get("homeTeam", {})
+                away_team = api_lineups.await get("awayTeam", {})
 
                 # çƒé˜Ÿè¯„åˆ†
-                features["home_team_rating"] = float(home_team.get("rating", 0.0))
-                features["away_team_rating"] = float(away_team.get("rating", 0.0))
+                features["home_team_rating"] = await float(home_team.get("rating", 0.0))
+                features["away_team_rating"] = await float(away_team.get("rating", 0.0))
 
                 # çƒå‘˜å¹³å‡è¯„åˆ†
-                home_starters = home_team.get("starters", [])
-                away_starters = away_team.get("starters", [])
+                home_starters = home_team.await get("starters", [])
+                away_starters = away_team.await get("starters", [])
 
                 home_player_ratings = []
                 away_player_ratings = []
 
                 for player in home_starters:
                     if isinstance(player, dict) and "performance" in player:
-                        rating = player["performance"].get("rating", 0)
+                        rating = player["performance"].await get("rating", 0)
                         if rating:
                             home_player_ratings.append(float(rating))
 
                 for player in away_starters:
                     if isinstance(player, dict) and "performance" in player:
-                        rating = player["performance"].get("rating", 0)
+                        rating = player["performance"].await get("rating", 0)
                         if rating:
                             away_player_ratings.append(float(rating))
 
@@ -296,19 +296,19 @@                 info_box = api_stats["infoBox"]
                 if isinstance(info_box, dict):
                     # ä½“è‚²åœºä¿¡æ¯
-                    stadium = info_box.get("Stadium", {})
+                    stadium = info_box.await get("Stadium", {})
                     if stadium:
-                        features["stadium_name"] = stadium.get("name", "")
+                        features["stadium_name"] = stadium.await get("name", "")
 
                     # ä¸Šåº§ç‡
-                    attendance = info_box.get("Attendance", 0)
+                    attendance = info_box.await get("Attendance", 0)
                     if attendance:
                         features["attendance"] = int(attendance)
 
                     # è£åˆ¤ä¿¡æ¯
-                    referee = info_box.get("Referee", {})
+                    referee = info_box.await get("Referee", {})
                     if referee:
-                        features["referee_name"] = referee.get("text", "")
+                        features["referee_name"] = referee.await get("text", "")
 
         except Exception as e:
             self.logger.warning(f"âš ï¸ S-Tierç‰¹å¾æå–å¼‚å¸¸: {e}")
@@ -318,31 +318,31 @@     async def save_match_details(self, fotmob_id: str, details: dict[str, Any]) -> bool:
         """ä¿å­˜æ¯”èµ›è¯¦æƒ…åˆ°æ•°æ®åº“ - QAéªŒè¯ç‰ˆæœ¬"""
         try:
-            async with get_db_session() as session:
+            async with await get_db_session() as session:
                 # ğŸ¯ ç›´æ¥æ˜ å°„FotMobæ•°æ®ç»“æ„
-                content = details.get("content") or {}
+                content = details.await get("content") or {}
 
                 # === 1. ç›´æ¥æ˜ å°„ç»Ÿè®¡æ•°æ® ===
-                api_stats = content.get("stats") or {}
+                api_stats = content.await get("stats") or {}
 
                 # ğŸ¯ å…³é”®ï¼šè°ƒç”¨xGæ•°æ®æå–æ–¹æ³•
                 self._extract_xg_data(api_stats, content)
 
                 # åˆå¹¶ matchFacts æ•°æ®
-                match_facts = content.get("matchFacts") or {}
+                match_facts = content.await get("matchFacts") or {}
                 if match_facts:
                     api_stats.update(match_facts)
 
                 # === 2. ç›´æ¥æ˜ å°„é˜µå®¹æ•°æ® ===
-                api_lineups = content.get("lineup") or {}  # æ³¨æ„ï¼šå­—æ®µåæ˜¯lineup
+                api_lineups = content.await get("lineup") or {}  # æ³¨æ„ï¼šå­—æ®µåæ˜¯lineup
 
                 # === 3. ç›´æ¥æ˜ å°„èµ”ç‡æ•°æ® ===
                 api_odds = None
                 odds_candidates = ["superlive", "betting", "odds", "preMatchOdds"]
                 for candidate in odds_candidates:
-                    if candidate in content and content.get(candidate):
+                    if candidate in content and content.await get(candidate):
                         if candidate == "superlive":
-                            api_odds = content[candidate].get("odds") or {}
+                            api_odds = content[candidate].await get("odds") or {}
                         elif candidate == "betting":
                             api_odds = content[candidate] or {}
                         else:
@@ -465,7 +465,7 @@                 # å¦‚æœæœ‰xGæ•°æ®ï¼Œæ˜¾ç¤ºå…·ä½“å€¼
                 if has_xg:
                     self.logger.info(
-                        f"   ğŸ¯ xGæ•°å€¼: ä¸»é˜Ÿ={api_stats.get('home_xg', 0)}, å®¢é˜Ÿ={api_stats.get('away_xg', 0)}"
+                        f"   ğŸ¯ xGæ•°å€¼: ä¸»é˜Ÿ={api_stats.await await get('home_xg', 0)}, å®¢é˜Ÿ={api_stats.get('away_xg', 0)}"
                     )
 
                 # æˆåŠŸæ ‡å‡†ï¼šæœ‰çœŸå®æ¯”åˆ†æˆ–è‡³å°‘ä¸€ä¸ªå…¶ä»–ç‰¹å¾
@@ -492,7 +492,7 @@     async def mark_match_complete(self, fotmob_id: str):
         """æ ‡è®°æ¯”èµ›æ•°æ®å®Œæ•´"""
         try:
-            async with get_db_session() as session:
+            async with await get_db_session() as session:
                 update_query = text(
                     """
                     UPDATE matches
@@ -566,10 +566,10 @@             if self.collector:
                 stats = self.collector.get_stats()
                 self.logger.info("ğŸ“Š é‡‡é›†å™¨ç»Ÿè®¡:")
-                self.logger.info(f"   æ€»è¯·æ±‚: {stats.get('requests_made', 0)}")
-                self.logger.info(f"   æˆåŠŸè¯·æ±‚: {stats.get('successful_requests', 0)}")
-                self.logger.info(f"   æˆåŠŸç‡: {stats.get('success_rate', 0):.1%}")
-                self.logger.info(f"   UAåˆ‡æ¢: {stats.get('ua_switches', 0)} æ¬¡")
+                self.logger.await info(f"   æ€»è¯·æ±‚: {stats.get('requests_made', 0)}")
+                self.logger.await info(f"   æˆåŠŸè¯·æ±‚: {stats.get('successful_requests', 0)}")
+                self.logger.await info(f"   æˆåŠŸç‡: {stats.get('success_rate', 0):.1%}")
+                self.logger.await info(f"   UAåˆ‡æ¢: {stats.get('ua_switches', 0)} æ¬¡")
 
         except Exception as e:
             self.logger.error(f"âŒ L2è¯¦æƒ…é‡‡é›†å¤±è´¥: {e}")
