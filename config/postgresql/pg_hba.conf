# PostgreSQL Client Authentication Configuration File
# 足球预测系统的PostgreSQL客户端认证配置
#
# This file controls: which hosts are allowed to connect, how clients
# are authenticated, which PostgreSQL user names they can use, which
# databases they can access.

# TYPE  DATABASE        USER            ADDRESS                 METHOD

# =============================================================================
# LOCAL CONNECTIONS
# =============================================================================

# "local" is for Unix domain socket connections only
local   all             postgres                                peer
local   all             football_admin                          md5
local   all             football_user                           md5
local   all             football_reader                         md5
local   all             football_writer                         md5

# =============================================================================
# IPv4 CONNECTIONS
# =============================================================================

# IPv4 local connections:
host    all             postgres        127.0.0.1/32            scram-sha-256
host    all             postgres        ::1/128                 scram-sha-256

# Docker network connections (172.x.x.x range)
host    all             football_admin  172.16.0.0/12           scram-sha-256
host    all             football_user   172.16.0.0/12           scram-sha-256
host    all             football_reader 172.16.0.0/12           scram-sha-256
host    all             football_writer 172.16.0.0/12           scram-sha-256

# Private network ranges (if needed for internal networks)
host    all             football_admin  10.0.0.0/8              scram-sha-256
host    all             football_user   10.0.0.0/8              scram-sha-256
host    all             football_reader 10.0.0.0/8              scram-sha-256
host    all             football_writer 10.0.0.0/8              scram-sha-256

host    all             football_admin  192.168.0.0/16          scram-sha-256
host    all             football_user   192.168.0.0/16          scram-sha-256
host    all             football_reader 192.168.0.0/16          scram-sha-256
host    all             football_writer 192.168.0.0/16          scram-sha-256

# =============================================================================
# IPv6 CONNECTIONS
# =============================================================================

# IPv6 local connections:
host    all             football_admin  ::1/128                 scram-sha-256
host    all             football_user   ::1/128                 scram-sha-256
host    all             football_reader ::1/128                 scram-sha-256
host    all             football_writer ::1/128                 scram-sha-256

# =============================================================================
# DATABASE-SPECIFIC ACCESS CONTROLS
# =============================================================================

# Production database access
host    football_prediction_dev    football_admin  172.16.0.0/12   scram-sha-256
host    football_prediction_dev    football_user   172.16.0.0/12   scram-sha-256
host    football_prediction_dev    football_reader 172.16.0.0/12   scram-sha-256
host    football_prediction_dev    football_writer 172.16.0.0/12   scram-sha-256

# Test database access
host    football_prediction_test   football_admin  172.16.0.0/12   scram-sha-256
host    football_prediction_test   football_user   172.16.0.0/12   scram-sha-256
host    football_prediction_test   football_reader 172.16.0.0/12   scram-sha-256
host    football_prediction_test   football_writer 172.16.0.0/12   scram-sha-256

# =============================================================================
# REPLICATION CONNECTIONS
# =============================================================================

# Allow replication connections from localhost, by a user with the
# replication privilege.
local   replication     football_admin                          md5
host    replication     football_admin  127.0.0.1/32            scram-sha-256
host    replication     football_admin  ::1/128                 scram-sha-256
host    replication     football_admin  172.16.0.0/12           scram-sha-256

# =============================================================================
# SECURITY NOTES
# =============================================================================

# METHOD可以是 "trust", "reject", "md5", "password", "scram-sha-256",
# "gss", "sspi", "ident", "peer", "pam", "ldap", "radius" or "cert".
#
# 推荐使用 scram-sha-256 作为最安全的密码认证方法
#
# 本配置文件的安全策略：
# 1. 仅允许特定网络范围的连接
# 2. 使用强密码认证（scram-sha-256）
# 3. 为不同用户角色设置相应的访问权限
# 4. 支持容器化环境的网络配置
# 5. 为复制设置专门的访问控制

# =============================================================================
# DENY ALL OTHER CONNECTIONS
# =============================================================================

# Deny all other connections - this should be the last line
# 拒绝所有其他连接 - 这应该是最后一行
host    all             all             0.0.0.0/0               reject
host    all             all             ::/0                    reject
